var app=function(){"use strict";function e(){}function t(e){return e()}function i(){return Object.create(null)}function r(e){e.forEach(t)}function n(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let o,a;function c(e,t){return o||(o=document.createElement("a")),o.href=t,e===o.href}function h(t,...i){if(null==t)return e;const r=t.subscribe(...i);return r.unsubscribe?()=>r.unsubscribe():r}function l(e){let t;return h(e,(e=>t=e))(),t}function u(e,t,i){e.$$.on_destroy.push(h(t,i))}function f(e,t,i,r){if(e){const n=d(e,t,i,r);return e[0](n)}}function d(e,t,i,r){return e[1]&&r?function(e,t){for(const i in t)e[i]=t[i];return e}(i.ctx.slice(),e[1](r(t))):i.ctx}function p(e,t,i,r){if(e[2]&&r){const n=e[2](r(i));if(void 0===t.dirty)return n;if("object"==typeof n){const e=[],i=Math.max(t.dirty.length,n.length);for(let r=0;r<i;r+=1)e[r]=t.dirty[r]|n[r];return e}return t.dirty|n}return t.dirty}function _(e,t,i,r,n,s){if(n){const o=d(t,i,r,s);e.p(o,n)}}function g(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let e=0;e<i;e++)t[e]=-1;return t}return-1}function v(e){return null==e?"":e}function y(e,t){e.appendChild(t)}function m(e,t,i){e.insertBefore(t,i||null)}function S(e){e.parentNode&&e.parentNode.removeChild(e)}function w(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function b(e){return document.createElement(e)}function E(e){return document.createTextNode(e)}function C(){return E(" ")}function k(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function L(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function R(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function D(e,t,i,r){null===i?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}function x(e){a=e}function A(){if(!a)throw new Error("Function called outside component initialization");return a}function T(e){A().$$.on_mount.push(e)}function I(e){A().$$.on_destroy.push(e)}const O=[],B=[],F=[],M=[],P=Promise.resolve();let N=!1;function U(e){F.push(e)}const H=new Set;let j=0;function z(){if(0!==j)return;const e=a;do{try{for(;j<O.length;){const e=O[j];j++,x(e),$(e.$$)}}catch(e){throw O.length=0,j=0,e}for(x(null),O.length=0,j=0;B.length;)B.pop()();for(let e=0;e<F.length;e+=1){const t=F[e];H.has(t)||(H.add(t),t())}F.length=0}while(O.length);for(;M.length;)M.pop()();N=!1,H.clear(),x(e)}function $(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(U)}}const W=new Set;function q(e,t){e&&e.i&&(W.delete(e),e.i(t))}function K(e,t,i,r){if(e&&e.o){if(W.has(e))return;W.add(e),undefined.c.push((()=>{W.delete(e),r&&(i&&e.d(1),r())})),e.o(t)}else r&&r()}function V(e){e&&e.c()}function X(e,i,s,o){const{fragment:a,after_update:c}=e.$$;a&&a.m(i,s),o||U((()=>{const i=e.$$.on_mount.map(t).filter(n);e.$$.on_destroy?e.$$.on_destroy.push(...i):r(i),e.$$.on_mount=[]})),c.forEach(U)}function Y(e,t){const i=e.$$;null!==i.fragment&&(r(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function Z(e,t){-1===e.$$.dirty[0]&&(O.push(e),N||(N=!0,P.then(z)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function G(t,n,s,o,c,h,l,u=[-1]){const f=a;x(t);const d=t.$$={fragment:null,ctx:[],props:h,update:e,not_equal:c,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(f?f.$$.context:[])),callbacks:i(),dirty:u,skip_bound:!1,root:n.target||f.$$.root};l&&l(d.root);let p=!1;if(d.ctx=s?s(t,n.props||{},((e,i,...r)=>{const n=r.length?r[0]:i;return d.ctx&&c(d.ctx[e],d.ctx[e]=n)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](n),p&&Z(t,e)),i})):[],d.update(),p=!0,r(d.before_update),d.fragment=!!o&&o(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(S)}else d.fragment&&d.fragment.c();n.intro&&q(t.$$.fragment),X(t,n.target,n.anchor,n.customElement),z()}x(f)}class J{$destroy(){Y(this,1),this.$destroy=e}$on(t,i){if(!n(i))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const e=r.indexOf(i);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Q(t){let i,r;return{c(){i=b("div"),r=b("canvas"),L(i,"class","background svelte-1krmnll")},m(e,n){m(e,i,n),y(i,r),t[1](r)},p:e,i:e,o:e,d(e){e&&S(i),t[1](null)}}}function ee(e,t,i){const r="#d4d4d4",n=2,s=48,o=10;let a;function c(){i(0,a.width=window.innerWidth,a),i(0,a.height=window.innerHeight,a),function(){let e=a.getContext("2d");e.beginPath(),e.rect(0,0,a.width,a.height),e.fillStyle="white",e.fill(),e.fillStyle=r;for(let t=o;t<=a.width;t+=s)for(let i=o;i<=a.height;i+=s)e.beginPath(),e.arc(t,i,n,0,2*Math.PI),e.fill()}()}return T((()=>{window.addEventListener("resize",c),c()})),I((()=>{window.removeEventListener("resize",c)})),[a,function(e){B[e?"unshift":"push"]((()=>{a=e,i(0,a)}))}]}class te extends J{constructor(e){super(),G(this,e,ee,Q,s,{})}}function ie(t){let i,r,n,s,o,a,h,l,u,f,d,p,_;return{c(){i=b("div"),r=b("div"),n=b("img"),o=C(),a=b("div"),h=b("div"),l=E(t[2]),u=C(),f=b("div"),d=E(t[3]),c(n.src,s=t[0])||L(n,"src",s),L(n,"alt","icon"),L(n,"class","icon-image svelte-1pjc87j"),L(r,"class","svelte-1pjc87j"),L(h,"class","display-name svelte-1pjc87j"),L(f,"class","username svelte-1pjc87j"),L(a,"class","profile-info svelte-1pjc87j"),L(i,"class","contact-card svelte-1pjc87j")},m(e,s){m(e,i,s),y(i,r),y(r,n),y(i,o),y(i,a),y(a,h),y(h,l),y(a,u),y(a,f),y(f,d),p||(_=k(i,"click",t[4]),p=!0)},p(e,[t]){1&t&&!c(n.src,s=e[0])&&L(n,"src",s),4&t&&R(l,e[2]),8&t&&R(d,e[3])},i:e,o:e,d(e){e&&S(i),p=!1,_()}}}function re(e,t,i){let{iconImageURL:r}=t,{targetURL:n}=t,{title:s}=t,{subtitle:o}=t;return e.$$set=e=>{"iconImageURL"in e&&i(0,r=e.iconImageURL),"targetURL"in e&&i(1,n=e.targetURL),"title"in e&&i(2,s=e.title),"subtitle"in e&&i(3,o=e.subtitle)},[r,n,s,o,()=>{window.location.href=n}]}class ne extends J{constructor(e){super(),G(this,e,re,ie,s,{iconImageURL:0,targetURL:1,title:2,subtitle:3})}}function se(e){let t,i;const r=e[1].default,n=f(r,e,e[0],null);return{c(){t=b("div"),n&&n.c(),L(t,"class","container svelte-q4nibd")},m(e,r){m(e,t,r),n&&n.m(t,null),i=!0},p(e,[t]){n&&n.p&&(!i||1&t)&&_(n,r,e,e[0],i?p(r,e[0],t,null):g(e[0]),null)},i(e){i||(q(n,e),i=!0)},o(e){K(n,e),i=!1},d(e){e&&S(t),n&&n.d(e)}}}function oe(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=e=>{"$$scope"in e&&i(0,n=e.$$scope)},[n,r]}class ae extends J{constructor(e){super(),G(this,e,oe,se,s,{})}}function ce(e,t,i){const r=e.slice();return r[6]=t[i],r}function he(e,t,i){const r=e.slice();return r[9]=t[i],r}function le(e){let t,i,r=e[9]+"";return{c(){t=b("span"),i=E(r),L(t,"class","tag svelte-188jmbk"),D(t,"background-color",e[0][e[9].toLowerCase()]??e[1])},m(e,r){m(e,t,r),y(t,i)},p(e,n){4&n&&r!==(r=e[9]+"")&&R(i,r),7&n&&D(t,"background-color",e[0][e[9].toLowerCase()]??e[1])},d(e){e&&S(t)}}}function ue(e){let t,i,r,n,s,o,a,c,h,l,u,f,d,p,_,g,v,x,A,T,I,O,B,F,M,P,N=e[6].isFolder?"folder_open":"description",U=e[6].displayName+"",H=e[6].fileName+"",j=e[6].year+"",z=e[6].description+"",$=e[6].tags,W=[];for(let t=0;t<$.length;t+=1)W[t]=le(he(e,$,t));function q(){return e[4](e[6])}return{c(){t=b("tr"),i=b("td"),r=b("span"),n=E(N),s=C(),o=b("td"),a=b("div"),c=b("span"),h=E(U),l=C(),u=b("span"),f=E(H),d=C(),p=b("td"),_=E(j),g=C(),v=b("td"),x=b("div"),A=b("span"),T=E(z),I=C(),O=b("td"),B=b("div");for(let e=0;e<W.length;e+=1)W[e].c();F=C(),L(r,"class","material-symbols-outlined svelte-188jmbk"),L(i,"class","icon svelte-188jmbk"),L(c,"class","file-display-name svelte-188jmbk"),D(c,"font-size",de(e[6].displayName)),L(u,"class","file-name svelte-188jmbk"),L(a,"class","file-info svelte-188jmbk"),L(o,"class","svelte-188jmbk"),L(p,"class","svelte-188jmbk"),L(A,"class","desc-text svelte-188jmbk"),L(x,"class","vcenter svelte-188jmbk"),L(v,"class","description svelte-188jmbk"),L(B,"class","tags"),L(O,"class","svelte-188jmbk"),L(t,"class","file-row svelte-188jmbk")},m(e,S){m(e,t,S),y(t,i),y(i,r),y(r,n),y(t,s),y(t,o),y(o,a),y(a,c),y(c,h),y(a,l),y(a,u),y(u,f),y(t,d),y(t,p),y(p,_),y(t,g),y(t,v),y(v,x),y(x,A),y(A,T),y(t,I),y(t,O),y(O,B);for(let e=0;e<W.length;e+=1)W[e].m(B,null);y(t,F),M||(P=k(t,"click",q),M=!0)},p(t,i){if(e=t,4&i&&N!==(N=e[6].isFolder?"folder_open":"description")&&R(n,N),4&i&&U!==(U=e[6].displayName+"")&&R(h,U),4&i&&D(c,"font-size",de(e[6].displayName)),4&i&&H!==(H=e[6].fileName+"")&&R(f,H),4&i&&j!==(j=e[6].year+"")&&R(_,j),4&i&&z!==(z=e[6].description+"")&&R(T,z),7&i){let t;for($=e[6].tags,t=0;t<$.length;t+=1){const r=he(e,$,t);W[t]?W[t].p(r,i):(W[t]=le(r),W[t].c(),W[t].m(B,null))}for(;t<W.length;t+=1)W[t].d(1);W.length=$.length}},d(e){e&&S(t),w(W,e),M=!1,P()}}}function fe(t){let i,r,n,s,o,a=t[2],c=[];for(let e=0;e<a.length;e+=1)c[e]=ue(ce(t,a,e));return{c(){i=b("table"),r=b("tr"),r.innerHTML='<th style="width: 5%" class="svelte-188jmbk"></th> \n        <th style="width: 15%" class="svelte-188jmbk">Name</th> \n        <th style="width: 6%" class="svelte-188jmbk">Year</th> \n        <th style="width: 45%" class="svelte-188jmbk">Description</th> \n        <th class="svelte-188jmbk">Tags</th>',n=C(),s=b("tr"),o=C();for(let e=0;e<c.length;e+=1)c[e].c();L(s,"class","spacer svelte-188jmbk"),L(i,"class","svelte-188jmbk")},m(e,t){m(e,i,t),y(i,r),y(i,n),y(i,s),y(i,o);for(let e=0;e<c.length;e+=1)c[e].m(i,null)},p(e,[t]){if(15&t){let r;for(a=e[2],r=0;r<a.length;r+=1){const n=ce(e,a,r);c[r]?c[r].p(n,t):(c[r]=ue(n),c[r].c(),c[r].m(i,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=a.length}},i:e,o:e,d(e){e&&S(i),w(c,e)}}}function de(e){return e.length<=20?"11pt":e.length<=30?"9pt":e.length<=40?"7pt":"6pt"}function pe(e,t,i){let{tagColors:r}=t,{tagColorDefault:n}=t,{files:s}=t,{onClick:o}=t;return e.$$set=e=>{"tagColors"in e&&i(0,r=e.tagColors),"tagColorDefault"in e&&i(1,n=e.tagColorDefault),"files"in e&&i(2,s=e.files),"onClick"in e&&i(3,o=e.onClick)},[r,n,s,o,e=>{o(e)}]}class _e extends J{constructor(e){super(),G(this,e,pe,fe,s,{tagColors:0,tagColorDefault:1,files:2,onClick:3})}}function ge(t){let i,r,n,s,o,a,c,h,l;return a=new _e({props:{files:ye.map(t[1]),tagColors:t[0],tagColorDefault:me,onClick:t[2]}}),{c(){i=b("div"),r=b("span"),r.textContent="projects/",n=C(),s=b("hr"),o=C(),V(a.$$.fragment),c=C(),h=b("div"),L(r,"class","section-header svelte-ddb75o"),L(s,"class","svelte-ddb75o"),D(h,"height","20px"),L(i,"class","main svelte-ddb75o")},m(e,t){m(e,i,t),y(i,r),y(i,n),y(i,s),y(i,o),X(a,i,null),y(i,c),y(i,h),l=!0},p:e,i(e){l||(q(a.$$.fragment,e),l=!0)},o(e){K(a.$$.fragment,e),l=!1},d(e){e&&S(i),Y(a)}}}function ve(e){return{displayName:e.name,fileName:e.name.toLowerCase().replace(" ","_").replace("-","_")+".proj",isFolder:!0,tags:e.tags,year:e.year,description:e.description}}const ye=[{name:"Oui-Eat",tags:["React Native","Java","MongoDB","UofT"],year:2022,description:"A combined social media app and crowd-sourced review platform for restaurants and other food businesses.",link:"https://github.com/iahuang/oui-eat"},{name:"NeX",tags:["Node","Typescript","LaTeX"],year:2022,description:"A custom-built markup language designed for efficient note-taking and drafting math and computer science-related documents.",link:"https://github.com/nex-project/nex"},{name:"CoVariant",tags:["Python","Deep Learning","UofT"],year:2021,description:"Machine learning project for determining the impact of various demographic factors in the outcome of COVID-19.",link:"https://github.com/iahuang/covariant"},{name:"Theta",tags:["Python","Algorithm Analyis"],year:2021,description:"A multi-variable time complexity analysis library written in Python",link:"https://github.com/iahuang/theta"},{name:"Taro",tags:["Typescript","HTML/CSS"],year:2020,description:"A modern web framework inspired by Svelte and ReactJS.",link:"https://github.com/iahuang/taro"},{name:"JAtari",tags:["Java"],description:"A work-in-progress Atari 2600 emulator written in Java.",year:2018,link:"https://github.com/iahuang/JAtari"}],me="#a6a6a6";function Se(e){return[{typescript:"#2F73BF",python:"#f8ae26",azure:"#0285D0",node:"#7EC728",java:"#E01F22","html/css":"#E36028",uoft:"#012B64",mongodb:"#04AB4E"},e=>ve(e),e=>{let t=ye.find((t=>t.name===e.displayName));window.location.href=t.link}]}class we extends J{constructor(e){super(),G(this,e,Se,ge,s,{})}}const be=[];function Ee(t,i=e){let r;const n=new Set;function o(e){if(s(t,e)&&(t=e,r)){const e=!be.length;for(const e of n)e[1](),be.push(e,t);if(e){for(let e=0;e<be.length;e+=2)be[e][0](be[e+1]);be.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(s,a=e){const c=[s,a];return n.add(c),1===n.size&&(r=i(o)||e),s(t),()=>{n.delete(c),0===n.size&&(r(),r=null)}}}}const Ce=Ee(0),ke=Ee(0),Le=Ee([]),Re=Ee(!1),De=Ee(null);function xe(e,t,i){const r=e.slice();return r[6]=t[i],r}function Ae(e){let t,i,r,n,s,o,a,c,h,l=e[6].getTitle()+"";function u(){return e[3](e[6])}return{c(){t=b("div"),i=b("span"),r=b("span"),n=E(l),s=C(),o=b("span"),o.textContent="web_asset",a=C(),L(o,"class","material-symbols-outlined window-icon svelte-910qd7"),L(i,"class","minimized-window svelte-910qd7"),L(t,"class","status-item svelte-910qd7")},m(e,l){m(e,t,l),y(t,i),y(i,r),y(r,n),y(i,s),y(i,o),y(t,a),c||(h=k(i,"click",u),c=!0)},p(t,i){e=t,4&i&&l!==(l=e[6].getTitle()+"")&&R(n,l)},d(e){e&&S(t),c=!1,h()}}}function Te(t){let i,r,n,s,o,a,c,h,l,u,f,d,p,_=Oe(t[0])+"",g=Ie(t[0])+"",v=t[2],k=[];for(let e=0;e<v.length;e+=1)k[e]=Ae(xe(t,v,e));return{c(){i=b("div"),r=b("span");for(let e=0;e<k.length;e+=1)k[e].c();n=C(),s=b("span"),o=b("div"),o.innerHTML='<span class="material-symbols-outlined" style="font-size: 14pt">bluetooth</span>',a=C(),c=b("div"),c.innerHTML='<span class="material-symbols-outlined" style="font-size: 14pt">wifi</span>',h=C(),l=b("div"),u=E(_),f=C(),d=b("div"),p=E(g),L(r,"class","status-items left svelte-910qd7"),L(o,"class","status-item svelte-910qd7"),L(c,"class","status-item svelte-910qd7"),L(l,"class","status-item svelte-910qd7"),L(d,"class","status-item svelte-910qd7"),L(s,"class","status-items right svelte-910qd7"),L(i,"class","status-bar svelte-910qd7")},m(e,_){m(e,i,_),y(i,r);for(let e=0;e<k.length;e+=1)k[e].m(r,null);y(i,n),y(i,s),y(s,o),y(s,a),y(s,c),y(s,h),y(s,l),y(l,u),y(s,f),y(s,d),y(d,p),t[4](i)},p(e,[t]){if(4&t){let i;for(v=e[2],i=0;i<v.length;i+=1){const n=xe(e,v,i);k[i]?k[i].p(n,t):(k[i]=Ae(n),k[i].c(),k[i].m(r,null))}for(;i<k.length;i+=1)k[i].d(1);k.length=v.length}1&t&&_!==(_=Oe(e[0])+"")&&R(u,_),1&t&&g!==(g=Ie(e[0])+"")&&R(p,g)},i:e,o:e,d(e){e&&S(i),w(k,e),t[4](null)}}}function Ie(e){let t=e.getHours(),i=e.getMinutes(),r=t>=12?"PM":"AM";return t%=12,t=t||12,t+":"+(i<10?"0"+i:i)+" "+r}function Oe(e){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()]+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getDate()}function Be(e,t,i){let r,n,s=new Date;T((()=>{r=window.setInterval((()=>{i(0,s=new Date)}),1e3),ke.set(n.offsetHeight)})),I((()=>{clearInterval(r)}));let o=[];Le.subscribe((e=>{i(2,o=e)}));return[s,n,o,e=>{e.show(),e.focus(),function(e){Le.update((t=>t.filter((t=>t.getWindowID()!==e.getWindowID()))))}(e)},function(e){B[e?"unshift":"push"]((()=>{n=e,i(1,n)}))}]}class Fe extends J{constructor(e){super(),G(this,e,Be,Te,s,{})}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Pe(e){var t={exports:{}};return e(t,t.exports),t.exports}var Ne=Pe((function(e,t){var i;i=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){(function(e,r,n,s){Object.defineProperty(t,"__esModule",{value:!0});var o,a=i(2),c=i(9);!function(e){e[e.EPERM=1]="EPERM",e[e.ENOENT=2]="ENOENT",e[e.EIO=5]="EIO",e[e.EBADF=9]="EBADF",e[e.EACCES=13]="EACCES",e[e.EBUSY=16]="EBUSY",e[e.EEXIST=17]="EEXIST",e[e.ENOTDIR=20]="ENOTDIR",e[e.EISDIR=21]="EISDIR",e[e.EINVAL=22]="EINVAL",e[e.EFBIG=27]="EFBIG",e[e.ENOSPC=28]="ENOSPC",e[e.EROFS=30]="EROFS",e[e.ENOTEMPTY=39]="ENOTEMPTY",e[e.ENOTSUP=95]="ENOTSUP"}(o||(o={}));var h={};h[o.EPERM]="Operation not permitted.",h[o.ENOENT]="No such file or directory.",h[o.EIO]="Input/output error.",h[o.EBADF]="Bad file descriptor.",h[o.EACCES]="Permission denied.",h[o.EBUSY]="Resource busy or locked.",h[o.EEXIST]="File exists.",h[o.ENOTDIR]="File is not a directory.",h[o.EISDIR]="File is a directory.",h[o.EINVAL]="Invalid argument.",h[o.EFBIG]="File is too big.",h[o.ENOSPC]="No space left on disk.",h[o.EROFS]="Cannot modify a read-only file system.",h[o.ENOTEMPTY]="Directory is not empty.",h[o.ENOTSUP]="Operation is not supported.";var l,u=function(t){function i(e,i,r){void 0===i&&(i=h[e]),t.call(this,i),this.syscall="",this.errno=e,this.code=o[e],this.path=r,this.stack=(new t).stack,this.message="Error: "+this.code+": "+i+(this.path?", '"+this.path+"'":"")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.fromJSON=function(e){var t=new i(0);return t.errno=e.errno,t.code=e.code,t.path=e.path,t.stack=e.stack,t.message=e.message,t},i.fromBuffer=function(e,t){return void 0===t&&(t=0),i.fromJSON(JSON.parse(e.toString("utf8",t+4,t+4+e.readUInt32LE(t))))},i.FileError=function(e,t){return new i(e,h[e],t)},i.ENOENT=function(e){return this.FileError(o.ENOENT,e)},i.EEXIST=function(e){return this.FileError(o.EEXIST,e)},i.EISDIR=function(e){return this.FileError(o.EISDIR,e)},i.ENOTDIR=function(e){return this.FileError(o.ENOTDIR,e)},i.EPERM=function(e){return this.FileError(o.EPERM,e)},i.ENOTEMPTY=function(e){return this.FileError(o.ENOTEMPTY,e)},i.prototype.toString=function(){return this.message},i.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},i.prototype.writeToBuffer=function(t,i){void 0===t&&(t=e.alloc(this.bufferSize())),void 0===i&&(i=0);var r=t.write(JSON.stringify(this.toJSON()),i+4);return t.writeUInt32LE(r,i),t},i.prototype.bufferSize=function(){return 4+e.byteLength(JSON.stringify(this.toJSON()))},i}(Error),f=Object.freeze({get ErrorCode(){return o},ErrorStrings:h,ApiError:u});!function(e){e[e.NOP=0]="NOP",e[e.THROW_EXCEPTION=1]="THROW_EXCEPTION",e[e.TRUNCATE_FILE=2]="TRUNCATE_FILE",e[e.CREATE_FILE=3]="CREATE_FILE"}(l||(l={}));var d,p=function e(t){if(this.flagStr=t,e.validFlagStrs.indexOf(t)<0)throw new u(o.EINVAL,"Invalid flag: "+t)};p.getFileFlag=function(e){return p.flagCache.hasOwnProperty(e)?p.flagCache[e]:p.flagCache[e]=new p(e)},p.prototype.getFlagString=function(){return this.flagStr},p.prototype.isReadable=function(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")},p.prototype.isWriteable=function(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")},p.prototype.isTruncating=function(){return-1!==this.flagStr.indexOf("w")},p.prototype.isAppendable=function(){return-1!==this.flagStr.indexOf("a")},p.prototype.isSynchronous=function(){return-1!==this.flagStr.indexOf("s")},p.prototype.isExclusive=function(){return-1!==this.flagStr.indexOf("x")},p.prototype.pathExistsAction=function(){return this.isExclusive()?l.THROW_EXCEPTION:this.isTruncating()?l.TRUNCATE_FILE:l.NOP},p.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?l.CREATE_FILE:l.THROW_EXCEPTION},p.flagCache={},p.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],function(e){e[e.FILE=32768]="FILE",e[e.DIRECTORY=16384]="DIRECTORY",e[e.SYMLINK=40960]="SYMLINK"}(d||(d={}));var _=function(e,t,i,r,n,s){if(void 0===r&&(r=new Date),void 0===n&&(n=new Date),void 0===s&&(s=new Date),this.size=t,this.atime=r,this.mtime=n,this.ctime=s,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.fileData=null,i)this.mode=i;else switch(e){case d.FILE:this.mode=420;break;case d.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(t/512),this.mode<4096&&(this.mode|=e)};_.fromBuffer=function(e){var t=e.readUInt32LE(0),i=e.readUInt32LE(4),r=e.readDoubleLE(8),n=e.readDoubleLE(16),s=e.readDoubleLE(24);return new _(61440&i,t,4095&i,new Date(r),new Date(n),new Date(s))},_.prototype.toBuffer=function(){var t=e.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t},_.prototype.clone=function(){return new _(61440&this.mode,this.size,4095&this.mode,this.atime,this.mtime,this.ctime)},_.prototype.isFile=function(){return(61440&this.mode)===d.FILE},_.prototype.isDirectory=function(){return(61440&this.mode)===d.DIRECTORY},_.prototype.isSymbolicLink=function(){return(61440&this.mode)===d.SYMLINK},_.prototype.chmod=function(e){this.mode=61440&this.mode|e},_.prototype.isSocket=function(){return!1},_.prototype.isBlockDevice=function(){return!1},_.prototype.isCharacterDevice=function(){return!1},_.prototype.isFIFO=function(){return!1};var g=function(e,t){return e};function v(e){if(e)return e;throw new u(o.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function y(e,t){switch(typeof e){case"number":return e;case"string":var i=parseInt(e,8);return isNaN(i)?t:i;default:return t}}function m(e){if(e instanceof Date)return e;if("number"==typeof e)return new Date(1e3*e);throw new u(o.EINVAL,"Invalid time.")}function S(e){if(e.indexOf("\0")>=0)throw new u(o.EINVAL,"Path must be a string without null bytes.");if(""===e)throw new u(o.EINVAL,"Path must not be empty.");return c.resolve(e)}function w(e,t,i,r){switch(typeof e){case"object":return{encoding:void 0!==e.encoding?e.encoding:t,flag:void 0!==e.flag?e.flag:i,mode:y(e.mode,r)};case"string":return{encoding:e,flag:i,mode:r};default:return{encoding:t,flag:i,mode:r}}}function b(){}var E=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};E.prototype.initialize=function(e){if(!e.constructor.isAvailable())throw new u(o.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=e},E.prototype._toUnixTimestamp=function(e){if("number"==typeof e)return e;if(e instanceof Date)return e.getTime()/1e3;throw new Error("Cannot parse time: "+e)},E.prototype.getRootFS=function(){return this.root?this.root:null},E.prototype.rename=function(e,t,i){void 0===i&&(i=b);var r=g(i,1);try{v(this.root).rename(S(e),S(t),r)}catch(e){r(e)}},E.prototype.renameSync=function(e,t){v(this.root).renameSync(S(e),S(t))},E.prototype.exists=function(e,t){void 0===t&&(t=b);var i=g(t,1);try{return v(this.root).exists(S(e),i)}catch(e){return i(!1)}},E.prototype.existsSync=function(e){try{return v(this.root).existsSync(S(e))}catch(e){return!1}},E.prototype.stat=function(e,t){void 0===t&&(t=b);var i=g(t,2);try{return v(this.root).stat(S(e),!1,i)}catch(e){return i(e)}},E.prototype.statSync=function(e){return v(this.root).statSync(S(e),!1)},E.prototype.lstat=function(e,t){void 0===t&&(t=b);var i=g(t,2);try{return v(this.root).stat(S(e),!0,i)}catch(e){return i(e)}},E.prototype.lstatSync=function(e){return v(this.root).statSync(S(e),!0)},E.prototype.truncate=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=b);var r=0;"function"==typeof t?i=t:"number"==typeof t&&(r=t);var n=g(i,1);try{if(r<0)throw new u(o.EINVAL);return v(this.root).truncate(S(e),r,n)}catch(e){return n(e)}},E.prototype.truncateSync=function(e,t){if(void 0===t&&(t=0),t<0)throw new u(o.EINVAL);return v(this.root).truncateSync(S(e),t)},E.prototype.unlink=function(e,t){void 0===t&&(t=b);var i=g(t,1);try{return v(this.root).unlink(S(e),i)}catch(e){return i(e)}},E.prototype.unlinkSync=function(e){return v(this.root).unlinkSync(S(e))},E.prototype.open=function(e,t,i,r){var n=this;void 0===r&&(r=b);var s=y(i,420),o=g(r="function"==typeof i?i:r,2);try{v(this.root).open(S(e),p.getFileFlag(t),s,(function(e,t){t?o(e,n.getFdForFile(t)):o(e)}))}catch(e){o(e)}},E.prototype.openSync=function(e,t,i){return void 0===i&&(i=420),this.getFdForFile(v(this.root).openSync(S(e),p.getFileFlag(t),y(i,420)))},E.prototype.readFile=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i=b);var r=w(t,null,"r",null),n=g(i="function"==typeof t?t:i,2);try{var s=p.getFileFlag(r.flag);return s.isReadable()?v(this.root).readFile(S(e),r.encoding,s,n):n(new u(o.EINVAL,"Flag passed to readFile must allow for reading."))}catch(e){return n(e)}},E.prototype.readFileSync=function(e,t){void 0===t&&(t={});var i=w(t,null,"r",null),r=p.getFileFlag(i.flag);if(!r.isReadable())throw new u(o.EINVAL,"Flag passed to readFile must allow for reading.");return v(this.root).readFileSync(S(e),i.encoding,r)},E.prototype.writeFile=function(e,t,i,r){void 0===i&&(i={}),void 0===r&&(r=b);var n=w(i,"utf8","w",420),s=g(r="function"==typeof i?i:r,1);try{var a=p.getFileFlag(n.flag);return a.isWriteable()?v(this.root).writeFile(S(e),t,n.encoding,a,n.mode,s):s(new u(o.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(e){return s(e)}},E.prototype.writeFileSync=function(e,t,i){var r=w(i,"utf8","w",420),n=p.getFileFlag(r.flag);if(!n.isWriteable())throw new u(o.EINVAL,"Flag passed to writeFile must allow for writing.");return v(this.root).writeFileSync(S(e),t,r.encoding,n,r.mode)},E.prototype.appendFile=function(e,t,i,r){void 0===r&&(r=b);var n=w(i,"utf8","a",420),s=g(r="function"==typeof i?i:r,1);try{var a=p.getFileFlag(n.flag);if(!a.isAppendable())return s(new u(o.EINVAL,"Flag passed to appendFile must allow for appending."));v(this.root).appendFile(S(e),t,n.encoding,a,n.mode,s)}catch(e){s(e)}},E.prototype.appendFileSync=function(e,t,i){var r=w(i,"utf8","a",420),n=p.getFileFlag(r.flag);if(!n.isAppendable())throw new u(o.EINVAL,"Flag passed to appendFile must allow for appending.");return v(this.root).appendFileSync(S(e),t,r.encoding,n,r.mode)},E.prototype.fstat=function(e,t){void 0===t&&(t=b);var i=g(t,2);try{this.fd2file(e).stat(i)}catch(e){i(e)}},E.prototype.fstatSync=function(e){return this.fd2file(e).statSync()},E.prototype.close=function(e,t){var i=this;void 0===t&&(t=b);var r=g(t,1);try{this.fd2file(e).close((function(t){t||i.closeFd(e),r(t)}))}catch(e){r(e)}},E.prototype.closeSync=function(e){this.fd2file(e).closeSync(),this.closeFd(e)},E.prototype.ftruncate=function(e,t,i){void 0===i&&(i=b);var r="number"==typeof t?t:0,n=g(i="function"==typeof t?t:i,1);try{var s=this.fd2file(e);if(r<0)throw new u(o.EINVAL);s.truncate(r,n)}catch(e){n(e)}},E.prototype.ftruncateSync=function(e,t){void 0===t&&(t=0);var i=this.fd2file(e);if(t<0)throw new u(o.EINVAL);i.truncateSync(t)},E.prototype.fsync=function(e,t){void 0===t&&(t=b);var i=g(t,1);try{this.fd2file(e).sync(i)}catch(e){i(e)}},E.prototype.fsyncSync=function(e){this.fd2file(e).syncSync()},E.prototype.fdatasync=function(e,t){void 0===t&&(t=b);var i=g(t,1);try{this.fd2file(e).datasync(i)}catch(e){i(e)}},E.prototype.fdatasyncSync=function(e){this.fd2file(e).datasyncSync()},E.prototype.write=function(t,i,r,n,s,a){void 0===a&&(a=b);var c,h,l,f=null;if("string"==typeof i){var d="utf8";switch(typeof r){case"function":a=r;break;case"number":f=r,d="string"==typeof n?n:"utf8",a="function"==typeof s?s:a;break;default:return(a="function"==typeof n?n:"function"==typeof s?s:a)(new u(o.EINVAL,"Invalid arguments."))}h=0,l=(c=e.from(i,d)).length}else c=i,h=r,l=n,f="number"==typeof s?s:null,a="function"==typeof s?s:a;var p=g(a,3);try{var _=this.fd2file(t);null==f&&(f=_.getPos()),_.write(c,h,l,f,p)}catch(e){p(e)}},E.prototype.writeSync=function(t,i,r,n,s){var o,a,c,h=0;if("string"==typeof i){c="number"==typeof r?r:null;var l="string"==typeof n?n:"utf8";h=0,a=(o=e.from(i,l)).length}else o=i,h=r,a=n,c="number"==typeof s?s:null;var u=this.fd2file(t);return null==c&&(c=u.getPos()),u.writeSync(o,h,a,c)},E.prototype.read=function(t,i,r,n,s,o){var a,c,h,l,u;if(void 0===o&&(o=b),"number"==typeof i){h=i,a=r;var f=n;o="function"==typeof s?s:o,c=0,l=e.alloc(h),u=g((function(e,t,i){if(e)return o(e);o(e,i.toString(f),t)}),3)}else l=i,c=r,h=n,a=s,u=g(o,3);try{var d=this.fd2file(t);null==a&&(a=d.getPos()),d.read(l,c,h,a,u)}catch(e){u(e)}},E.prototype.readSync=function(t,i,r,n,s){var o,a,c,h,l=!1,u="utf8";"number"==typeof i?(c=i,h=r,u=n,a=0,o=e.alloc(c),l=!0):(o=i,a=r,c=n,h=s);var f=this.fd2file(t);null==h&&(h=f.getPos());var d=f.readSync(o,a,c,h);return l?[o.toString(u),d]:d},E.prototype.fchown=function(e,t,i,r){void 0===r&&(r=b);var n=g(r,1);try{this.fd2file(e).chown(t,i,n)}catch(e){n(e)}},E.prototype.fchownSync=function(e,t,i){this.fd2file(e).chownSync(t,i)},E.prototype.fchmod=function(e,t,i){var r=g(i,1);try{var n="string"==typeof t?parseInt(t,8):t;this.fd2file(e).chmod(n,r)}catch(e){r(e)}},E.prototype.fchmodSync=function(e,t){var i="string"==typeof t?parseInt(t,8):t;this.fd2file(e).chmodSync(i)},E.prototype.futimes=function(e,t,i,r){void 0===r&&(r=b);var n=g(r,1);try{var s=this.fd2file(e);"number"==typeof t&&(t=new Date(1e3*t)),"number"==typeof i&&(i=new Date(1e3*i)),s.utimes(t,i,n)}catch(e){n(e)}},E.prototype.futimesSync=function(e,t,i){this.fd2file(e).utimesSync(m(t),m(i))},E.prototype.rmdir=function(e,t){void 0===t&&(t=b);var i=g(t,1);try{e=S(e),v(this.root).rmdir(e,i)}catch(e){i(e)}},E.prototype.rmdirSync=function(e){return e=S(e),v(this.root).rmdirSync(e)},E.prototype.mkdir=function(e,t,i){void 0===i&&(i=b),"function"==typeof t&&(i=t,t=511);var r=g(i,1);try{e=S(e),v(this.root).mkdir(e,t,r)}catch(e){r(e)}},E.prototype.mkdirSync=function(e,t){v(this.root).mkdirSync(S(e),y(t,511))},E.prototype.readdir=function(e,t){void 0===t&&(t=b);var i=g(t,2);try{e=S(e),v(this.root).readdir(e,i)}catch(e){i(e)}},E.prototype.readdirSync=function(e){return e=S(e),v(this.root).readdirSync(e)},E.prototype.link=function(e,t,i){void 0===i&&(i=b);var r=g(i,1);try{e=S(e),t=S(t),v(this.root).link(e,t,r)}catch(e){r(e)}},E.prototype.linkSync=function(e,t){return e=S(e),t=S(t),v(this.root).linkSync(e,t)},E.prototype.symlink=function(e,t,i,r){void 0===r&&(r=b);var n="string"==typeof i?i:"file",s=g(r="function"==typeof i?i:r,1);try{if("file"!==n&&"dir"!==n)return s(new u(o.EINVAL,"Invalid type: "+n));e=S(e),t=S(t),v(this.root).symlink(e,t,n,s)}catch(e){s(e)}},E.prototype.symlinkSync=function(e,t,i){if(i){if("file"!==i&&"dir"!==i)throw new u(o.EINVAL,"Invalid type: "+i)}else i="file";return e=S(e),t=S(t),v(this.root).symlinkSync(e,t,i)},E.prototype.readlink=function(e,t){void 0===t&&(t=b);var i=g(t,2);try{e=S(e),v(this.root).readlink(e,i)}catch(e){i(e)}},E.prototype.readlinkSync=function(e){return e=S(e),v(this.root).readlinkSync(e)},E.prototype.chown=function(e,t,i,r){void 0===r&&(r=b);var n=g(r,1);try{e=S(e),v(this.root).chown(e,!1,t,i,n)}catch(e){n(e)}},E.prototype.chownSync=function(e,t,i){e=S(e),v(this.root).chownSync(e,!1,t,i)},E.prototype.lchown=function(e,t,i,r){void 0===r&&(r=b);var n=g(r,1);try{e=S(e),v(this.root).chown(e,!0,t,i,n)}catch(e){n(e)}},E.prototype.lchownSync=function(e,t,i){e=S(e),v(this.root).chownSync(e,!0,t,i)},E.prototype.chmod=function(e,t,i){void 0===i&&(i=b);var r=g(i,1);try{var n=y(t,-1);if(n<0)throw new u(o.EINVAL,"Invalid mode.");v(this.root).chmod(S(e),!1,n,r)}catch(e){r(e)}},E.prototype.chmodSync=function(e,t){var i=y(t,-1);if(i<0)throw new u(o.EINVAL,"Invalid mode.");e=S(e),v(this.root).chmodSync(e,!1,i)},E.prototype.lchmod=function(e,t,i){void 0===i&&(i=b);var r=g(i,1);try{var n=y(t,-1);if(n<0)throw new u(o.EINVAL,"Invalid mode.");v(this.root).chmod(S(e),!0,n,r)}catch(e){r(e)}},E.prototype.lchmodSync=function(e,t){var i=y(t,-1);if(i<1)throw new u(o.EINVAL,"Invalid mode.");v(this.root).chmodSync(S(e),!0,i)},E.prototype.utimes=function(e,t,i,r){void 0===r&&(r=b);var n=g(r,1);try{v(this.root).utimes(S(e),m(t),m(i),n)}catch(e){n(e)}},E.prototype.utimesSync=function(e,t,i){v(this.root).utimesSync(S(e),m(t),m(i))},E.prototype.realpath=function(e,t,i){void 0===i&&(i=b);var r="object"==typeof t?t:{},n=g(i="function"==typeof t?t:b,2);try{e=S(e),v(this.root).realpath(e,r,n)}catch(e){n(e)}},E.prototype.realpathSync=function(e,t){return void 0===t&&(t={}),e=S(e),v(this.root).realpathSync(e,t)},E.prototype.watchFile=function(e,t,i){throw new u(o.ENOTSUP)},E.prototype.unwatchFile=function(e,t){throw new u(o.ENOTSUP)},E.prototype.watch=function(e,t,i){throw new u(o.ENOTSUP)},E.prototype.access=function(e,t,i){throw new u(o.ENOTSUP)},E.prototype.accessSync=function(e,t){throw new u(o.ENOTSUP)},E.prototype.createReadStream=function(e,t){throw new u(o.ENOTSUP)},E.prototype.createWriteStream=function(e,t){throw new u(o.ENOTSUP)},E.prototype.wrapCallbacks=function(e){g=e},E.prototype.getFdForFile=function(e){var t=this.nextFd++;return this.fdMap[t]=e,t},E.prototype.fd2file=function(e){var t=this.fdMap[e];if(t)return t;throw new u(o.EBADF,"Invalid file descriptor.")},E.prototype.closeFd=function(e){delete this.fdMap[e]},E.Stats=_;var C=new E,k={},L=E.prototype;function R(e,t,i,r,n){return e<t||i<t?e>i?i+1:e+1:r===n?t:t+1}function D(e,t){if(e===t)return 0;if(e.length>t.length){var i=e;e=t,t=i}for(var r=e.length,n=t.length;r>0&&e.charCodeAt(r-1)===t.charCodeAt(n-1);)r--,n--;for(var s=0;s<r&&e.charCodeAt(s)===t.charCodeAt(s);)s++;if(n-=s,0==(r-=s)||1===n)return n;for(var o,a,c,h,l,u=new Array(r<<1),f=0;f<r;)u[r+f]=e.charCodeAt(s+f),u[f]=++f;for(o=0;o+3<n;)for(var d=t.charCodeAt(s+(a=o)),p=t.charCodeAt(s+(c=o+1)),_=t.charCodeAt(s+(h=o+2)),g=t.charCodeAt(s+(l=o+3)),v=o+=4,y=0;y<r;){var m=u[r+y],S=u[y];a=R(S,a,c,d,m),c=R(a,c,h,p,m),h=R(c,h,l,_,m),v=R(h,l,v,g,m),u[y++]=v,l=h,h=c,c=a,a=S}for(var w=0;o<n;){var b=t.charCodeAt(s+(a=o));w=++o;for(var E=0;E<r;E++){var C=u[E];u[E]=w=C<a||w<a?C>w?w+1:C+1:b===u[r+E]?a:a+1,a=C}}return w}function x(e,t,i){e&&console.warn("["+t+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '"+t+".Create("+JSON.stringify(i)+", callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")}Object.keys(L).forEach((function(e){"function"==typeof C[e]?k[e]=function(){return C[e].apply(C,arguments)}:k[e]=C[e]})),k.changeFSModule=function(e){C=e},k.getFSModule=function(){return C},k.FS=E;var A="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),T="undefined"==typeof window;function I(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function O(e,t,i){i.existsSync(e)||(O(c.dirname(e),t,i),i.mkdirSync(e,t))}function B(e){var t=F(e),i=t.byteOffset,r=t.byteLength;return 0===i&&r===t.buffer.byteLength?t.buffer:t.buffer.slice(i,i+r)}function F(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function M(t){return t instanceof e?t:t instanceof Uint8Array?P(t):e.from(t)}function P(t){return t instanceof e?t:0===t.byteOffset&&t.byteLength===t.buffer.byteLength?N(t.buffer):e.from(t.buffer,t.byteOffset,t.byteLength)}function N(t){return e.from(t)}function U(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=e.length),t<0||i<0||i>e.length||t>i)throw new TypeError("Invalid slice bounds on buffer of length "+e.length+": ["+t+", "+i+"]");if(0===e.length)return j();var r=F(e),n=e[0],s=(n+1)%255;return e[0]=s,r[0]===s?(r[0]=n,P(r.slice(t,i))):(e[0]=n,P(r.subarray(t,i)))}var H=null;function j(){return H||(H=e.alloc(0))}function z(t,i){e.isBuffer(t)?i():i(new u(o.EINVAL,"option must be a Buffer."))}function $(e,t,i){var r=e.Options,n=e.Name,s=0,a=!1,c=!1;function h(e){a||(e&&(a=!0,i(e)),0==--s&&c&&i())}var l=function(e){if(r.hasOwnProperty(e)){var c=r[e],l=t[e];if(null==l){if(!c.optional){var f=Object.keys(t).filter((function(e){return!(e in r)})).map((function(t){return{str:t,distance:D(e,t)}})).filter((function(e){return e.distance<5})).sort((function(e,t){return e.distance-t.distance}));return a?{}:(a=!0,{v:i(new u(o.EINVAL,"["+n+"] Required option '"+e+"' not provided."+(f.length>0?" You provided unrecognized option '"+f[0].str+"'; perhaps you meant to type '"+e+"'.":"")+"\nOption description: "+c.description))})}}else{if(!(Array.isArray(c.type)?-1!==c.type.indexOf(typeof l):typeof l===c.type))return a?{}:(a=!0,{v:i(new u(o.EINVAL,"["+n+"] Value provided for option "+e+" is not the proper type. Expected "+(Array.isArray(c.type)?"one of {"+c.type.join(", ")+"}":c.type)+", but received "+typeof l+"\nOption description: "+c.description))});c.validator&&(s++,c.validator(l,h))}}};for(var f in r){var d=l(f);if(d)return d.v}c=!0,0!==s||a||i()}var W=Object.freeze({deprecationMessage:x,isIE:A,isWebWorker:T,fail:I,mkdirpSync:O,buffer2ArrayBuffer:B,buffer2Uint8array:F,arrayish2Buffer:M,uint8Array2Buffer:P,arrayBuffer2Buffer:N,copyingSlice:U,emptyBuffer:j,bufferValidator:z,checkOptions:$}),q=function(e){this.fs=e,this.nodefs=e.getNodeFS(),this.FS=e.getFS(),this.PATH=e.getPATH(),this.ERRNO_CODES=e.getERRNO_CODES()};q.prototype.open=function(e){var t=this.fs.realPath(e.node),i=this.FS;try{i.isFile(e.node.mode)&&(e.nfd=this.nodefs.openSync(t,this.fs.flagsToPermissionString(e.flags)))}catch(e){if(!e.code)throw e;throw new i.ErrnoError(this.ERRNO_CODES[e.code])}},q.prototype.close=function(e){var t=this.FS;try{t.isFile(e.node.mode)&&e.nfd&&this.nodefs.closeSync(e.nfd)}catch(e){if(!e.code)throw e;throw new t.ErrnoError(this.ERRNO_CODES[e.code])}},q.prototype.read=function(e,t,i,r,n){try{return this.nodefs.readSync(e.nfd,P(t),i,r,n)}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},q.prototype.write=function(e,t,i,r,n){try{return this.nodefs.writeSync(e.nfd,P(t),i,r,n)}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},q.prototype.llseek=function(e,t,i){var r=t;if(1===i)r+=e.position;else if(2===i&&this.FS.isFile(e.node.mode))try{r+=this.nodefs.fstatSync(e.nfd).size}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}if(r<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return e.position=r,r};var K=function(e){this.fs=e,this.nodefs=e.getNodeFS(),this.FS=e.getFS(),this.PATH=e.getPATH(),this.ERRNO_CODES=e.getERRNO_CODES()};K.prototype.getattr=function(e){var t,i=this.fs.realPath(e);try{t=this.nodefs.lstatSync(i)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return{dev:t.dev,ino:t.ino,mode:t.mode,nlink:t.nlink,uid:t.uid,gid:t.gid,rdev:t.rdev,size:t.size,atime:t.atime,mtime:t.mtime,ctime:t.ctime,blksize:t.blksize,blocks:t.blocks}},K.prototype.setattr=function(e,t){var i=this.fs.realPath(e);try{if(void 0!==t.mode&&(this.nodefs.chmodSync(i,t.mode),e.mode=t.mode),void 0!==t.timestamp){var r=new Date(t.timestamp);this.nodefs.utimesSync(i,r,r)}}catch(e){if(!e.code)throw e;if("ENOTSUP"!==e.code)throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}if(void 0!==t.size)try{this.nodefs.truncateSync(i,t.size)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.lookup=function(e,t){var i=this.PATH.join2(this.fs.realPath(e),t),r=this.fs.getMode(i);return this.fs.createNode(e,t,r)},K.prototype.mknod=function(e,t,i,r){var n=this.fs.createNode(e,t,i,r),s=this.fs.realPath(n);try{this.FS.isDir(n.mode)?this.nodefs.mkdirSync(s,n.mode):this.nodefs.writeFileSync(s,"",{mode:n.mode})}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return n},K.prototype.rename=function(e,t,i){var r=this.fs.realPath(e),n=this.PATH.join2(this.fs.realPath(t),i);try{this.nodefs.renameSync(r,n),e.name=i,e.parent=t}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.unlink=function(e,t){var i=this.PATH.join2(this.fs.realPath(e),t);try{this.nodefs.unlinkSync(i)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.rmdir=function(e,t){var i=this.PATH.join2(this.fs.realPath(e),t);try{this.nodefs.rmdirSync(i)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.readdir=function(e){var t=this.fs.realPath(e);try{var i=this.nodefs.readdirSync(t);return i.push(".",".."),i}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.symlink=function(e,t,i){var r=this.PATH.join2(this.fs.realPath(e),t);try{this.nodefs.symlinkSync(i,r)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}},K.prototype.readlink=function(e){var t=this.fs.realPath(e);try{return this.nodefs.readlinkSync(t)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};var V=function(e,t,i,r){void 0===e&&(e=self.FS),void 0===t&&(t=self.PATH),void 0===i&&(i=self.ERRNO_CODES),void 0===r&&(r=k),this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=r,this.FS=e,this.PATH=t,this.ERRNO_CODES=i,this.node_ops=new K(this),this.stream_ops=new q(this)};V.prototype.mount=function(e){return this.createNode(null,"/",this.getMode(e.opts.root),0)},V.prototype.createNode=function(e,t,i,r){var n=this.FS;if(!n.isDir(i)&&!n.isFile(i)&&!n.isLink(i))throw new n.ErrnoError(this.ERRNO_CODES.EINVAL);var s=n.createNode(e,t,i);return s.node_ops=this.node_ops,s.stream_ops=this.stream_ops,s},V.prototype.getMode=function(e){var t;try{t=this.nodefs.lstatSync(e)}catch(e){if(!e.code)throw e;throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return t.mode},V.prototype.realPath=function(e){for(var t=[];e.parent!==e;)t.push(e.name),e=e.parent;return t.push(e.mount.opts.root),t.reverse(),this.PATH.join.apply(null,t)},V.prototype.flagsToPermissionString=function(e){var t="string"==typeof e?parseInt(e,10):e;return(t&=8191)in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[t]:e},V.prototype.getNodeFS=function(){return this.nodefs},V.prototype.getFS=function(){return this.FS},V.prototype.getPATH=function(){return this.PATH},V.prototype.getERRNO_CODES=function(){return this.ERRNO_CODES};var X=function(){};X.prototype.supportsLinks=function(){return!1},X.prototype.diskSpace=function(e,t){t(0,0)},X.prototype.openFile=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.createFile=function(e,t,i,r){throw new u(o.ENOTSUP)},X.prototype.open=function(e,t,i,r){var n=this;this.stat(e,!1,(function(s,a){if(s)switch(t.pathNotExistsAction()){case l.CREATE_FILE:return n.stat(c.dirname(e),!1,(function(s,o){s?r(s):o&&!o.isDirectory()?r(u.ENOTDIR(c.dirname(e))):n.createFile(e,t,i,r)}));case l.THROW_EXCEPTION:return r(u.ENOENT(e));default:return r(new u(o.EINVAL,"Invalid FileFlag object."))}else{if(a&&a.isDirectory())return r(u.EISDIR(e));switch(t.pathExistsAction()){case l.THROW_EXCEPTION:return r(u.EEXIST(e));case l.TRUNCATE_FILE:return n.openFile(e,t,(function(e,t){e?r(e):t?t.truncate(0,(function(){t.sync((function(){r(null,t)}))})):I()}));case l.NOP:return n.openFile(e,t,r);default:return r(new u(o.EINVAL,"Invalid FileFlag object."))}}}))},X.prototype.rename=function(e,t,i){i(new u(o.ENOTSUP))},X.prototype.renameSync=function(e,t){throw new u(o.ENOTSUP)},X.prototype.stat=function(e,t,i){i(new u(o.ENOTSUP))},X.prototype.statSync=function(e,t){throw new u(o.ENOTSUP)},X.prototype.openFileSync=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.createFileSync=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.openSync=function(e,t,i){var r;try{r=this.statSync(e,!1)}catch(r){switch(t.pathNotExistsAction()){case l.CREATE_FILE:if(!this.statSync(c.dirname(e),!1).isDirectory())throw u.ENOTDIR(c.dirname(e));return this.createFileSync(e,t,i);case l.THROW_EXCEPTION:throw u.ENOENT(e);default:throw new u(o.EINVAL,"Invalid FileFlag object.")}}if(r.isDirectory())throw u.EISDIR(e);switch(t.pathExistsAction()){case l.THROW_EXCEPTION:throw u.EEXIST(e);case l.TRUNCATE_FILE:return this.unlinkSync(e),this.createFileSync(e,t,r.mode);case l.NOP:return this.openFileSync(e,t,i);default:throw new u(o.EINVAL,"Invalid FileFlag object.")}},X.prototype.unlink=function(e,t){t(new u(o.ENOTSUP))},X.prototype.unlinkSync=function(e){throw new u(o.ENOTSUP)},X.prototype.rmdir=function(e,t){t(new u(o.ENOTSUP))},X.prototype.rmdirSync=function(e){throw new u(o.ENOTSUP)},X.prototype.mkdir=function(e,t,i){i(new u(o.ENOTSUP))},X.prototype.mkdirSync=function(e,t){throw new u(o.ENOTSUP)},X.prototype.readdir=function(e,t){t(new u(o.ENOTSUP))},X.prototype.readdirSync=function(e){throw new u(o.ENOTSUP)},X.prototype.exists=function(e,t){this.stat(e,null,(function(e){t(!e)}))},X.prototype.existsSync=function(e){try{return this.statSync(e,!0),!0}catch(e){return!1}},X.prototype.realpath=function(e,t,i){if(this.supportsLinks())for(var r=e.split(c.sep),n=0;n<r.length;n++){var s=r.slice(0,n+1);r[n]=c.join.apply(null,s)}else this.exists(e,(function(t){t?i(null,e):i(u.ENOENT(e))}))},X.prototype.realpathSync=function(e,t){if(this.supportsLinks()){for(var i=e.split(c.sep),r=0;r<i.length;r++){var n=i.slice(0,r+1);i[r]=c.join.apply(c,n)}return i.join(c.sep)}if(this.existsSync(e))return e;throw u.ENOENT(e)},X.prototype.truncate=function(e,t,i){this.open(e,p.getFileFlag("r+"),420,(function(e,r){if(e)return i(e);r.truncate(t,(function(e){r.close((function(t){i(e||t)}))}))}))},X.prototype.truncateSync=function(e,t){var i=this.openSync(e,p.getFileFlag("r+"),420);try{i.truncateSync(t)}catch(e){throw e}finally{i.closeSync()}},X.prototype.readFile=function(t,i,r,n){var s=n;this.open(t,r,420,(function(t,r){if(t)return n(t);n=function(e,t){r.close((function(i){return e||(e=i),s(e,t)}))},r.stat((function(t,s){if(t)return n(t);var o=e.alloc(s.size);r.read(o,0,s.size,0,(function(e){if(e)return n(e);if(null===i)return n(e,o);try{n(null,o.toString(i))}catch(e){n(e)}}))}))}))},X.prototype.readFileSync=function(t,i,r){var n=this.openSync(t,r,420);try{var s=n.statSync(),o=e.alloc(s.size);return n.readSync(o,0,s.size,0),n.closeSync(),null===i?o:o.toString(i)}finally{n.closeSync()}},X.prototype.writeFile=function(t,i,r,n,s,o){var a=o;this.open(t,n,420,(function(t,n){if(t)return o(t);o=function(e){n.close((function(t){a(e||t)}))};try{"string"==typeof i&&(i=e.from(i,r))}catch(e){return o(e)}n.write(i,0,i.length,0,o)}))},X.prototype.writeFileSync=function(t,i,r,n,s){var o=this.openSync(t,n,s);try{"string"==typeof i&&(i=e.from(i,r)),o.writeSync(i,0,i.length,0)}finally{o.closeSync()}},X.prototype.appendFile=function(t,i,r,n,s,o){var a=o;this.open(t,n,s,(function(t,n){if(t)return o(t);o=function(e){n.close((function(t){a(e||t)}))},"string"==typeof i&&(i=e.from(i,r)),n.write(i,0,i.length,null,o)}))},X.prototype.appendFileSync=function(t,i,r,n,s){var o=this.openSync(t,n,s);try{"string"==typeof i&&(i=e.from(i,r)),o.writeSync(i,0,i.length,null)}finally{o.closeSync()}},X.prototype.chmod=function(e,t,i,r){r(new u(o.ENOTSUP))},X.prototype.chmodSync=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.chown=function(e,t,i,r,n){n(new u(o.ENOTSUP))},X.prototype.chownSync=function(e,t,i,r){throw new u(o.ENOTSUP)},X.prototype.utimes=function(e,t,i,r){r(new u(o.ENOTSUP))},X.prototype.utimesSync=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.link=function(e,t,i){i(new u(o.ENOTSUP))},X.prototype.linkSync=function(e,t){throw new u(o.ENOTSUP)},X.prototype.symlink=function(e,t,i,r){r(new u(o.ENOTSUP))},X.prototype.symlinkSync=function(e,t,i){throw new u(o.ENOTSUP)},X.prototype.readlink=function(e,t){t(new u(o.ENOTSUP))},X.prototype.readlinkSync=function(e){throw new u(o.ENOTSUP)};var Y=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.supportsSynch=function(){return!0},t.prototype.rename=function(e,t,i){try{this.renameSync(e,t),i()}catch(e){i(e)}},t.prototype.stat=function(e,t,i){try{i(null,this.statSync(e,t))}catch(e){i(e)}},t.prototype.open=function(e,t,i,r){try{r(null,this.openSync(e,t,i))}catch(e){r(e)}},t.prototype.unlink=function(e,t){try{this.unlinkSync(e),t()}catch(e){t(e)}},t.prototype.rmdir=function(e,t){try{this.rmdirSync(e),t()}catch(e){t(e)}},t.prototype.mkdir=function(e,t,i){try{this.mkdirSync(e,t),i()}catch(e){i(e)}},t.prototype.readdir=function(e,t){try{t(null,this.readdirSync(e))}catch(e){t(e)}},t.prototype.chmod=function(e,t,i,r){try{this.chmodSync(e,t,i),r()}catch(e){r(e)}},t.prototype.chown=function(e,t,i,r,n){try{this.chownSync(e,t,i,r),n()}catch(e){n(e)}},t.prototype.utimes=function(e,t,i,r){try{this.utimesSync(e,t,i),r()}catch(e){r(e)}},t.prototype.link=function(e,t,i){try{this.linkSync(e,t),i()}catch(e){i(e)}},t.prototype.symlink=function(e,t,i,r){try{this.symlinkSync(e,t,i),r()}catch(e){r(e)}},t.prototype.readlink=function(e,t){try{t(null,this.readlinkSync(e))}catch(e){t(e)}},t}(X),Z=function(){};Z.prototype.sync=function(e){e(new u(o.ENOTSUP))},Z.prototype.syncSync=function(){throw new u(o.ENOTSUP)},Z.prototype.datasync=function(e){this.sync(e)},Z.prototype.datasyncSync=function(){return this.syncSync()},Z.prototype.chown=function(e,t,i){i(new u(o.ENOTSUP))},Z.prototype.chownSync=function(e,t){throw new u(o.ENOTSUP)},Z.prototype.chmod=function(e,t){t(new u(o.ENOTSUP))},Z.prototype.chmodSync=function(e){throw new u(o.ENOTSUP)},Z.prototype.utimes=function(e,t,i){i(new u(o.ENOTSUP))},Z.prototype.utimesSync=function(e,t){throw new u(o.ENOTSUP)};var G=function(t){function i(e,i,r,n,s){if(t.call(this),this._pos=0,this._dirty=!1,this._fs=e,this._path=i,this._flag=r,this._stat=n,this._buffer=s||j(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getBuffer=function(){return this._buffer},i.prototype.getStats=function(){return this._stat},i.prototype.getFlag=function(){return this._flag},i.prototype.getPath=function(){return this._path},i.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},i.prototype.advancePos=function(e){return this._pos+=e},i.prototype.setPos=function(e){return this._pos=e},i.prototype.sync=function(e){try{this.syncSync(),e()}catch(t){e(t)}},i.prototype.syncSync=function(){throw new u(o.ENOTSUP)},i.prototype.close=function(e){try{this.closeSync(),e()}catch(t){e(t)}},i.prototype.closeSync=function(){throw new u(o.ENOTSUP)},i.prototype.stat=function(e){try{e(null,this._stat.clone())}catch(t){e(t)}},i.prototype.statSync=function(){return this._stat.clone()},i.prototype.truncate=function(e,t){try{this.truncateSync(e),this._flag.isSynchronous()&&!k.getRootFS().supportsSynch()&&this.sync(t),t()}catch(e){return t(e)}},i.prototype.truncateSync=function(t){if(this._dirty=!0,!this._flag.isWriteable())throw new u(o.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,t>this._buffer.length){var i=e.alloc(t-this._buffer.length,0);return this.writeSync(i,0,i.length,this._buffer.length),void(this._flag.isSynchronous()&&k.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=t;var r=e.alloc(t);this._buffer.copy(r,0,0,t),this._buffer=r,this._flag.isSynchronous()&&k.getRootFS().supportsSynch()&&this.syncSync()},i.prototype.write=function(e,t,i,r,n){try{n(null,this.writeSync(e,t,i,r),e)}catch(e){n(e)}},i.prototype.writeSync=function(t,i,r,n){if(this._dirty=!0,null==n&&(n=this.getPos()),!this._flag.isWriteable())throw new u(o.EPERM,"File not opened with a writeable mode.");var s=n+r;if(s>this._stat.size&&(this._stat.size=s,s>this._buffer.length)){var a=e.alloc(s);this._buffer.copy(a),this._buffer=a}var c=t.copy(this._buffer,n,i,i+r);return this._stat.mtime=new Date,this._flag.isSynchronous()?(this.syncSync(),c):(this.setPos(n+c),c)},i.prototype.read=function(e,t,i,r,n){try{n(null,this.readSync(e,t,i,r),e)}catch(e){n(e)}},i.prototype.readSync=function(e,t,i,r){if(!this._flag.isReadable())throw new u(o.EPERM,"File not opened with a readable mode.");null==r&&(r=this.getPos()),r+i>this._stat.size&&(i=this._stat.size-r);var n=this._buffer.copy(e,t,r,r+i);return this._stat.atime=new Date,this._pos=r+i,n},i.prototype.chmod=function(e,t){try{this.chmodSync(e),t()}catch(e){t(e)}},i.prototype.chmodSync=function(e){if(!this._fs.supportsProps())throw new u(o.ENOTSUP);this._dirty=!0,this._stat.chmod(e),this.syncSync()},i.prototype.isDirty=function(){return this._dirty},i.prototype.resetDirty=function(){this._dirty=!1},i}(Z),J=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){e()},t.prototype.syncSync=function(){},t.prototype.close=function(e){e()},t.prototype.closeSync=function(){},t}(G),Q=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},t.prototype.closeSync=function(){this.syncSync()},t}(G),ee=function(e){function t(i,r,n){if(void 0===n&&(n=!0),e.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=i,this._async=r,!i.supportsSynch())throw new Error("The first argument to AsyncMirror needs to be a synchronous file system.");x(n,t.Name,{sync:"sync file system instance",async:"async file system instance"})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){try{var r=new t(e.sync,e.async,!1);r.initialize((function(e){e?i(e):i(null,r)}),!1)}catch(e){i(e)}},t.isAvailable=function(){return!0},t.prototype.getName=function(){return t.Name},t.prototype._syncSync=function(e){this._sync.writeFileSync(e.getPath(),e.getBuffer(),null,p.getFileFlag("w"),e.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[e.getPath(),e.getBuffer(),null,e.getFlag(),e.getStats().mode]})},t.prototype.initialize=function(e,t){var i=this;void 0===t&&(t=!0),t&&console.warn("[AsyncMirror] AsyncMirror.initialize() is deprecated and will be removed in the next major version. Please use 'AsyncMirror.Create({ sync: (sync file system instance), async: (async file system instance)}, cb)' to create and initialize AsyncMirror instances.");var r=this._initializeCallbacks;if(this._isInitialized)e();else if(1===r.push(e)){var n=function(e,t,r){"/"!==e&&i._sync.mkdirSync(e,t),i._async.readdir(e,(function(t,i){var n=0;t?r(t):function t(o){o?r(o):n<i.length?(s(c.join(e,i[n]),t),n++):r()}()}))},s=function(e,t){i._async.stat(e,!1,(function(r,s){r?t(r):s.isDirectory()?n(e,s.mode,t):function(e,t,r){i._async.readFile(e,null,p.getFileFlag("r"),(function(n,s){if(n)r(n);else try{i._sync.writeFileSync(e,s,null,p.getFileFlag("w"),t)}catch(e){n=e}finally{r(n)}}))}(e,s.mode,t)}))};n("/",0,(function(e){i._isInitialized=!e,i._initializeCallbacks=[],r.forEach((function(t){return t(e)}))}))}},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},t.prototype.renameSync=function(e,t){this.checkInitialized(),this._sync.renameSync(e,t),this.enqueueOp({apiMethod:"rename",arguments:[e,t]})},t.prototype.statSync=function(e,t){return this.checkInitialized(),this._sync.statSync(e,t)},t.prototype.openSync=function(e,t,i){return this.checkInitialized(),this._sync.openSync(e,t,i).closeSync(),new Q(this,e,t,this._sync.statSync(e,!1),this._sync.readFileSync(e,null,p.getFileFlag("r")))},t.prototype.unlinkSync=function(e){this.checkInitialized(),this._sync.unlinkSync(e),this.enqueueOp({apiMethod:"unlink",arguments:[e]})},t.prototype.rmdirSync=function(e){this.checkInitialized(),this._sync.rmdirSync(e),this.enqueueOp({apiMethod:"rmdir",arguments:[e]})},t.prototype.mkdirSync=function(e,t){this.checkInitialized(),this._sync.mkdirSync(e,t),this.enqueueOp({apiMethod:"mkdir",arguments:[e,t]})},t.prototype.readdirSync=function(e){return this.checkInitialized(),this._sync.readdirSync(e)},t.prototype.existsSync=function(e){return this.checkInitialized(),this._sync.existsSync(e)},t.prototype.chmodSync=function(e,t,i){this.checkInitialized(),this._sync.chmodSync(e,t,i),this.enqueueOp({apiMethod:"chmod",arguments:[e,t,i]})},t.prototype.chownSync=function(e,t,i,r){this.checkInitialized(),this._sync.chownSync(e,t,i,r),this.enqueueOp({apiMethod:"chown",arguments:[e,t,i,r]})},t.prototype.utimesSync=function(e,t,i){this.checkInitialized(),this._sync.utimesSync(e,t,i),this.enqueueOp({apiMethod:"utimes",arguments:[e,t,i]})},t.prototype.checkInitialized=function(){if(!this._isInitialized)throw new u(o.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")},t.prototype.enqueueOp=function(e){var t=this;if(this._queue.push(e),!this._queueRunning){this._queueRunning=!0;var i=function(e){if(e&&console.error("WARNING: File system has desynchronized. Received following error: "+e+"\n$"),t._queue.length>0){var r=t._queue.shift(),n=r.arguments;n.push(i),t._async[r.apiMethod].apply(t._async,n)}else t._queueRunning=!1};i()}},t}(Y);function te(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}ee.Name="AsyncMirror",ee.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};var ie=Math.max;function re(e){return e}function ne(e,t){return function(e,t,i){return t=ie(void 0===t?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=ie(r.length-t,0),o=Array(s);++n<s;)o[n]=r[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=r[n];return a[t]=i(o),te(e,this,a)}}(e,t,re)}var se=function(e){return ne((function(t){var i=t.pop();e.call(this,t,i)}))};function oe(e){return ne((function(t,i){var r=se((function(i,r){var n=this;return e(t,(function(e,t){e.apply(n,i.concat(t))}),r)}));return i.length?r.apply(this,i):r}))}var ae="object"==typeof r&&r&&r.Object===Object&&r,ce="object"==typeof self&&self&&self.Object===Object&&self,he=ae||ce||Function("return this")(),le=he.Symbol,ue=Object.prototype,fe=ue.hasOwnProperty,de=ue.toString,pe=le?le.toStringTag:void 0,_e=Object.prototype.toString,ge=le?le.toStringTag:void 0;function ve(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ge&&ge in Object(e)?function(e){var t=fe.call(e,pe),i=e[pe];try{e[pe]=void 0;var r=!0}catch(e){}var n=de.call(e);return r&&(t?e[pe]=i:delete e[pe]),n}(e):function(e){return _e.call(e)}(e)}function ye(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function me(e){return null!=e&&ye(e.length)&&!function(e){if(!function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}(e))return!1;var t=ve(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}(e)}var Se={};function we(){}function be(e){return function(){if(null!==e){var t=e;e=null,t.apply(this,arguments)}}}var Ee="function"==typeof Symbol&&Symbol.iterator;function Ce(e){return null!=e&&"object"==typeof e}function ke(e){return Ce(e)&&"[object Arguments]"==ve(e)}var Le=Object.prototype,Re=Le.hasOwnProperty,De=Le.propertyIsEnumerable,xe=ke(function(){return arguments}())?ke:function(e){return Ce(e)&&Re.call(e,"callee")&&!De.call(e,"callee")},Ae=Array.isArray,Te="object"==typeof t&&t&&!t.nodeType&&t,Ie=Te&&"object"==typeof n&&n&&!n.nodeType&&n,Oe=Ie&&Ie.exports===Te?he.Buffer:void 0,Be=(Oe?Oe.isBuffer:void 0)||function(){return!1},Fe=/^(?:0|[1-9]\d*)$/;function Me(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||Fe.test(e))&&e>-1&&e%1==0&&e<t}var Pe={};Pe["[object Float32Array]"]=Pe["[object Float64Array]"]=Pe["[object Int8Array]"]=Pe["[object Int16Array]"]=Pe["[object Int32Array]"]=Pe["[object Uint8Array]"]=Pe["[object Uint8ClampedArray]"]=Pe["[object Uint16Array]"]=Pe["[object Uint32Array]"]=!0,Pe["[object Arguments]"]=Pe["[object Array]"]=Pe["[object ArrayBuffer]"]=Pe["[object Boolean]"]=Pe["[object DataView]"]=Pe["[object Date]"]=Pe["[object Error]"]=Pe["[object Function]"]=Pe["[object Map]"]=Pe["[object Number]"]=Pe["[object Object]"]=Pe["[object RegExp]"]=Pe["[object Set]"]=Pe["[object String]"]=Pe["[object WeakMap]"]=!1;var Ne,Ue="object"==typeof t&&t&&!t.nodeType&&t,He=Ue&&"object"==typeof n&&n&&!n.nodeType&&n,je=He&&He.exports===Ue&&ae.process,ze=function(){try{return je&&je.binding&&je.binding("util")}catch(e){}}(),$e=ze&&ze.isTypedArray,We=$e?(Ne=$e,function(e){return Ne(e)}):function(e){return Ce(e)&&ye(e.length)&&!!Pe[ve(e)]},qe=Object.prototype.hasOwnProperty;function Ke(e,t){var i=Ae(e),r=!i&&xe(e),n=!i&&!r&&Be(e),s=!i&&!r&&!n&&We(e),o=i||r||n||s,a=o?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],c=a.length;for(var h in e)!t&&!qe.call(e,h)||o&&("length"==h||n&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||Me(h,c))||a.push(h);return a}var Ve=Object.prototype,Xe=function(e,t){return function(i){return e(t(i))}}(Object.keys,Object),Ye=Object.prototype.hasOwnProperty;function Ze(e){if(i=(t=e)&&t.constructor,t!==("function"==typeof i&&i.prototype||Ve))return Xe(e);var t,i,r=[];for(var n in Object(e))Ye.call(e,n)&&"constructor"!=n&&r.push(n);return r}function Ge(e){var t,i=me(t=e)?Ke(t):Ze(t),r=-1,n=i.length;return function(){var t=i[++r];return r<n?{value:e[t],key:t}:null}}function Je(e){if(me(e))return function(e){var t=-1,i=e.length;return function(){return++t<i?{value:e[t],key:t}:null}}(e);var t=function(e){return Ee&&e[Ee]&&e[Ee]()}(e);return t?function(e){var t=-1;return function(){var i=e.next();return i.done?null:(t++,{value:i.value,key:t})}}(t):Ge(e)}function Qe(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function et(e){return function(t,i,r){if(r=be(r||we),e<=0||!t)return r(null);var n=Je(t),s=!1,o=0;function a(e,t){if(o-=1,e)s=!0,r(e);else{if(t===Se||s&&o<=0)return s=!0,r(null);c()}}function c(){for(;o<e&&!s;){var t=n();if(null===t)return s=!0,void(o<=0&&r(null));o+=1,i(t.value,t.key,Qe(a))}}c()}}function tt(e,t,i,r){et(t)(e,i,r)}function it(e,t){return function(i,r,n){return e(i,t,r,n)}}function rt(e,t,i){i=be(i||we);var r=0,n=0,s=e.length;function o(e,t){e?i(e):++n!==s&&t!==Se||i(null)}for(0===s&&i(null);r<s;r++)t(e[r],r,Qe(o))}var nt,st=it(tt,1/0),ot=function(e,t,i){(me(e)?rt:st)(e,t,i)};function at(e,t,i,r){r=r||we;var n=[],s=0;e(t=t||[],(function(e,t,r){var o=s++;i(e,(function(e,t){n[o]=t,r(e)}))}),(function(e){r(e,n)}))}oe((nt=at,function(e,t,i){return nt(ot,e,t,i)}));var ct=function(e){return function(t,i,r,n){return e(et(i),t,r,n)}}(at);oe(it(ct,1)),ne((function(e,t){return ne((function(i){return e.apply(null,t.concat(i))}))}));var ht="function"==typeof setImmediate&&setImmediate,lt="object"==typeof s&&"function"==typeof s.nextTick;function ut(e){setTimeout(e,0)}function ft(e){return ne((function(t,i){e((function(){t.apply(null,i)}))}))}ft(ht?setImmediate:lt?s.nextTick:ut);var dt,pt=it(tt,1),_t=ne((function(e){return ne((function(t){var i,r,n,s,o=this,a=t[t.length-1];"function"==typeof a?t.pop():a=we,i=e,r=t,n=function(e,t,i){t.apply(o,e.concat(ne((function(e,t){i(e,t)}))))},s=be((s=function(e,t){a.apply(o,[e].concat(t))})||we),pt(i,(function(e,t,i){n(r,e,(function(e,t){r=t,i(e)}))}),(function(e){s(e,r)}))}))}));function gt(e){return ne((function(t,i){t.apply(null,i.concat(ne((function(t,i){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&function(e,t){for(var i=-1,r=null==e?0:e.length;++i<r&&!1!==t(e[i],i,e););}(i,(function(t){console[e](t)})))}))))}))}function vt(e,t,i){ot(e,function(e){return function(t,i,r){return e(t,r)}}(t),i)}ne((function(e){return _t.apply(null,e.reverse())})),ne((function(e){var t=[null].concat(e);return se((function(e,i){return i.apply(this,t)}))})),gt("dir"),gt("log"),ft(lt?s.nextTick:ht?setImmediate:ut);var yt=function(e){this._cache={},this._client=e};yt.prototype.readdir=function(e,t){var i=this,r=this.getCachedDirInfo(e);this._wrap((function(t){null!==r&&r.contents?i._client.readdir(e,{contentHash:r.stat.contentHash},t):i._client.readdir(e,t)}),(function(n,s,o,a){n?n.status===Dropbox.ApiError.NO_CONTENT&&null!==r?t(null,r.contents.slice(0)):t(n):(i.updateCachedDirInfo(e,o,s.slice(0)),a.forEach((function(t){i.updateCachedInfo(c.join(e,t.name),t)})),t(null,s))}))},yt.prototype.remove=function(e,t){var i=this;this._wrap((function(t){i._client.remove(e,t)}),(function(r,n){r||i.updateCachedInfo(e,n),t(r)}))},yt.prototype.move=function(e,t,i){var r=this;this._wrap((function(i){r._client.move(e,t,i)}),(function(n,s){n||(r.deleteCachedInfo(e),r.updateCachedInfo(t,s)),i(n)}))},yt.prototype.stat=function(e,t){var i=this;this._wrap((function(t){i._client.stat(e,t)}),(function(r,n){r||i.updateCachedInfo(e,n),t(r,n)}))},yt.prototype.readFile=function(e,t){var i=this,r=this.getCachedFileInfo(e);null!==r&&null!==r.contents?this.stat(e,(function(n,s){n?t(n):s.contentHash===r.stat.contentHash?t(n,r.contents.slice(0),r.stat):i.readFile(e,t)})):this._wrap((function(t){i._client.readFile(e,{arrayBuffer:!0},t)}),(function(r,n,s){r||i.updateCachedInfo(e,s,n.slice(0)),t(r,n,s)}))},yt.prototype.writeFile=function(e,t,i){var r=this;this._wrap((function(i){r._client.writeFile(e,t,i)}),(function(n,s){n||r.updateCachedInfo(e,s,t.slice(0)),i(n,s)}))},yt.prototype.mkdir=function(e,t){var i=this;this._wrap((function(t){i._client.mkdir(e,t)}),(function(r,n){r||i.updateCachedInfo(e,n,[]),t(r)}))},yt.prototype._wrap=function(e,t){var i=0,r=function(n){var s=2;if(n&&3>++i)switch(n.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout((function(){e(r)}),1e3*s);break;default:t.apply(null,arguments)}else t.apply(null,arguments)};e(r)},yt.prototype.getCachedInfo=function(e){return this._cache[e.toLowerCase()]},yt.prototype.putCachedInfo=function(e,t){this._cache[e.toLowerCase()]=t},yt.prototype.deleteCachedInfo=function(e){delete this._cache[e.toLowerCase()]},yt.prototype.getCachedDirInfo=function(e){var t,i=this.getCachedInfo(e);return(t=i)&&t.stat.isFolder?i:null},yt.prototype.getCachedFileInfo=function(e){var t,i=this.getCachedInfo(e);return(t=i)&&t.stat.isFile?i:null},yt.prototype.updateCachedDirInfo=function(e,t,i){void 0===i&&(i=null);var r=this.getCachedInfo(e);null===t.contentHash||void 0!==r&&r.stat.contentHash===t.contentHash||this.putCachedInfo(e,{stat:t,contents:i})},yt.prototype.updateCachedFileInfo=function(e,t,i){void 0===i&&(i=null);var r=this.getCachedInfo(e);null===t.versionTag||void 0!==r&&r.stat.versionTag===t.versionTag||this.putCachedInfo(e,{stat:t,contents:i})},yt.prototype.updateCachedInfo=function(e,t,i){var r;void 0===i&&(i=null),t.isFile&&(null==(r=i)||"object"==typeof r&&"number"==typeof r.byteLength)?this.updateCachedFileInfo(e,t,i):t.isFolder&&Array.isArray(i)&&this.updateCachedDirInfo(e,t,i)};var mt=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var t=this;if(this.isDirty()){var i=B(this.getBuffer());this._fs._writeFileStrict(this.getPath(),i,(function(i){i||t.resetDirty(),e(i)}))}else e()},t.prototype.close=function(e){this.sync(e)},t}(G),St=function(e){function t(i,r){void 0===r&&(r=!0),e.call(this),this._client=new yt(i),x(r,t.Name,{client:"authenticated dropbox client instance"}),dt||((dt={})[Dropbox.ApiError.NETWORK_ERROR]=o.EIO,dt[Dropbox.ApiError.INVALID_PARAM]=o.EINVAL,dt[Dropbox.ApiError.INVALID_TOKEN]=o.EPERM,dt[Dropbox.ApiError.OAUTH_ERROR]=o.EPERM,dt[Dropbox.ApiError.NOT_FOUND]=o.ENOENT,dt[Dropbox.ApiError.INVALID_METHOD]=o.EINVAL,dt[Dropbox.ApiError.NOT_ACCEPTABLE]=o.EINVAL,dt[Dropbox.ApiError.CONFLICT]=o.EINVAL,dt[Dropbox.ApiError.RATE_LIMITED]=o.EBUSY,dt[Dropbox.ApiError.SERVER_ERROR]=o.EBUSY,dt[Dropbox.ApiError.OVER_QUOTA]=o.ENOSPC)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){i(null,new t(e.client,!1))},t.isAvailable=function(){return"undefined"!=typeof Dropbox},t.prototype.getName=function(){return t.Name},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!1},t.prototype.empty=function(e){var t=this;this._client.readdir("/",(function(i,r){i?e(t.convert(i,"/")):vt(r,(function(e,i){var r=c.join("/",e);t._client.remove(r,(function(e){i(e?t.convert(e,r):null)}))}),(function(t){t?e(t):e()}))}))},t.prototype.rename=function(e,t,i){var r=this;this._client.move(e,t,(function(n){n?r._client.stat(t,(function(s,o){if(s||o.isFolder){var a=n.response.error.indexOf(e)>-1?e:t;i(r.convert(n,a))}else r._client.remove(t,(function(n){n?i(r.convert(n,t)):r.rename(e,t,i)}))})):i()}))},t.prototype.stat=function(e,t,i){var r=this;this._client.stat(e,(function(t,n){if(t)i(r.convert(t,e));else{if(!n||!n.isRemoved){var s=new _(r._statType(n),n.size);return i(null,s)}i(u.FileError(o.ENOENT,e))}}))},t.prototype.open=function(e,t,i,r){var n=this;this._client.readFile(e,(function(i,s,o){if(!i){var a;a=null===s?j():N(s);var c=n._makeFile(e,t,o,a);return r(null,c)}if(!t.isReadable()){if(i.status===Dropbox.ApiError.NOT_FOUND){var h=new ArrayBuffer(0);return n._writeFileStrict(e,h,(function(i,s){if(i)r(i);else{var o=n._makeFile(e,t,s,N(h));r(null,o)}}))}return r(n.convert(i,e))}r(n.convert(i,e))}))},t.prototype._writeFileStrict=function(e,t,i){var r=this,n=c.dirname(e);this.stat(n,!1,(function(s,a){s?i(u.FileError(o.ENOENT,n)):r._client.writeFile(e,t,(function(t,n){t?i(r.convert(t,e)):i(null,n)}))}))},t.prototype._statType=function(e){return e.isFile?d.FILE:d.DIRECTORY},t.prototype._makeFile=function(e,t,i,r){var n=this._statType(i),s=new _(n,i.size);return new mt(this,e,t,s,r)},t.prototype._remove=function(e,t,i){var r=this;this._client.stat(e,(function(n,s){n?t(r.convert(n,e)):s.isFile&&!i?t(u.FileError(o.ENOTDIR,e)):!s.isFile&&i?t(u.FileError(o.EISDIR,e)):r._client.remove(e,(function(i){t(i?r.convert(i,e):null)}))}))},t.prototype.unlink=function(e,t){this._remove(e,t,!0)},t.prototype.rmdir=function(e,t){this._remove(e,t,!1)},t.prototype.mkdir=function(e,t,i){var r=this,n=c.dirname(e);this._client.stat(n,(function(t,s){t?i(r.convert(t,n)):r._client.mkdir(e,(function(t){i(t?u.FileError(o.EEXIST,e):null)}))}))},t.prototype.readdir=function(e,t){var i=this;this._client.readdir(e,(function(e,r){return e?t(i.convert(e)):t(null,r)}))},t.prototype.convert=function(e,t){void 0===t&&(t=null);var i=dt[e.status];return void 0===i&&(i=o.EIO),t?u.FileError(i,t):new u(i)},t}(X);function wt(e,t){void 0===t&&(t="");for(var i=e.errno,r=e.node,n=[];r&&(n.unshift(r.name),r!==r.parent);)r=r.parent;return new u(i,h[i],n.length>0?"/"+n.join("/"):t)}St.Name="Dropbox",St.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(e,t){e.isAuthenticated&&e.isAuthenticated()?t():t(new u(o.EINVAL,"'client' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}};var bt=function(e){function t(t,i,r,n){e.call(this),this._fs=t,this._FS=i,this._path=r,this._stream=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getPos=function(){},t.prototype.close=function(e){var t=null;try{this.closeSync()}catch(e){t=e}finally{e(t)}},t.prototype.closeSync=function(){try{this._FS.close(this._stream)}catch(e){throw wt(e,this._path)}},t.prototype.stat=function(e){try{e(null,this.statSync())}catch(t){e(t)}},t.prototype.statSync=function(){try{return this._fs.statSync(this._path,!1)}catch(e){throw wt(e,this._path)}},t.prototype.truncate=function(e,t){var i=null;try{this.truncateSync(e)}catch(e){i=e}finally{t(i)}},t.prototype.truncateSync=function(e){try{this._FS.ftruncate(this._stream.fd,e)}catch(e){throw wt(e,this._path)}},t.prototype.write=function(e,t,i,r,n){try{n(null,this.writeSync(e,t,i,r),e)}catch(e){n(e)}},t.prototype.writeSync=function(e,t,i,r){try{var n=F(e),s=null===r?void 0:r;return this._FS.write(this._stream,n,t,i,s)}catch(e){throw wt(e,this._path)}},t.prototype.read=function(e,t,i,r,n){try{n(null,this.readSync(e,t,i,r),e)}catch(e){n(e)}},t.prototype.readSync=function(e,t,i,r){try{var n=F(e),s=null===r?void 0:r;return this._FS.read(this._stream,n,t,i,s)}catch(e){throw wt(e,this._path)}},t.prototype.sync=function(e){e()},t.prototype.syncSync=function(){},t.prototype.chown=function(e,t,i){var r=null;try{this.chownSync(e,t)}catch(e){r=e}finally{i(r)}},t.prototype.chownSync=function(e,t){try{this._FS.fchown(this._stream.fd,e,t)}catch(e){throw wt(e,this._path)}},t.prototype.chmod=function(e,t){var i=null;try{this.chmodSync(e)}catch(e){i=e}finally{t(i)}},t.prototype.chmodSync=function(e){try{this._FS.fchmod(this._stream.fd,e)}catch(e){throw wt(e,this._path)}},t.prototype.utimes=function(e,t,i){var r=null;try{this.utimesSync(e,t)}catch(e){r=e}finally{i(r)}},t.prototype.utimesSync=function(e,t){this._fs.utimesSync(this._path,e,t)},t}(Z),Et=function(t){function i(e){t.call(this),this._FS=e}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.Create=function(e,t){t(null,new i(e.FS))},i.isAvailable=function(){return!0},i.prototype.getName=function(){return this._FS.DB_NAME()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsLinks=function(){return!0},i.prototype.supportsProps=function(){return!0},i.prototype.supportsSynch=function(){return!0},i.prototype.renameSync=function(e,t){try{this._FS.rename(e,t)}catch(i){throw i.errno===o.ENOENT?wt(i,this.existsSync(e)?t:e):wt(i)}},i.prototype.statSync=function(e,t){try{var i=t?this._FS.lstat(e):this._FS.stat(e),r=this.modeToFileType(i.mode);return new _(r,i.size,i.mode,i.atime,i.mtime,i.ctime)}catch(t){throw wt(t,e)}},i.prototype.openSync=function(e,t,i){try{var r=this._FS.open(e,t.getFlagString(),i);if(this._FS.isDir(r.node.mode))throw this._FS.close(r),u.EISDIR(e);return new bt(this,this._FS,e,r)}catch(t){throw wt(t,e)}},i.prototype.unlinkSync=function(e){try{this._FS.unlink(e)}catch(t){throw wt(t,e)}},i.prototype.rmdirSync=function(e){try{this._FS.rmdir(e)}catch(t){throw wt(t,e)}},i.prototype.mkdirSync=function(e,t){try{this._FS.mkdir(e,t)}catch(t){throw wt(t,e)}},i.prototype.readdirSync=function(e){try{return this._FS.readdir(e).filter((function(e){return"."!==e&&".."!==e}))}catch(t){throw wt(t,e)}},i.prototype.truncateSync=function(e,t){try{this._FS.truncate(e,t)}catch(t){throw wt(t,e)}},i.prototype.readFileSync=function(e,t,i){try{var r=P(this._FS.readFile(e,{flags:i.getFlagString()}));return t?r.toString(t):r}catch(t){throw wt(t,e)}},i.prototype.writeFileSync=function(t,i,r,n,s){try{r&&(i=e.from(i,r));var o=F(i);this._FS.writeFile(t,o,{flags:n.getFlagString(),encoding:"binary"}),this._FS.chmod(t,s)}catch(e){throw wt(e,t)}},i.prototype.chmodSync=function(e,t,i){try{t?this._FS.lchmod(e,i):this._FS.chmod(e,i)}catch(t){throw wt(t,e)}},i.prototype.chownSync=function(e,t,i,r){try{t?this._FS.lchown(e,i,r):this._FS.chown(e,i,r)}catch(t){throw wt(t,e)}},i.prototype.symlinkSync=function(e,t,i){try{this._FS.symlink(e,t)}catch(e){throw wt(e)}},i.prototype.readlinkSync=function(e){try{return this._FS.readlink(e)}catch(t){throw wt(t,e)}},i.prototype.utimesSync=function(e,t,i){try{this._FS.utime(e,t.getTime(),i.getTime())}catch(t){throw wt(t,e)}},i.prototype.modeToFileType=function(e){if(this._FS.isDir(e))return d.DIRECTORY;if(this._FS.isFile(e))return d.FILE;if(this._FS.isLink(e))return d.SYMLINK;throw u.EPERM("Invalid mode: "+e)},i}(Y);Et.Name="EmscriptenFileSystem",Et.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var Ct=function(e){function t(t,i){e.call(this),this._folder=t,this._wrapped=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){i(null,new t(e.folder,e.wrapped))},t.isAvailable=function(){return!0},t.prototype.initialize=function(e){var t=this;this._wrapped.exists(this._folder,(function(i){i?e():t._wrapped.isReadOnly()?e(u.ENOENT(t._folder)):t._wrapped.mkdir(t._folder,511,e)}))},t.prototype.getName=function(){return this._wrapped.getName()},t.prototype.isReadOnly=function(){return this._wrapped.isReadOnly()},t.prototype.supportsProps=function(){return this._wrapped.supportsProps()},t.prototype.supportsSynch=function(){return this._wrapped.supportsSynch()},t.prototype.supportsLinks=function(){return!1},t}(X);function kt(e,t){if(null!==t&&"object"==typeof t){var i=t,r=i.path;r&&(r="/"+c.relative(e,r),i.message=i.message.replace(i.path,r),i.path=r)}return t}function Lt(e,t){return"function"==typeof t?function(i){arguments.length>0&&(arguments[0]=kt(e,i)),t.apply(null,arguments)}:t}function Rt(e,t,i){return"Sync"!==e.slice(e.length-4)?function(){return arguments.length>0&&(t&&(arguments[0]=c.join(this._folder,arguments[0])),i&&(arguments[1]=c.join(this._folder,arguments[1])),arguments[arguments.length-1]=Lt(this._folder,arguments[arguments.length-1])),this._wrapped[e].apply(this._wrapped,arguments)}:function(){try{return t&&(arguments[0]=c.join(this._folder,arguments[0])),i&&(arguments[1]=c.join(this._folder,arguments[1])),this._wrapped[e].apply(this._wrapped,arguments)}catch(e){throw kt(this._folder,e)}}}Ct.Name="FolderAdapter",Ct.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}},["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach((function(e){Ct.prototype[e]=Rt(e,!0,!1)})),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach((function(e){Ct.prototype[e]=Rt(e,!0,!0)}));var Dt="undefined"!=typeof window?window:"undefined"!=typeof self?self:r,xt=Dt.webkitRequestFileSystem||Dt.requestFileSystem||null;function At(e,t,i){switch(e.name){case"PathExistsError":return u.EEXIST(t);case"QuotaExceededError":return u.FileError(o.ENOSPC,t);case"NotFoundError":return u.ENOENT(t);case"SecurityError":return u.FileError(o.EACCES,t);case"InvalidModificationError":return u.FileError(o.EPERM,t);case"TypeMismatchError":return u.FileError(i?o.ENOTDIR:o.EISDIR,t);default:return u.FileError(o.EINVAL,t)}}var Tt=function(e){function t(t,i,r,n,s,o){e.call(this,t,r,n,s,o),this._entry=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var t=this;if(!this.isDirty())return e();this._entry.createWriter((function(i){var r=t.getBuffer(),n=new Blob([B(r)]),s=n.size;i.onwriteend=function(r){i.onwriteend=null,i.onerror=null,i.truncate(s),t.resetDirty(),e()},i.onerror=function(i){e(At(i,t.getPath(),!1))},i.write(n)}))},t.prototype.close=function(e){this.sync(e)},t}(G),It=function(e){function t(i,r,n){void 0===i&&(i=5),void 0===r&&(r=Dt.PERSISTENT),void 0===n&&(n=!0),e.call(this),this.size=1048576*i,this.type=r,x(n,t.Name,{size:i,type:r})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){var r=new t(e.size,e.type,!1);r.allocate((function(e){return e?i(e):i(null,r)}),!1)},t.isAvailable=function(){return!!xt},t.prototype.getName=function(){return t.Name},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSymlinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!1},t.prototype.allocate=function(e,t){var i=this;void 0===e&&(e=function(){}),void 0===t&&(t=!0),t&&console.warn("[HTML5FS] HTML5FS.allocate() is deprecated and will be removed in the next major release. Please use 'HTML5FS.Create({type: "+this.type+", size: "+this.size+"}, cb)' to create and allocate HTML5FS instances.");var r=function(t){i.fs=t,e()},n=function(t){e(At(t,"/",!0))};this.type===Dt.PERSISTENT?function(e,t,i,r){if(void 0!==navigator.webkitPersistentStorage)switch(e){case Dt.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(t,i,r);break;case Dt.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(t,i,r);break;default:r(new TypeError("Invalid storage type: "+e))}else Dt.webkitStorageInfo.requestQuota(e,t,i,r)}(this.type,this.size,(function(e){xt(i.type,e,r,n)}),n):xt(this.type,this.size,r,n)},t.prototype.empty=function(e){this._readdir("/",(function(t,i){t?(console.error("Failed to empty FS"),e(t)):vt(i,(function(e,t){var i=function(){t()},r=function(i){t(At(i,e.fullPath,!e.isDirectory))};!function(e){return e.isDirectory}(e)?e.remove(i,r):e.removeRecursively(i,r)}),(function(i){t?(console.error("Failed to empty FS"),e(t)):e()}))}))},t.prototype.rename=function(e,t,i){var r=this,n=2,s=0,a=this.fs.root,h=e,l=function(e){--n<=0&&i(At(e,h,!1))},f=function(n){return 2==++s?i(new u(o.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):e===t?i():(h=c.dirname(t),void a.getDirectory(h,{},(function(s){h=c.basename(t),n.moveTo(s,h,(function(e){i()}),(function(s){n.isDirectory?(h=t,r.unlink(t,(function(n){n?l(s):r.rename(e,t,i)}))):l(s)}))}),l))};a.getFile(e,{},f,l),a.getDirectory(e,{},f,l)},t.prototype.stat=function(e,t,i){var r=this,n={create:!1},s=function(e){var t=new _(d.DIRECTORY,4096);i(null,t)},o=function(t){i(At(t,e,!1))};this.fs.root.getFile(e,n,(function(e){e.file((function(e){var t=new _(d.FILE,e.size);i(null,t)}),o)}),(function(){r.fs.root.getDirectory(e,n,s,o)}))},t.prototype.open=function(e,t,i,r){var n=this,s=function(i){"InvalidModificationError"===i.name&&t.isExclusive()?r(u.EEXIST(e)):r(At(i,e,!1))};this.fs.root.getFile(e,{create:t.pathNotExistsAction()===l.CREATE_FILE,exclusive:t.isExclusive()},(function(i){i.file((function(o){var a=new FileReader;a.onloadend=function(s){var c=n._makeFile(e,i,t,o,a.result);r(null,c)},a.onerror=function(e){s(a.error)},a.readAsArrayBuffer(o)}),s)}),s)},t.prototype.unlink=function(e,t){this._remove(e,t,!0)},t.prototype.rmdir=function(e,t){var i=this;this.readdir(e,(function(r,n){r?t(r):n.length>0?t(u.ENOTEMPTY(e)):i._remove(e,t,!1)}))},t.prototype.mkdir=function(e,t,i){this.fs.root.getDirectory(e,{create:!0,exclusive:!0},(function(e){i()}),(function(t){i(At(t,e,!0))}))},t.prototype.readdir=function(e,t){this._readdir(e,(function(e,i){if(!i)return t(e);for(var r=[],n=0,s=i;n<s.length;n+=1){var o=s[n];r.push(o.name)}t(null,r)}))},t.prototype._makeFile=function(e,t,i,r,n){void 0===n&&(n=new ArrayBuffer(0));var s=new _(d.FILE,r.size),o=N(n);return new Tt(this,t,e,i,s,o)},t.prototype._readdir=function(e,t){var i=function(i){t(At(i,e,!0))};this.fs.root.getDirectory(e,{create:!1},(function(e){var r=e.createReader(),n=[],s=function(){r.readEntries((function(e){e.length?(n=n.concat(function(e){return Array.prototype.slice.call(e||[],0)}(e)),s()):t(null,n)}),i)};s()}),i)},t.prototype._remove=function(e,t,i){var r=function(r){r.remove((function(){t()}),(function(r){t(At(r,e,!i))}))},n=function(r){t(At(r,e,!i))},s={create:!1};i?this.fs.root.getFile(e,s,r,n):this.fs.root.getDirectory(e,s,r,n)},t}(X);It.Name="HTML5FS",It.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var Ot=function(e,t,i,r,n,s){this.id=e,this.size=t,this.mode=i,this.atime=r,this.mtime=n,this.ctime=s};Ot.fromBuffer=function(e){if(void 0===e)throw new Error("NO");return new Ot(e.toString("ascii",30),e.readUInt32LE(0),e.readUInt16LE(4),e.readDoubleLE(6),e.readDoubleLE(14),e.readDoubleLE(22))},Ot.prototype.toStats=function(){return new _((61440&this.mode)===d.DIRECTORY?d.DIRECTORY:d.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},Ot.prototype.getSize=function(){return 30+this.id.length},Ot.prototype.toBuffer=function(t){return void 0===t&&(t=e.alloc(this.getSize())),t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t},Ot.prototype.update=function(e){var t=!1;this.size!==e.size&&(this.size=e.size,t=!0),this.mode!==e.mode&&(this.mode=e.mode,t=!0);var i=e.atime.getTime();this.atime!==i&&(this.atime=i,t=!0);var r=e.mtime.getTime();this.mtime!==r&&(this.mtime=r,t=!0);var n=e.ctime.getTime();return this.ctime!==n&&(this.ctime=n,t=!0),t},Ot.prototype.isFile=function(){return(61440&this.mode)===d.FILE},Ot.prototype.isDirectory=function(){return(61440&this.mode)===d.DIRECTORY};var Bt="/",Ft=null;function Mt(){return Ft||(Ft=e.from("{}"))}function Pt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function Nt(e,t){return!e||(t(e),!1)}function Ut(e,t,i){return!e||(t.abort((function(){i(e)})),!1)}var Ht=function(e){this.store=e,this.originalData={},this.modifiedKeys=[]};Ht.prototype.get=function(e){var t=this.store.get(e);return this.stashOldValue(e,t),t},Ht.prototype.put=function(e,t,i){return this.markModified(e),this.store.put(e,t,i)},Ht.prototype.del=function(e){this.markModified(e),this.store.del(e)},Ht.prototype.commit=function(){},Ht.prototype.abort=function(){for(var e=this,t=0,i=e.modifiedKeys;t<i.length;t+=1){var r=i[t],n=e.originalData[r];n?e.store.put(r,n,!0):e.store.del(r)}},Ht.prototype.stashOldValue=function(e,t){this.originalData.hasOwnProperty(e)||(this.originalData[e]=t)},Ht.prototype.markModified=function(e){-1===this.modifiedKeys.indexOf(e)&&(this.modifiedKeys.push(e),this.originalData.hasOwnProperty(e)||(this.originalData[e]=this.store.get(e)))};var jt=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},t.prototype.closeSync=function(){this.syncSync()},t}(G),zt=function(t){function i(e){t.call(this),this.store=e.store,this.makeRootDirectory()}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.isAvailable=function(){return!0},i.prototype.getName=function(){return this.store.name()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsSymlinks=function(){return!1},i.prototype.supportsProps=function(){return!1},i.prototype.supportsSynch=function(){return!0},i.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},i.prototype.renameSync=function(t,i){var r=this.store.beginTransaction("readwrite"),n=c.dirname(t),s=c.basename(t),a=c.dirname(i),h=c.basename(i),l=this.findINode(r,n),f=this.getDirListing(r,n,l);if(!f[s])throw u.ENOENT(t);var d,p,_=f[s];if(delete f[s],0===(a+"/").indexOf(t+"/"))throw new u(o.EBUSY,n);if(a===n?(d=l,p=f):(d=this.findINode(r,a),p=this.getDirListing(r,a,d)),p[h]){var g=this.getINode(r,i,p[h]);if(!g.isFile())throw u.EPERM(i);try{r.del(g.id),r.del(p[h])}catch(e){throw r.abort(),e}}p[h]=_;try{r.put(l.id,e.from(JSON.stringify(f)),!0),r.put(d.id,e.from(JSON.stringify(p)),!0)}catch(e){throw r.abort(),e}r.commit()},i.prototype.statSync=function(e,t){return this.findINode(this.store.beginTransaction("readonly"),e).toStats()},i.prototype.createFileSync=function(e,t,i){var r=this.store.beginTransaction("readwrite"),n=j(),s=this.commitNewFile(r,e,d.FILE,i,n);return new jt(this,e,t,s.toStats(),n)},i.prototype.openFileSync=function(e,t){var i=this.store.beginTransaction("readonly"),r=this.findINode(i,e),n=i.get(r.id);if(void 0===n)throw u.ENOENT(e);return new jt(this,e,t,r.toStats(),n)},i.prototype.unlinkSync=function(e){this.removeEntry(e,!1)},i.prototype.rmdirSync=function(e){if(this.readdirSync(e).length>0)throw u.ENOTEMPTY(e);this.removeEntry(e,!0)},i.prototype.mkdirSync=function(t,i){var r=this.store.beginTransaction("readwrite"),n=e.from("{}");this.commitNewFile(r,t,d.DIRECTORY,i,n)},i.prototype.readdirSync=function(e){var t=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(t,e,this.findINode(t,e)))},i.prototype._syncSync=function(e,t,i){var r=this.store.beginTransaction("readwrite"),n=this._findINode(r,c.dirname(e),c.basename(e)),s=this.getINode(r,e,n),o=s.update(i);try{r.put(s.id,t,!0),o&&r.put(n,s.toBuffer(),!0)}catch(e){throw r.abort(),e}r.commit()},i.prototype.makeRootDirectory=function(){var e=this.store.beginTransaction("readwrite");if(void 0===e.get(Bt)){var t=(new Date).getTime(),i=new Ot(Pt(),4096,511|d.DIRECTORY,t,t,t);e.put(i.id,Mt(),!1),e.put(Bt,i.toBuffer(),!1),e.commit()}},i.prototype._findINode=function(e,t,i){var r=this,n=function(n){var s=r.getDirListing(e,t,n);if(s[i])return s[i];throw u.ENOENT(c.resolve(t,i))};return"/"===t?""===i?Bt:n(this.getINode(e,t,Bt)):n(this.getINode(e,t+c.sep+i,this._findINode(e,c.dirname(t),c.basename(t))))},i.prototype.findINode=function(e,t){return this.getINode(e,t,this._findINode(e,c.dirname(t),c.basename(t)))},i.prototype.getINode=function(e,t,i){var r=e.get(i);if(void 0===r)throw u.ENOENT(t);return Ot.fromBuffer(r)},i.prototype.getDirListing=function(e,t,i){if(!i.isDirectory())throw u.ENOTDIR(t);var r=e.get(i.id);if(void 0===r)throw u.ENOENT(t);return JSON.parse(r.toString())},i.prototype.addNewNode=function(e,t){for(var i;;)try{return i=Pt(),e.put(i,t,!1),i}catch(e){}throw new u(o.EIO,"Unable to commit data to key-value store.")},i.prototype.commitNewFile=function(t,i,r,n,s){var o,a=c.dirname(i),h=c.basename(i),l=this.findINode(t,a),f=this.getDirListing(t,a,l),d=(new Date).getTime();if("/"===i)throw u.EEXIST(i);if(f[h])throw u.EEXIST(i);try{var p=this.addNewNode(t,s);o=new Ot(p,s.length,n|r,d,d,d);var _=this.addNewNode(t,o.toBuffer());f[h]=_,t.put(l.id,e.from(JSON.stringify(f)),!0)}catch(e){throw t.abort(),e}return t.commit(),o},i.prototype.removeEntry=function(t,i){var r=this.store.beginTransaction("readwrite"),n=c.dirname(t),s=this.findINode(r,n),o=this.getDirListing(r,n,s),a=c.basename(t);if(!o[a])throw u.ENOENT(t);var h=o[a];delete o[a];var l=this.getINode(r,t,h);if(!i&&l.isDirectory())throw u.EISDIR(t);if(i&&!l.isDirectory())throw u.ENOTDIR(t);try{r.del(l.id),r.del(h),r.put(s.id,e.from(JSON.stringify(o)),!0)}catch(e){throw r.abort(),e}r.commit()},i}(Y),$t=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var t=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),(function(i){i||t.resetDirty(),e(i)})):e()},t.prototype.close=function(e){this.sync(e)},t}(G),Wt=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.isAvailable=function(){return!0},i.prototype.init=function(e,t){this.store=e,this.makeRootDirectory(t)},i.prototype.getName=function(){return this.store.name()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsSymlinks=function(){return!1},i.prototype.supportsProps=function(){return!1},i.prototype.supportsSynch=function(){return!1},i.prototype.empty=function(e){var t=this;this.store.clear((function(i){Nt(i,e)&&t.makeRootDirectory(e)}))},i.prototype.rename=function(t,i,r){var n=this,s=this.store.beginTransaction("readwrite"),a=c.dirname(t),h=c.basename(t),l=c.dirname(i),f=c.basename(i),d={},p={},_=!1;if(0===(l+"/").indexOf(t+"/"))return r(new u(o.EBUSY,a));var g=function(o){n.findINodeAndDirListing(s,o,(function(c,g,v){c?_||(_=!0,s.abort((function(){r(c)}))):(d[o]=g,p[o]=v,function(){if(!_&&p.hasOwnProperty(a)&&p.hasOwnProperty(l)){var o=p[a],c=d[a],g=p[l],v=d[l];if(o[h]){var y=o[h];delete o[h];var m=function(){g[f]=y,s.put(c.id,e.from(JSON.stringify(o)),!0,(function(t){Ut(t,s,r)&&(a===l?s.commit(r):s.put(v.id,e.from(JSON.stringify(g)),!0,(function(e){Ut(e,s,r)&&s.commit(r)})))}))};g[f]?n.getINode(s,i,g[f],(function(e,t){Ut(e,s,r)&&(t.isFile()?s.del(t.id,(function(e){Ut(e,s,r)&&s.del(g[f],(function(e){Ut(e,s,r)&&m()}))})):s.abort((function(e){r(u.EPERM(i))})))})):m()}else r(u.ENOENT(t))}}())}))};g(a),a!==l&&g(l)},i.prototype.stat=function(e,t,i){var r=this.store.beginTransaction("readonly");this.findINode(r,e,(function(e,t){Nt(e,i)&&i(null,t.toStats())}))},i.prototype.createFile=function(e,t,i,r){var n=this,s=this.store.beginTransaction("readwrite"),o=j();this.commitNewFile(s,e,d.FILE,i,o,(function(i,s){Nt(i,r)&&r(null,new $t(n,e,t,s.toStats(),o))}))},i.prototype.openFile=function(e,t,i){var r=this,n=this.store.beginTransaction("readonly");this.findINode(n,e,(function(s,o){Nt(s,i)&&n.get(o.id,(function(n,s){Nt(n,i)&&(void 0===s?i(u.ENOENT(e)):i(null,new $t(r,e,t,o.toStats(),s)))}))}))},i.prototype.unlink=function(e,t){this.removeEntry(e,!1,t)},i.prototype.rmdir=function(e,t){var i=this;this.readdir(e,(function(r,n){r?t(r):n.length>0?t(u.ENOTEMPTY(e)):i.removeEntry(e,!0,t)}))},i.prototype.mkdir=function(t,i,r){var n=this.store.beginTransaction("readwrite"),s=e.from("{}");this.commitNewFile(n,t,d.DIRECTORY,i,s,r)},i.prototype.readdir=function(e,t){var i=this,r=this.store.beginTransaction("readonly");this.findINode(r,e,(function(n,s){Nt(n,t)&&i.getDirListing(r,e,s,(function(e,i){Nt(e,t)&&t(null,Object.keys(i))}))}))},i.prototype._sync=function(e,t,i,r){var n=this,s=this.store.beginTransaction("readwrite");this._findINode(s,c.dirname(e),c.basename(e),(function(o,a){Ut(o,s,r)&&n.getINode(s,e,a,(function(e,n){if(Ut(e,s,r)){var o=n.update(i);s.put(n.id,t,!0,(function(e){Ut(e,s,r)&&(o?s.put(a,n.toBuffer(),!0,(function(e){Ut(e,s,r)&&s.commit(r)})):s.commit(r))}))}}))}))},i.prototype.makeRootDirectory=function(e){var t=this.store.beginTransaction("readwrite");t.get(Bt,(function(i,r){if(i||void 0===r){var n=(new Date).getTime(),s=new Ot(Pt(),4096,511|d.DIRECTORY,n,n,n);t.put(s.id,Mt(),!1,(function(i){Ut(i,t,e)&&t.put(Bt,s.toBuffer(),!1,(function(i){i?t.abort((function(){e(i)})):t.commit(e)}))}))}else t.commit(e)}))},i.prototype._findINode=function(e,t,i,r){var n=this,s=function(e,n,s){e?r(e):s[i]?r(null,s[i]):r(u.ENOENT(c.resolve(t,i)))};"/"===t?""===i?r(null,Bt):this.getINode(e,t,Bt,(function(i,o){Nt(i,r)&&n.getDirListing(e,t,o,(function(e,t){s(e,0,t)}))})):this.findINodeAndDirListing(e,t,s)},i.prototype.findINode=function(e,t,i){var r=this;this._findINode(e,c.dirname(t),c.basename(t),(function(n,s){Nt(n,i)&&r.getINode(e,t,s,i)}))},i.prototype.getINode=function(e,t,i,r){e.get(i,(function(e,i){Nt(e,r)&&(void 0===i?r(u.ENOENT(t)):r(null,Ot.fromBuffer(i)))}))},i.prototype.getDirListing=function(e,t,i,r){i.isDirectory()?e.get(i.id,(function(e,i){if(Nt(e,r))try{r(null,JSON.parse(i.toString()))}catch(e){r(u.ENOENT(t))}})):r(u.ENOTDIR(t))},i.prototype.findINodeAndDirListing=function(e,t,i){var r=this;this.findINode(e,t,(function(n,s){Nt(n,i)&&r.getDirListing(e,t,s,(function(e,t){Nt(e,i)&&i(null,s,t)}))}))},i.prototype.addNewNode=function(e,t,i){var r,n=0,s=function(){5==++n?i(new u(o.EIO,"Unable to commit data to key-value store.")):(r=Pt(),e.put(r,t,!1,(function(e,t){e||!t?s():i(null,r)})))};s()},i.prototype.commitNewFile=function(t,i,r,n,s,o){var a=this,h=c.dirname(i),l=c.basename(i),f=(new Date).getTime();if("/"===i)return o(u.EEXIST(i));this.findINodeAndDirListing(t,h,(function(c,h,d){Ut(c,t,o)&&(d[l]?t.abort((function(){o(u.EEXIST(i))})):a.addNewNode(t,s,(function(i,c){if(Ut(i,t,o)){var u=new Ot(c,s.length,n|r,f,f,f);a.addNewNode(t,u.toBuffer(),(function(i,r){Ut(i,t,o)&&(d[l]=r,t.put(h.id,e.from(JSON.stringify(d)),!0,(function(e){Ut(e,t,o)&&t.commit((function(e){Ut(e,t,o)&&o(null,u)}))})))}))}})))}))},i.prototype.removeEntry=function(t,i,r){var n=this,s=this.store.beginTransaction("readwrite"),o=c.dirname(t),a=c.basename(t);this.findINodeAndDirListing(s,o,(function(o,c,h){if(Ut(o,s,r))if(h[a]){var l=h[a];delete h[a],n.getINode(s,t,l,(function(n,o){Ut(n,s,r)&&(!i&&o.isDirectory()?s.abort((function(){r(u.EISDIR(t))})):i&&!o.isDirectory()?s.abort((function(){r(u.ENOTDIR(t))})):s.del(o.id,(function(t){Ut(t,s,r)&&s.del(l,(function(t){Ut(t,s,r)&&s.put(c.id,e.from(JSON.stringify(h)),!0,(function(e){Ut(e,s,r)&&s.commit(r)}))}))})))}))}else s.abort((function(){r(u.ENOENT(t))}))}))},i}(X),qt=function(){this.store={}};qt.prototype.name=function(){return Kt.Name},qt.prototype.clear=function(){this.store={}},qt.prototype.beginTransaction=function(e){return new Ht(this)},qt.prototype.get=function(e){return this.store[e]},qt.prototype.put=function(e,t,i){return!(!i&&this.store.hasOwnProperty(e)||(this.store[e]=t,0))},qt.prototype.del=function(e){delete this.store[e]};var Kt=function(e){function t(){e.call(this,{store:new qt})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){i(null,new t)},t}(zt);Kt.Name="InMemory",Kt.Options={};var Vt=Dt.indexedDB||Dt.mozIndexedDB||Dt.webkitIndexedDB||Dt.msIndexedDB;function Xt(e,t){switch(void 0===t&&(t=e.toString()),e.name){case"NotFoundError":return new u(o.ENOENT,t);case"QuotaExceededError":return new u(o.ENOSPC,t);default:return new u(o.EIO,t)}}function Yt(e,t,i){return void 0===t&&(t=o.EIO),void 0===i&&(i=null),function(r){r.preventDefault(),e(new u(t,null!==i?i:void 0))}}var Zt=function(e,t){this.tx=e,this.store=t};Zt.prototype.get=function(e,t){try{var i=this.store.get(e);i.onerror=Yt(t),i.onsuccess=function(e){var i=e.target.result;t(null,void 0===i?i:N(i))}}catch(e){t(Xt(e))}};var Gt=function(e){function t(t,i){e.call(this,t,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.put=function(e,t,i,r){try{var n,s=B(t);(n=i?this.store.put(s,e):this.store.add(s,e)).onerror=Yt(r),n.onsuccess=function(e){r(null,!0)}}catch(e){r(Xt(e))}},t.prototype.del=function(e,t){try{var i=this.store.delete(e);i.onerror=Yt(t),i.onsuccess=function(e){t()}}catch(e){t(Xt(e))}},t.prototype.commit=function(e){setTimeout(e,0)},t.prototype.abort=function(e){var t=null;try{this.tx.abort()}catch(e){t=Xt(e)}finally{e(t)}},t}(Zt),Jt=function(e,t){var i=this;void 0===t&&(t="browserfs"),this.storeName=t;var r=Vt.open(this.storeName,1);r.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains(i.storeName)&&t.deleteObjectStore(i.storeName),t.createObjectStore(i.storeName)},r.onsuccess=function(t){i.db=t.target.result,e(null,i)},r.onerror=Yt(e,o.EACCES)};Jt.prototype.name=function(){return Qt.Name+" - "+this.storeName},Jt.prototype.clear=function(e){try{var t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();t.onsuccess=function(t){setTimeout(e,0)},t.onerror=Yt(e)}catch(t){e(Xt(t))}},Jt.prototype.beginTransaction=function(e){void 0===e&&(e="readonly");var t=this.db.transaction(this.storeName,e),i=t.objectStore(this.storeName);if("readwrite"===e)return new Gt(t,i);if("readonly"===e)return new Zt(t,i);throw new u(o.EINVAL,"Invalid transaction type.")};var Qt=function(e){function t(i,r,n){var s=this;void 0===n&&(n=!0),e.call(this),this.store=new Jt((function(e){e?i(e):s.init(s.store,(function(e){i(e,s)}))}),r),x(n,t.Name,{storeName:r})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){new t(i,e.storeName,!1)},t.isAvailable=function(){try{return void 0!==Vt&&null!==Vt.open("__browserfs_test__")}catch(e){return!1}},t}(Wt);Qt.Name="IndexedDB",Qt.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var ei,ti=!1;try{Dt.localStorage.setItem("__test__",String.fromCharCode(55296)),ti=Dt.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(e){ti=!1}ei=ti?"binary_string":"binary_string_ie",e.isEncoding(ei)||(ei="base64");var ii=function(){};ii.prototype.name=function(){return ri.Name},ii.prototype.clear=function(){Dt.localStorage.clear()},ii.prototype.beginTransaction=function(e){return new Ht(this)},ii.prototype.get=function(t){try{var i=Dt.localStorage.getItem(t);if(null!==i)return e.from(i,ei)}catch(e){}},ii.prototype.put=function(e,t,i){try{return!(!i&&null!==Dt.localStorage.getItem(e)||(Dt.localStorage.setItem(e,t.toString(ei)),0))}catch(e){throw new u(o.ENOSPC,"LocalStorage is full.")}},ii.prototype.del=function(e){try{Dt.localStorage.removeItem(e)}catch(t){throw new u(o.EIO,"Unable to delete key "+e+": "+t)}};var ri=function(e){function t(){e.call(this,{store:new ii})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){i(null,new t)},t.isAvailable=function(){return void 0!==Dt.localStorage},t}(zt);ri.Name="LocalStorage",ri.Options={};var ni=function(e){function t(){e.call(this),this.mountList=[],this.mntMap={},this.rootFs=new Kt}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){var r=new t;Object.keys(e).forEach((function(t){r.mount(t,e[t])})),i(null,r)},t.isAvailable=function(){return!0},t.prototype.mount=function(e,t){if("/"!==e[0]&&(e="/"+e),e=c.resolve(e),this.mntMap[e])throw new u(o.EINVAL,"Mount point "+e+" is already taken.");O(e,511,this.rootFs),this.mntMap[e]=t,this.mountList.push(e),this.mountList=this.mountList.sort((function(e,t){return t.length-e.length}))},t.prototype.umount=function(e){if("/"!==e[0]&&(e="/"+e),e=c.resolve(e),!this.mntMap[e])throw new u(o.EINVAL,"Mount point "+e+" is already unmounted.");for(delete this.mntMap[e],this.mountList.splice(this.mountList.indexOf(e),1);"/"!==e&&0===this.rootFs.readdirSync(e).length;)this.rootFs.rmdirSync(e),e=c.dirname(e)},t.prototype._getFs=function(e){for(var t=this.mountList,i=t.length,r=0;r<i;r++){var n=t[r];if(n.length<=e.length&&0===e.indexOf(n))return""===(e=e.substr(n.length>1?n.length:0))&&(e="/"),{fs:this.mntMap[n],path:e}}return{fs:this.rootFs,path:e}},t.prototype.getName=function(){return t.Name},t.prototype.diskSpace=function(e,t){t(0,0)},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.standardizeError=function(e,t,i){var r=e.message.indexOf(t);return-1!==r&&(e.message=e.message.substr(0,r)+i+e.message.substr(r+t.length),e.path=i),e},t.prototype.rename=function(e,t,i){var r=this,n=this._getFs(e),s=this._getFs(t);return n.fs===s.fs?n.fs.rename(n.path,s.path,(function(o){o&&r.standardizeError(r.standardizeError(o,n.path,e),s.path,t),i(o)})):k.readFile(e,(function(r,n){if(r)return i(r);k.writeFile(t,n,(function(t){if(t)return i(t);k.unlink(e,i)}))}))},t.prototype.renameSync=function(e,t){var i=this._getFs(e),r=this._getFs(t);if(i.fs===r.fs)try{return i.fs.renameSync(i.path,r.path)}catch(n){throw this.standardizeError(this.standardizeError(n,i.path,e),r.path,t),n}var n=k.readFileSync(e);return k.writeFileSync(t,n),k.unlinkSync(e)},t.prototype.readdirSync=function(e){var t=this._getFs(e),i=null;if(t.fs!==this.rootFs)try{i=this.rootFs.readdirSync(e)}catch(e){}try{var r=t.fs.readdirSync(t.path);return null===i?r:r.concat(i.filter((function(e){return-1===r.indexOf(e)})))}catch(r){if(null===i)throw this.standardizeError(r,t.path,e);return i}},t.prototype.readdir=function(e,t){var i=this,r=this._getFs(e);r.fs.readdir(r.path,(function(n,s){if(r.fs!==i.rootFs)try{var o=i.rootFs.readdirSync(e);s=s?s.concat(o.filter((function(e){return-1===s.indexOf(e)}))):o}catch(s){if(n)return t(i.standardizeError(n,r.path,e))}else if(n)return t(i.standardizeError(n,r.path,e));t(null,s)}))},t.prototype.rmdirSync=function(e){var t=this._getFs(e);if(this._containsMountPt(e))throw u.ENOTEMPTY(e);try{t.fs.rmdirSync(t.path)}catch(i){throw this.standardizeError(i,t.path,e)}},t.prototype.rmdir=function(e,t){var i=this,r=this._getFs(e);this._containsMountPt(e)?t(u.ENOTEMPTY(e)):r.fs.rmdir(r.path,(function(n){t(n?i.standardizeError(n,r.path,e):null)}))},t.prototype._containsMountPt=function(e){for(var t=this.mountList,i=t.length,r=0;r<i;r++){var n=t[r];if(n.length>=e.length&&n.slice(0,e.length)===e)return!0}return!1},t}(X);function si(e,t,i){return t?function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];var r=t[0],n=this._getFs(r);t[0]=n.path;try{return n.fs[e].apply(n.fs,t)}catch(e){throw this.standardizeError(e,n.path,r),e}}:function(){for(var t=this,i=[],r=arguments.length;r--;)i[r]=arguments[r];var n=i[0],s=this._getFs(n);if(i[0]=s.path,"function"==typeof i[i.length-1]){var o=i[i.length-1];i[i.length-1]=function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];e.length>0&&e[0]instanceof u&&t.standardizeError(e[0],s.path,n),o.apply(null,e)}}return s.fs[e].apply(s.fs,i)}}ni.Name="MountableFileSystem",ni.Options={};for(var oi,ai=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],ci=0;ci<ai.length;ci++)for(var hi=0,li=ai[ci];hi<li.length;hi+=1){var ui=li[hi];ni.prototype[ui]=si(ui,!1),ni.prototype[ui+"Sync"]=si(ui+"Sync",!0)}if("undefined"!=typeof setImmediate)oi=setImmediate;else{var fi=Dt,di=[],pi="zero-timeout-message";if(function(){if(void 0!==fi.importScripts||!fi.postMessage)return!1;var e=!0,t=fi.onmessage;return fi.onmessage=function(){e=!1},fi.postMessage("","*"),fi.onmessage=t,e}()){oi=function(e){di.push(e),fi.postMessage(pi,"*")};var _i=function(e){if(e.source===self&&e.data===pi&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,di.length>0))return di.shift()()};fi.addEventListener?fi.addEventListener("message",_i,!0):fi.attachEvent("onmessage",_i)}else if(fi.MessageChannel){var gi=new fi.MessageChannel;gi.port1.onmessage=function(e){if(di.length>0)return di.shift()()},oi=function(e){di.push(e),gi.port2.postMessage("")}}else oi=function(e){return setTimeout(e,0)}}var vi=oi,yi=function(){this._locked=!1,this._waiters=[]};yi.prototype.lock=function(e){this._locked?this._waiters.push(e):(this._locked=!0,e())},yi.prototype.unlock=function(){if(!this._locked)throw new Error("unlock of a non-locked mutex");var e=this._waiters.shift();e?vi(e):this._locked=!1},yi.prototype.tryLock=function(){return!this._locked&&(this._locked=!0,!0)},yi.prototype.isLocked=function(){return this._locked};var mi=function(e){this._fs=e,this._mu=new yi};mi.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},mi.prototype.getFSUnlocked=function(){return this._fs},mi.prototype.initialize=function(e){this._fs.initialize(e)},mi.prototype.diskSpace=function(e,t){this._fs.diskSpace(e,t)},mi.prototype.isReadOnly=function(){return this._fs.isReadOnly()},mi.prototype.supportsLinks=function(){return this._fs.supportsLinks()},mi.prototype.supportsProps=function(){return this._fs.supportsProps()},mi.prototype.supportsSynch=function(){return this._fs.supportsSynch()},mi.prototype.rename=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.rename(e,t,(function(e){r._mu.unlock(),i(e)}))}))},mi.prototype.renameSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(e,t)},mi.prototype.stat=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.stat(e,t,(function(e,t){r._mu.unlock(),i(e,t)}))}))},mi.prototype.statSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(e,t)},mi.prototype.open=function(e,t,i,r){var n=this;this._mu.lock((function(){n._fs.open(e,t,i,(function(e,t){n._mu.unlock(),r(e,t)}))}))},mi.prototype.openSync=function(e,t,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(e,t,i)},mi.prototype.unlink=function(e,t){var i=this;this._mu.lock((function(){i._fs.unlink(e,(function(e){i._mu.unlock(),t(e)}))}))},mi.prototype.unlinkSync=function(e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(e)},mi.prototype.rmdir=function(e,t){var i=this;this._mu.lock((function(){i._fs.rmdir(e,(function(e){i._mu.unlock(),t(e)}))}))},mi.prototype.rmdirSync=function(e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(e)},mi.prototype.mkdir=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.mkdir(e,t,(function(e){r._mu.unlock(),i(e)}))}))},mi.prototype.mkdirSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(e,t)},mi.prototype.readdir=function(e,t){var i=this;this._mu.lock((function(){i._fs.readdir(e,(function(e,r){i._mu.unlock(),t(e,r)}))}))},mi.prototype.readdirSync=function(e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(e)},mi.prototype.exists=function(e,t){var i=this;this._mu.lock((function(){i._fs.exists(e,(function(e){i._mu.unlock(),t(e)}))}))},mi.prototype.existsSync=function(e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(e)},mi.prototype.realpath=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.realpath(e,t,(function(e,t){r._mu.unlock(),i(e,t)}))}))},mi.prototype.realpathSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(e,t)},mi.prototype.truncate=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.truncate(e,t,(function(e){r._mu.unlock(),i(e)}))}))},mi.prototype.truncateSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(e,t)},mi.prototype.readFile=function(e,t,i,r){var n=this;this._mu.lock((function(){n._fs.readFile(e,t,i,(function(e,t){n._mu.unlock(),r(e,t)}))}))},mi.prototype.readFileSync=function(e,t,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(e,t,i)},mi.prototype.writeFile=function(e,t,i,r,n,s){var o=this;this._mu.lock((function(){o._fs.writeFile(e,t,i,r,n,(function(e){o._mu.unlock(),s(e)}))}))},mi.prototype.writeFileSync=function(e,t,i,r,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(e,t,i,r,n)},mi.prototype.appendFile=function(e,t,i,r,n,s){var o=this;this._mu.lock((function(){o._fs.appendFile(e,t,i,r,n,(function(e){o._mu.unlock(),s(e)}))}))},mi.prototype.appendFileSync=function(e,t,i,r,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(e,t,i,r,n)},mi.prototype.chmod=function(e,t,i,r){var n=this;this._mu.lock((function(){n._fs.chmod(e,t,i,(function(e){n._mu.unlock(),r(e)}))}))},mi.prototype.chmodSync=function(e,t,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(e,t,i)},mi.prototype.chown=function(e,t,i,r,n){var s=this;this._mu.lock((function(){s._fs.chown(e,t,i,r,(function(e){s._mu.unlock(),n(e)}))}))},mi.prototype.chownSync=function(e,t,i,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(e,t,i,r)},mi.prototype.utimes=function(e,t,i,r){var n=this;this._mu.lock((function(){n._fs.utimes(e,t,i,(function(e){n._mu.unlock(),r(e)}))}))},mi.prototype.utimesSync=function(e,t,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(e,t,i)},mi.prototype.link=function(e,t,i){var r=this;this._mu.lock((function(){r._fs.link(e,t,(function(e){r._mu.unlock(),i(e)}))}))},mi.prototype.linkSync=function(e,t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(e,t)},mi.prototype.symlink=function(e,t,i,r){var n=this;this._mu.lock((function(){n._fs.symlink(e,t,i,(function(e){n._mu.unlock(),r(e)}))}))},mi.prototype.symlinkSync=function(e,t,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(e,t,i)},mi.prototype.readlink=function(e,t){var i=this;this._mu.lock((function(){i._fs.readlink(e,(function(e,r){i._mu.unlock(),t(e,r)}))}))},mi.prototype.readlinkSync=function(e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(e)};var Si="/.deletedFiles.log";function wi(e){return 146|e}function bi(e){return p.getFileFlag(e)}var Ei,Ci=function(e){function t(t,i,r,n,s){e.call(this,t,i,r,n,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.sync=function(e){var t=this;this.isDirty()?this._fs._syncAsync(this,(function(i){t.resetDirty(),e(i)})):e(null)},t.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},t.prototype.close=function(e){this.sync(e)},t.prototype.closeSync=function(){this.syncSync()},t}(G),ki=function(e){function t(t,i){if(e.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=t,this._readable=i,this._writable.isReadOnly())throw new u(o.EINVAL,"Writable file system must be writable.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.isAvailable=function(){return!0},t.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},t.prototype._syncAsync=function(e,t){var i=this;this.createParentDirectoriesAsync(e.getPath(),(function(r){if(r)return t(r);i._writable.writeFile(e.getPath(),e.getBuffer(),null,bi("w"),e.getStats().mode,t)}))},t.prototype._syncSync=function(e){this.createParentDirectories(e.getPath()),this._writable.writeFileSync(e.getPath(),e.getBuffer(),null,bi("w"),e.getStats().mode)},t.prototype.getName=function(){return Li.Name},t.prototype.initialize=function(e){var t=this,i=this._initializeCallbacks,r=function(e){t._isInitialized=!e,t._initializeCallbacks=[],i.forEach((function(t){return t(e)}))};if(this._isInitialized)return e();i.push(e),1===i.length&&this._writable.readFile(Si,"utf8",bi("r"),(function(e,i){if(e){if(e.errno!==o.ENOENT)return r(e)}else t._deleteLog=i;t._reparseDeletionLog(),r()}))},t.prototype.isReadOnly=function(){return!1},t.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},t.prototype.getDeletionLog=function(){return this._deleteLog},t.prototype.restoreDeletionLog=function(e){this._deleteLog=e,this._reparseDeletionLog(),this.updateLog("")},t.prototype.rename=function(e,t,i){var r=this;if(this.checkInitAsync(i)&&!this.checkPathAsync(e,i)&&!this.checkPathAsync(t,i))return e===Si||t===Si?i(u.EPERM("Cannot rename deletion log.")):e===t?i():void this.stat(e,!1,(function(n,s){return n?i(n):r.stat(t,!1,(function(n,a){var h=r;function l(r){var n=r.shift();if(!n)return i();var s=c.resolve(e,n),o=c.resolve(t,n);h.rename(s,o,(function(e){if(e)return i(e);l(r)}))}var f=511;if(s.isDirectory()){if(n)return n.errno!==o.ENOENT?i(n):r._writable.exists(e,(function(n){if(n)return r._writable.rename(e,t,i);r._writable.mkdir(t,f,(function(t){if(t)return i(t);r._readable.readdir(e,(function(e,t){if(e)return i();l(t)}))}))}));if(f=a.mode,!a.isDirectory())return i(u.ENOTDIR(t));r.readdir(t,(function(n,s){if(s&&s.length)return i(u.ENOTEMPTY(t));r._readable.readdir(e,(function(e,t){if(e)return i();l(t)}))}))}if(a&&a.isDirectory())return i(u.EISDIR(t));r.readFile(e,null,bi("r"),(function(n,o){return n?i(n):r.writeFile(t,o,null,bi("w"),s.mode,(function(t){return t?i(t):r.unlink(e,i)}))}))}))}))},t.prototype.renameSync=function(e,t){var i=this;if(this.checkInitialized(),this.checkPath(e),this.checkPath(t),e===Si||t===Si)throw u.EPERM("Cannot rename deletion log.");var r=this.statSync(e,!1);if(r.isDirectory()){if(e===t)return;var n=511;if(this.existsSync(t)){var s=this.statSync(t,!1);if(n=s.mode,!s.isDirectory())throw u.ENOTDIR(t);if(this.readdirSync(t).length>0)throw u.ENOTEMPTY(t)}this._writable.existsSync(e)?this._writable.renameSync(e,t):this._writable.existsSync(t)||this._writable.mkdirSync(t,n),this._readable.existsSync(e)&&this._readable.readdirSync(e).forEach((function(r){i.renameSync(c.resolve(e,r),c.resolve(t,r))}))}else{if(this.existsSync(t)&&this.statSync(t,!1).isDirectory())throw u.EISDIR(t);this.writeFileSync(t,this.readFileSync(e,null,bi("r")),null,bi("w"),r.mode)}e!==t&&this.existsSync(e)&&this.unlinkSync(e)},t.prototype.stat=function(e,t,i){var r=this;this.checkInitAsync(i)&&this._writable.stat(e,t,(function(n,s){n&&n.errno===o.ENOENT?(r._deletedFiles[e]&&i(u.ENOENT(e)),r._readable.stat(e,t,(function(e,t){t&&((t=t.clone()).mode=wi(t.mode)),i(e,t)}))):i(n,s)}))},t.prototype.statSync=function(e,t){this.checkInitialized();try{return this._writable.statSync(e,t)}catch(r){if(this._deletedFiles[e])throw u.ENOENT(e);var i=this._readable.statSync(e,t).clone();return i.mode=wi(i.mode),i}},t.prototype.open=function(e,t,i,r){var n=this;this.checkInitAsync(r)&&!this.checkPathAsync(e,r)&&this.stat(e,!1,(function(s,o){if(!o)return t.pathNotExistsAction()===l.CREATE_FILE?n.createParentDirectoriesAsync(e,(function(s){return s?r(s):n._writable.open(e,t,i,r)})):r(u.ENOENT(e));switch(t.pathExistsAction()){case l.TRUNCATE_FILE:return n.createParentDirectoriesAsync(e,(function(s){if(s)return r(s);n._writable.open(e,t,i,r)}));case l.NOP:return n._writable.exists(e,(function(s){s?n._writable.open(e,t,i,r):((o=o.clone()).mode=i,n._readable.readFile(e,null,bi("r"),(function(i,s){if(i)return r(i);-1===o.size&&(o.size=s.length);var a=new Ci(n,e,t,o,s);r(null,a)})))}));default:return r(u.EEXIST(e))}}))},t.prototype.openSync=function(e,t,i){if(this.checkInitialized(),this.checkPath(e),e===Si)throw u.EPERM("Cannot open deletion log.");if(!this.existsSync(e)){if(t.pathNotExistsAction()===l.CREATE_FILE)return this.createParentDirectories(e),this._writable.openSync(e,t,i);throw u.ENOENT(e)}switch(t.pathExistsAction()){case l.TRUNCATE_FILE:return this.createParentDirectories(e),this._writable.openSync(e,t,i);case l.NOP:if(this._writable.existsSync(e))return this._writable.openSync(e,t,i);var r=this._readable.readFileSync(e,null,bi("r")),n=this._readable.statSync(e,!1).clone();return n.mode=i,new Ci(this,e,t,n,r);default:throw u.EEXIST(e)}},t.prototype.unlink=function(e,t){var i=this;this.checkInitAsync(t)&&!this.checkPathAsync(e,t)&&this.exists(e,(function(r){if(!r)return t(u.ENOENT(e));i._writable.exists(e,(function(r){if(r)return i._writable.unlink(e,(function(r){if(r)return t(r);i.exists(e,(function(r){r&&i.deletePath(e),t(null)}))}));i.deletePath(e),t(null)}))}))},t.prototype.unlinkSync=function(e){if(this.checkInitialized(),this.checkPath(e),!this.existsSync(e))throw u.ENOENT(e);this._writable.existsSync(e)&&this._writable.unlinkSync(e),this.existsSync(e)&&this.deletePath(e)},t.prototype.rmdir=function(e,t){var i=this;if(this.checkInitAsync(t)){var r=function(){i.readdir(e,(function(r,n){return r?t(r):n.length?t(u.ENOTEMPTY(e)):(i.deletePath(e),void t(null))}))};this.exists(e,(function(n){if(!n)return t(u.ENOENT(e));i._writable.exists(e,(function(n){n?i._writable.rmdir(e,(function(n){if(n)return t(n);i._readable.exists(e,(function(e){e?r():t()}))})):r()}))}))}},t.prototype.rmdirSync=function(e){if(this.checkInitialized(),!this.existsSync(e))throw u.ENOENT(e);if(this._writable.existsSync(e)&&this._writable.rmdirSync(e),this.existsSync(e)){if(this.readdirSync(e).length>0)throw u.ENOTEMPTY(e);this.deletePath(e)}},t.prototype.mkdir=function(e,t,i){var r=this;this.checkInitAsync(i)&&this.exists(e,(function(n){if(n)return i(u.EEXIST(e));r.createParentDirectoriesAsync(e,(function(n){if(n)return i(n);r._writable.mkdir(e,t,i)}))}))},t.prototype.mkdirSync=function(e,t){if(this.checkInitialized(),this.existsSync(e))throw u.EEXIST(e);this.createParentDirectories(e),this._writable.mkdirSync(e,t)},t.prototype.readdir=function(e,t){var i=this;this.checkInitAsync(t)&&this.stat(e,!1,(function(r,n){return r?t(r):n.isDirectory()?void i._writable.readdir(e,(function(r,n){if(r&&"ENOENT"!==r.code)return t(r);!r&&n||(n=[]),i._readable.readdir(e,(function(r,s){!r&&s||(s=[]);var o={},a=n.concat(s.filter((function(t){return!i._deletedFiles[e+"/"+t]}))).filter((function(e){var t=!o[e];return o[e]=!0,t}));t(null,a)}))})):t(u.ENOTDIR(e))}))},t.prototype.readdirSync=function(e){var t=this;if(this.checkInitialized(),!this.statSync(e,!1).isDirectory())throw u.ENOTDIR(e);var i=[];try{i=i.concat(this._writable.readdirSync(e))}catch(e){}try{i=i.concat(this._readable.readdirSync(e).filter((function(i){return!t._deletedFiles[e+"/"+i]})))}catch(e){}var r={};return i.filter((function(e){var t=!r[e];return r[e]=!0,t}))},t.prototype.exists=function(e,t){var i=this;this.checkInitialized(),this._writable.exists(e,(function(r){if(r)return t(!0);i._readable.exists(e,(function(r){t(r&&!0!==i._deletedFiles[e])}))}))},t.prototype.existsSync=function(e){return this.checkInitialized(),this._writable.existsSync(e)||this._readable.existsSync(e)&&!0!==this._deletedFiles[e]},t.prototype.chmod=function(e,t,i,r){var n=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(e,(function(s){if(s)return r(s);n._writable.chmod(e,t,i,r)}))},t.prototype.chmodSync=function(e,t,i){var r=this;this.checkInitialized(),this.operateOnWritable(e,(function(){r._writable.chmodSync(e,t,i)}))},t.prototype.chown=function(e,t,i,r,n){var s=this;this.checkInitAsync(n)&&this.operateOnWritableAsync(e,(function(o){if(o)return n(o);s._writable.chown(e,t,i,r,n)}))},t.prototype.chownSync=function(e,t,i,r){var n=this;this.checkInitialized(),this.operateOnWritable(e,(function(){n._writable.chownSync(e,t,i,r)}))},t.prototype.utimes=function(e,t,i,r){var n=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(e,(function(s){if(s)return r(s);n._writable.utimes(e,t,i,r)}))},t.prototype.utimesSync=function(e,t,i){var r=this;this.checkInitialized(),this.operateOnWritable(e,(function(){r._writable.utimesSync(e,t,i)}))},t.prototype.deletePath=function(e){this._deletedFiles[e]=!0,this.updateLog("d"+e+"\n")},t.prototype.updateLog=function(e){var t=this;this._deleteLog+=e,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(Si,this._deleteLog,"utf8",p.getFileFlag("w"),420,(function(e){t._deleteLogUpdatePending=!1,e?t._deleteLogError=e:t._deleteLogUpdateNeeded&&(t._deleteLogUpdateNeeded=!1,t.updateLog(""))})))},t.prototype._reparseDeletionLog=function(){var e=this;this._deletedFiles={},this._deleteLog.split("\n").forEach((function(t){e._deletedFiles[t.slice(1)]="d"===t.slice(0,1)}))},t.prototype.checkInitialized=function(){if(!this._isInitialized)throw new u(o.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){var e=this._deleteLogError;throw this._deleteLogError=null,e}},t.prototype.checkInitAsync=function(e){if(!this._isInitialized)return e(new u(o.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){var t=this._deleteLogError;return this._deleteLogError=null,e(t),!1}return!0},t.prototype.checkPath=function(e){if(e===Si)throw u.EPERM(e)},t.prototype.checkPathAsync=function(e,t){return e===Si&&(t(u.EPERM(e)),!0)},t.prototype.createParentDirectoriesAsync=function(e,t){var i=c.dirname(e),r=[],n=this;function s(){if(!r.length)return t();var e=r.pop();n._readable.stat(e,!1,(function(i,r){if(!r)return t();n._writable.mkdir(e,r.mode,(function(e){if(e)return t(e);s()}))}))}this._writable.stat(i,!1,(function e(t,o){t?(r.push(i),i=c.dirname(i),n._writable.stat(i,!1,e)):s()}))},t.prototype.createParentDirectories=function(e){for(var t=this,i=c.dirname(e),r=[];!this._writable.existsSync(i);)r.push(i),i=c.dirname(i);(r=r.reverse()).forEach((function(e){t._writable.mkdirSync(e,t.statSync(e,!1).mode)}))},t.prototype.operateOnWritable=function(e,t){if(!this.existsSync(e))throw u.ENOENT(e);this._writable.existsSync(e)||this.copyToWritable(e),t()},t.prototype.operateOnWritableAsync=function(e,t){var i=this;this.exists(e,(function(r){if(!r)return t(u.ENOENT(e));i._writable.exists(e,(function(r){if(!r)return i.copyToWritableAsync(e,t);t()}))}))},t.prototype.copyToWritable=function(e){var t=this.statSync(e,!1);t.isDirectory()?this._writable.mkdirSync(e,t.mode):this.writeFileSync(e,this._readable.readFileSync(e,null,bi("r")),null,bi("w"),this.statSync(e,!1).mode)},t.prototype.copyToWritableAsync=function(e,t){var i=this;this.stat(e,!1,(function(r,n){return r?t(r):n.isDirectory()?i._writable.mkdir(e,n.mode,t):void i._readable.readFile(e,null,bi("r"),(function(r,s){if(r)return t(r);i.writeFile(e,s,null,bi("w"),n.mode,t)}))}))},t}(X),Li=function(e){function t(i,r,n){void 0===n&&(n=!0),e.call(this,new ki(i,r)),x(n,t.Name,{readable:"readable file system",writable:"writable file system"})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){try{var r=new t(e.writable,e.readable,!1);r.initialize((function(e){i(e,r)}),!1)}catch(e){i(e)}},t.isAvailable=function(){return ki.isAvailable()},t.prototype.initialize=function(t,i){void 0===i&&(i=!0),i&&console.warn("[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use 'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)' to create and initialize OverlayFS instances."),e.prototype.initialize.call(this,t)},t.prototype.getOverlayedFileSystems=function(){return e.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},t.prototype.unwrap=function(){return e.prototype.getFSUnlocked.call(this)},t}(mi);Li.Name="OverlayFS",Li.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},function(e){e[e.CB=0]="CB",e[e.FD=1]="FD",e[e.API_ERROR=2]="API_ERROR",e[e.STATS=3]="STATS",e[e.PROBE=4]="PROBE",e[e.FILEFLAG=5]="FILEFLAG",e[e.BUFFER=6]="BUFFER",e[e.ERROR=7]="ERROR"}(Ei||(Ei={}));var Ri=function(){this._callbacks={},this._nextId=0};Ri.prototype.toRemoteArg=function(e){var t=this._nextId++;return this._callbacks[t]=e,{type:Ei.CB,id:t}},Ri.prototype.toLocalArg=function(e){var t=this._callbacks[e];return delete this._callbacks[e],t};var Di=function(){this._fileDescriptors={},this._nextId=0};function xi(e){return{type:Ei.API_ERROR,errorData:Pi(e.writeToBuffer())}}function Ai(e){return u.fromBuffer(Ni(e.errorData))}function Ti(e){return{type:Ei.ERROR,name:e.name,message:e.message,stack:e.stack}}function Ii(e){var t=Dt[e.name];"function"!=typeof t&&(t=Error);var i=new t(e.message);return i.stack=e.stack,i}function Oi(e){return{type:Ei.STATS,statsData:Pi(e.toBuffer())}}function Bi(e){return _.fromBuffer(Ni(e.statsData))}function Fi(e){return{type:Ei.FILEFLAG,flagStr:e.getFlagString()}}function Mi(e){return p.getFileFlag(e.flagStr)}function Pi(e){return B(e)}function Ni(e){return N(e)}function Ui(e){return{type:Ei.BUFFER,data:Pi(e)}}function Hi(e){return Ni(e.data)}Di.prototype.toRemoteArg=function(t,i,r,n){var s,o,a=this._nextId++;this._fileDescriptors[a]=t,t.stat((function(c,h){c?n(c):(o=Pi(h.toBuffer()),r.isReadable()?t.read(e.alloc(h.size),0,h.size,0,(function(e,t,c){e?n(e):(s=Pi(c),n(null,{type:Ei.FD,id:a,data:s,stat:o,path:i,flag:r.getFlagString()}))})):n(null,{type:Ei.FD,id:a,data:new ArrayBuffer(0),stat:o,path:i,flag:r.getFlagString()}))}))},Di.prototype.applyFdAPIRequest=function(e,t){var i=this,r=e.args[0];this._applyFdChanges(r,(function(n,s){n?t(n):s[e.method]((function(n){"close"===e.method&&delete i._fileDescriptors[r.id],t(n)}))}))},Di.prototype._applyFdChanges=function(e,t){var i=this._fileDescriptors[e.id],r=Ni(e.data),n=_.fromBuffer(Ni(e.stat)),s=p.getFileFlag(e.flag);s.isWriteable()?i.write(r,0,r.length,s.isAppendable()?i.getPos():0,(function(e){function o(){i.stat((function(e,r){e?t(e):r.mode!==n.mode?i.chmod(n.mode,(function(e){t(e,i)})):t(e,i)}))}e?t(e):s.isAppendable()?o():i.truncate(r.length,(function(){o()}))})):t(null,i)};var ji=function(e){function t(t,i,r,n,s,o){e.call(this,t,i,r,n,o),this._remoteFdId=s}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getRemoteFdId=function(){return this._remoteFdId},t.prototype.toRemoteArg=function(){return{type:Ei.FD,id:this._remoteFdId,data:Pi(this.getBuffer()),stat:Pi(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}},t.prototype.sync=function(e){this._syncClose("sync",e)},t.prototype.close=function(e){this._syncClose("close",e)},t.prototype._syncClose=function(e,t){var i=this;this.isDirty()?this._fs.syncClose(e,this,(function(e){e||i.resetDirty(),t(e)})):t()},t}(G),zi=function(t){function i(e,r){var n=this;void 0===r&&(r=!0),t.call(this),this._callbackConverter=new Ri,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=e,x(r,i.Name,{worker:"Web Worker instance"}),this._worker.addEventListener("message",(function(e){var t,i=e.data;if((t=i)&&"object"==typeof t&&t.hasOwnProperty("browserfsMessage")&&t.browserfsMessage){var r,s=i.args,o=new Array(s.length);for(r=0;r<o.length;r++)o[r]=n._argRemote2Local(s[r]);n._callbackConverter.toLocalArg(i.cbId).apply(null,o)}}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.Create=function(e,t){var r=new i(e.worker,!1);r.initialize((function(){t(null,r)}))},i.isAvailable=function(){return"undefined"!=typeof importScripts||"undefined"!=typeof Worker},i.attachRemoteListener=function(t){var i=new Di;function r(t,r,n){"object"==typeof t?t instanceof _?n(null,Oi(t)):t instanceof u?n(null,xi(t)):t instanceof Z?n(null,i.toRemoteArg(t,r[0],r[1],n)):t instanceof p?n(null,Fi(t)):t instanceof e?n(null,Ui(t)):t instanceof Error?n(null,Ti(t)):n(null,t):n(null,t)}function n(e,i){if(!e)return e;if("object"==typeof e){if("number"!=typeof e.type)return e;var n=e;switch(n.type){case Ei.CB:var s=e.id;return function(){var e,n,o=arguments,a=new Array(arguments.length),c=arguments.length;function h(e){c>0&&(c=-1,n={browserfsMessage:!0,cbId:s,args:[xi(e)]},t.postMessage(n))}for(e=0;e<arguments.length;e++)!function(e,o){r(o,i,(function(i,r){a[e]=r,i?h(i):0==--c&&(n={browserfsMessage:!0,cbId:s,args:a},t.postMessage(n))}))}(e,o[e]);0===arguments.length&&(n={browserfsMessage:!0,cbId:s,args:a},t.postMessage(n))};case Ei.API_ERROR:return Ai(n);case Ei.STATS:return Bi(n);case Ei.FILEFLAG:return Mi(n);case Ei.BUFFER:return Hi(n);case Ei.ERROR:return Ii(n);default:return e}}return e}t.addEventListener("message",(function(e){var r,s,o=e.data;if((s=o)&&"object"==typeof s&&s.hasOwnProperty("browserfsMessage")&&s.browserfsMessage){var a=o.args,c=new Array(a.length);switch(o.method){case"close":case"sync":r=a[1],i.applyFdAPIRequest(o,(function(e){var i={browserfsMessage:!0,cbId:r.id,args:e?[xi(e)]:[]};t.postMessage(i)}));break;case"probe":!function(){var e=k.getRootFS(),i=a[1],r={type:Ei.PROBE,isReadOnly:e.isReadOnly(),supportsLinks:e.supportsLinks(),supportsProps:e.supportsProps()},n={browserfsMessage:!0,cbId:i.id,args:[r]};t.postMessage(n)}();break;default:for(var h=0;h<a.length;h++)c[h]=n(a[h],c);var l=k.getRootFS();l[o.method].apply(l,c)}}}))},i.prototype.getName=function(){return i.Name},i.prototype.initialize=function(e){var t=this;if(this._isInitialized)e();else{var i={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(j()),this._callbackConverter.toRemoteArg((function(i){t._isInitialized=!0,t._isReadOnly=i.isReadOnly,t._supportLinks=i.supportsLinks,t._supportProps=i.supportsProps,e()}))]};this._worker.postMessage(i)}},i.prototype.isReadOnly=function(){return this._isReadOnly},i.prototype.supportsSynch=function(){return!1},i.prototype.supportsLinks=function(){return this._supportLinks},i.prototype.supportsProps=function(){return this._supportProps},i.prototype.rename=function(e,t,i){this._rpc("rename",arguments)},i.prototype.stat=function(e,t,i){this._rpc("stat",arguments)},i.prototype.open=function(e,t,i,r){this._rpc("open",arguments)},i.prototype.unlink=function(e,t){this._rpc("unlink",arguments)},i.prototype.rmdir=function(e,t){this._rpc("rmdir",arguments)},i.prototype.mkdir=function(e,t,i){this._rpc("mkdir",arguments)},i.prototype.readdir=function(e,t){this._rpc("readdir",arguments)},i.prototype.exists=function(e,t){this._rpc("exists",arguments)},i.prototype.realpath=function(e,t,i){this._rpc("realpath",arguments)},i.prototype.truncate=function(e,t,i){this._rpc("truncate",arguments)},i.prototype.readFile=function(e,t,i,r){this._rpc("readFile",arguments)},i.prototype.writeFile=function(e,t,i,r,n,s){this._rpc("writeFile",arguments)},i.prototype.appendFile=function(e,t,i,r,n,s){this._rpc("appendFile",arguments)},i.prototype.chmod=function(e,t,i,r){this._rpc("chmod",arguments)},i.prototype.chown=function(e,t,i,r,n){this._rpc("chown",arguments)},i.prototype.utimes=function(e,t,i,r){this._rpc("utimes",arguments)},i.prototype.link=function(e,t,i){this._rpc("link",arguments)},i.prototype.symlink=function(e,t,i,r){this._rpc("symlink",arguments)},i.prototype.readlink=function(e,t){this._rpc("readlink",arguments)},i.prototype.syncClose=function(e,t,i){this._worker.postMessage({browserfsMessage:!0,method:e,args:[t.toRemoteArg(),this._callbackConverter.toRemoteArg(i)]})},i.prototype._argRemote2Local=function(e){if(!e)return e;if("object"==typeof e){if("number"!=typeof e.type)return e;var t=e;switch(t.type){case Ei.API_ERROR:return Ai(t);case Ei.FD:var i=t;return new ji(this,i.path,p.getFileFlag(i.flag),_.fromBuffer(Ni(i.stat)),i.id,Ni(i.data));case Ei.STATS:return Bi(t);case Ei.FILEFLAG:return Mi(t);case Ei.BUFFER:return Hi(t);case Ei.ERROR:return Ii(t);default:return e}}return e},i.prototype._rpc=function(e,t){for(var i=new Array(t.length),r=0;r<t.length;r++)i[r]=this._argLocal2Remote(t[r]);var n={browserfsMessage:!0,method:e,args:i};this._worker.postMessage(n)},i.prototype._argLocal2Remote=function(t){if(!t)return t;switch(typeof t){case"object":return t instanceof _?Oi(t):t instanceof u?xi(t):t instanceof ji?t.toRemoteArg():t instanceof p?Fi(t):t instanceof e?Ui(t):t instanceof Error?Ti(t):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(t);default:return t}},i}(X);function $i(e,t,i){var r=new XMLHttpRequest;r.open("HEAD",t,e),r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return i(new u(r.status,"XHR HEAD error."));try{return i(null,parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(e){return i(new u(o.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}zi.Name="WorkerFS",zi.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(e,t){e.postMessage?t():t(new u(o.EINVAL,"option must be a Web Worker instance."))}}};var Wi=function(t,i,r){var n=new XMLHttpRequest;n.open("GET",t,!0);var s=!0;switch(i){case"buffer":n.responseType="arraybuffer";break;case"json":try{n.responseType="json",s="json"===n.responseType}catch(e){s=!1}break;default:return r(new u(o.EINVAL,"Invalid download type: "+i))}n.onreadystatechange=function(t){if(4===n.readyState){if(200!==n.status)return r(new u(n.status,"XHR error."));switch(i){case"buffer":return r(null,n.response?e.from(n.response):j());case"json":return r(null,s?n.response:JSON.parse(n.responseText))}}},n.send()},qi=A&&"undefined"!=typeof Blob?function(t,i){var r,n,s=new XMLHttpRequest;switch(s.open("GET",t,!1),i){case"buffer":s.responseType="arraybuffer";break;case"json":break;default:throw new u(o.EINVAL,"Invalid download type: "+i)}if(s.onreadystatechange=function(t){if(4===s.readyState)if(200===s.status)switch(i){case"buffer":r=e.from(s.response);break;case"json":r=JSON.parse(s.response)}else n=new u(s.status,"XHR error.")},s.send(),n)throw n;return r}:function(t,i){var r=new XMLHttpRequest;r.open("GET",t,!1);var n=null,s=null;if(r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return void(s=new u(r.status,"XHR error."));switch(i){case"buffer":var o=r.responseText;n=e.alloc(o.length);for(var a=0;a<o.length;a++)n[a]=o.charCodeAt(a);return;case"json":return void(n=JSON.parse(r.responseText))}}},r.send(),s)throw s;return n},Ki=function(){this._index={},this.addPath("/",new Xi)};Ki.fromListing=function(e){var t=new Ki,i=new Xi;t._index["/"]=i;for(var r=[["",e,i]];r.length>0;){var n=void 0,s=r.pop(),o=s[0],a=s[1],c=s[2];for(var h in a)if(a.hasOwnProperty(h)){var l=a[h],u=o+"/"+h;l?(t._index[u]=n=new Xi,r.push([u,l,n])):n=new Vi(new _(d.FILE,-1,365)),c&&(c._ls[h]=n)}}return t},Ki.prototype.fileIterator=function(e){var t=this;for(var i in t._index)if(t._index.hasOwnProperty(i))for(var r=t._index[i],n=0,s=r.getListing();n<s.length;n+=1){var o=s[n],a=r.getItem(o);Yi(a)&&e(a.getData())}},Ki.prototype.addPath=function(e,t){if(!t)throw new Error("Inode must be specified");if("/"!==e[0])throw new Error("Path must be absolute, got: "+e);if(this._index.hasOwnProperty(e))return this._index[e]===t;var i=this._split_path(e),r=i[0],n=i[1],s=this._index[r];return!(void 0===s&&"/"!==e&&(s=new Xi,!this.addPath(r,s))||"/"!==e&&!s.addItem(n,t)||(Zi(t)&&(this._index[e]=t),0))},Ki.prototype.addPathFast=function(e,t){var i=e.lastIndexOf("/"),r=0===i?"/":e.substring(0,i),n=e.substring(i+1),s=this._index[r];return void 0===s&&(s=new Xi,this.addPathFast(r,s)),!!s.addItem(n,t)&&(t.isDir()&&(this._index[e]=t),!0)},Ki.prototype.removePath=function(e){var t=this._split_path(e),i=t[0],r=t[1],n=this._index[i];if(void 0===n)return null;var s=n.remItem(r);if(null===s)return null;if(Zi(s)){for(var o=0,a=s.getListing();o<a.length;o+=1){var c=a[o];this.removePath(e+"/"+c)}"/"!==e&&delete this._index[e]}return s},Ki.prototype.ls=function(e){var t=this._index[e];return void 0===t?null:t.getListing()},Ki.prototype.getInode=function(e){var t=this._split_path(e),i=t[0],r=t[1],n=this._index[i];return void 0===n?null:i===e?n:n.getItem(r)},Ki.prototype._split_path=function(e){var t=c.dirname(e);return[t,e.substr(t.length+("/"===t?0:1))]};var Vi=function(e){this.data=e};Vi.prototype.isFile=function(){return!0},Vi.prototype.isDir=function(){return!1},Vi.prototype.getData=function(){return this.data},Vi.prototype.setData=function(e){this.data=e};var Xi=function(e){void 0===e&&(e=null),this.data=e,this._ls={}};function Yi(e){return!!e&&e.isFile()}function Zi(e){return!!e&&e.isDir()}Xi.prototype.isFile=function(){return!1},Xi.prototype.isDir=function(){return!0},Xi.prototype.getData=function(){return this.data},Xi.prototype.getStats=function(){return new _(d.DIRECTORY,4096,365)},Xi.prototype.getListing=function(){return Object.keys(this._ls)},Xi.prototype.getItem=function(e){var t=this._ls[e];return t||null},Xi.prototype.addItem=function(e,t){return!(e in this._ls)&&(this._ls[e]=t,!0)},Xi.prototype.remItem=function(e){var t=this._ls[e];return void 0===t?null:(delete this._ls[e],t)};var Gi=function(e){function t(i,r,n){void 0===r&&(r=""),void 0===n&&(n=!0),e.call(this),i||(i="index.json"),r.length>0&&"/"!==r.charAt(r.length-1)&&(r+="/"),this.prefixUrl=r;var s=null;if("string"==typeof i){if(!(s=this._requestFileSync(i,"json")))throw new Error("Unable to find listing at URL: ${listingUrlOrObj}")}else s=i;x(n,t.Name,{index:"string"==typeof i?i:"file index as an object",baseUrl:r}),this._index=Ki.fromListing(s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){void 0===e.index&&(e.index="index.json"),"string"==typeof e.index?t.FromURL(e.index,i,e.baseUrl,!1):i(null,new t(e.index,e.baseUrl,!1))},t.isAvailable=function(){return"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest},t.FromURL=function(e,i,r,n){void 0===r&&(r=e.slice(0,e.lastIndexOf("/")+1)),void 0===n&&(n=!0),n&&console.warn("[XmlHttpRequest] XmlHttpRequest.FromURL() is deprecated and will be removed in the next major release. Please use 'XmlHttpRequest.Create({ index: \""+e+'", baseUrl: "'+r+"\" }, cb)' instead."),Wi(e,"json",(function(e,n){e?i(e):i(null,new t(n,r,!1))}))},t.prototype.empty=function(){this._index.fileIterator((function(e){e.fileData=null}))},t.prototype.getName=function(){return t.Name},t.prototype.diskSpace=function(e,t){t(0,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.preloadFile=function(e,t){var i=this._index.getInode(e);if(!Yi(i))throw u.EISDIR(e);if(null===i)throw u.ENOENT(e);var r=i.getData();r.size=t.length,r.fileData=t},t.prototype.stat=function(e,t,i){var r,n=this._index.getInode(e);if(null===n)return i(u.ENOENT(e));Yi(n)?(r=n.getData()).size<0?this._requestFileSizeAsync(e,(function(e,t){if(e)return i(e);r.size=t,i(null,r.clone())})):i(null,r.clone()):Zi(n)?(r=n.getStats(),i(null,r)):i(u.FileError(o.EINVAL,e))},t.prototype.statSync=function(e,t){var i,r=this._index.getInode(e);if(null===r)throw u.ENOENT(e);if(Yi(r))(i=r.getData()).size<0&&(i.size=this._requestFileSizeSync(e));else{if(!Zi(r))throw u.FileError(o.EINVAL,e);i=r.getStats()}return i},t.prototype.open=function(e,t,i,r){if(t.isWriteable())return r(new u(o.EPERM,e));var n=this,s=this._index.getInode(e);if(null===s)return r(u.ENOENT(e));if(!Yi(s))return r(u.EISDIR(e));var a=s.getData();switch(t.pathExistsAction()){case l.THROW_EXCEPTION:case l.TRUNCATE_FILE:return r(u.EEXIST(e));case l.NOP:if(a.fileData)return r(null,new J(n,e,t,a.clone(),a.fileData));this._requestFileAsync(e,"buffer",(function(i,s){return i?r(i):(a.size=s.length,a.fileData=s,r(null,new J(n,e,t,a.clone(),s)))}));break;default:return r(new u(o.EINVAL,"Invalid FileMode object."))}},t.prototype.openSync=function(e,t,i){if(t.isWriteable())throw new u(o.EPERM,e);var r=this._index.getInode(e);if(null===r)throw u.ENOENT(e);if(!Yi(r))throw u.EISDIR(e);var n=r.getData();switch(t.pathExistsAction()){case l.THROW_EXCEPTION:case l.TRUNCATE_FILE:throw u.EEXIST(e);case l.NOP:if(n.fileData)return new J(this,e,t,n.clone(),n.fileData);var s=this._requestFileSync(e,"buffer");return n.size=s.length,n.fileData=s,new J(this,e,t,n.clone(),s);default:throw new u(o.EINVAL,"Invalid FileMode object.")}},t.prototype.readdir=function(e,t){try{t(null,this.readdirSync(e))}catch(e){t(e)}},t.prototype.readdirSync=function(e){var t=this._index.getInode(e);if(null===t)throw u.ENOENT(e);if(Zi(t))return t.getListing();throw u.ENOTDIR(e)},t.prototype.readFile=function(e,t,i,r){var n=r;this.open(e,i,420,(function(e,i){if(e)return r(e);r=function(e,t){i.close((function(i){return e||(e=i),n(e,t)}))};var s=i.getBuffer();null===t?r(e,U(s)):function(e,t,i){try{i(null,e.toString(t))}catch(e){i(e)}}(s,t,r)}))},t.prototype.readFileSync=function(e,t,i){var r=this.openSync(e,i,420);try{var n=r.getBuffer();return null===t?U(n):n.toString(t)}finally{r.closeSync()}},t.prototype.getXhrPath=function(e){return"/"===e.charAt(0)&&(e=e.slice(1)),this.prefixUrl+e},t.prototype._requestFileAsync=function(e,t,i){Wi(this.getXhrPath(e),t,i)},t.prototype._requestFileSync=function(e,t){return qi(this.getXhrPath(e),t)},t.prototype._requestFileSizeAsync=function(e,t){!function(e,t){$i(!0,e,t)}(this.getXhrPath(e),t)},t.prototype._requestFileSizeSync=function(e){return t=this.getXhrPath(e),i=-1,$i(!1,t,(function(e,t){if(e)throw e;i=t})),i;var t,i},t}(X);Gi.Name="XmlHttpRequest",Gi.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var Ji=function(){};Ji.str2byte=function(e,t){for(var i=e.length>t.length?t.length:e.length,r=0;r<i;r++){var n=e.charCodeAt(r);if(n>127){var s=Ji.extendedChars.indexOf(e.charAt(r));s>-1&&(n=s+128)}t[n]=r}return i},Ji.byte2str=function(e){for(var t=new Array(e.length),i=0;i<e.length;i++){var r=e[i];t[i]=r>127?Ji.extendedChars[r-128]:String.fromCharCode(r)}return t.join("")},Ji.byteLength=function(e){return e.length},Ji.extendedChars=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];var Qi,er,tr=i(31).inflateRaw,ir={};function rr(e,t){return new Date(1980+(t>>9),(t>>5&15)-1,31&t,e>>11,e>>5&63,31&e)}function nr(e,t,i,r){return 0===r?"":t?e.toString("utf8",i,i+r):Ji.byte2str(e.slice(i,i+r))}!function(e){e[e.MSDOS=0]="MSDOS",e[e.AMIGA=1]="AMIGA",e[e.OPENVMS=2]="OPENVMS",e[e.UNIX=3]="UNIX",e[e.VM_CMS=4]="VM_CMS",e[e.ATARI_ST=5]="ATARI_ST",e[e.OS2_HPFS=6]="OS2_HPFS",e[e.MAC=7]="MAC",e[e.Z_SYSTEM=8]="Z_SYSTEM",e[e.CP_M=9]="CP_M",e[e.NTFS=10]="NTFS",e[e.MVS=11]="MVS",e[e.VSE=12]="VSE",e[e.ACORN_RISC=13]="ACORN_RISC",e[e.VFAT=14]="VFAT",e[e.ALT_MVS=15]="ALT_MVS",e[e.BEOS=16]="BEOS",e[e.TANDEM=17]="TANDEM",e[e.OS_400=18]="OS_400",e[e.OSX=19]="OSX"}(Qi||(Qi={})),function(e){e[e.STORED=0]="STORED",e[e.SHRUNK=1]="SHRUNK",e[e.REDUCED_1=2]="REDUCED_1",e[e.REDUCED_2=3]="REDUCED_2",e[e.REDUCED_3=4]="REDUCED_3",e[e.REDUCED_4=5]="REDUCED_4",e[e.IMPLODE=6]="IMPLODE",e[e.DEFLATE=8]="DEFLATE",e[e.DEFLATE64=9]="DEFLATE64",e[e.TERSE_OLD=10]="TERSE_OLD",e[e.BZIP2=12]="BZIP2",e[e.LZMA=14]="LZMA",e[e.TERSE_NEW=18]="TERSE_NEW",e[e.LZ77=19]="LZ77",e[e.WAVPACK=97]="WAVPACK",e[e.PPMD=98]="PPMD"}(er||(er={}));var sr=function(e){if(this.data=e,67324752!==e.readUInt32LE(0))throw new u(o.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))};sr.prototype.versionNeeded=function(){return this.data.readUInt16LE(4)},sr.prototype.flags=function(){return this.data.readUInt16LE(6)},sr.prototype.compressionMethod=function(){return this.data.readUInt16LE(8)},sr.prototype.lastModFileTime=function(){return rr(this.data.readUInt16LE(10),this.data.readUInt16LE(12))},sr.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(10)},sr.prototype.crc32=function(){return this.data.readUInt32LE(14)},sr.prototype.fileNameLength=function(){return this.data.readUInt16LE(26)},sr.prototype.extraFieldLength=function(){return this.data.readUInt16LE(28)},sr.prototype.fileName=function(){return nr(this.data,this.useUTF8(),30,this.fileNameLength())},sr.prototype.extraField=function(){var e=30+this.fileNameLength();return this.data.slice(e,e+this.extraFieldLength())},sr.prototype.totalSize=function(){return 30+this.fileNameLength()+this.extraFieldLength()},sr.prototype.useUTF8=function(){return 2048==(2048&this.flags())};var or=function(e,t,i){this.header=e,this.record=t,this.data=i};or.prototype.decompress=function(){var e=this.header.compressionMethod(),t=ir[e];if(t)return t(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());var i=er[e];throw i||(i="Unknown: "+e),new u(o.EINVAL,"Invalid compression method on file '"+this.header.fileName()+"': "+i)},or.prototype.getHeader=function(){return this.header},or.prototype.getRecord=function(){return this.record},or.prototype.getRawData=function(){return this.data};var ar=function(e,t){if(this.zipData=e,this.data=t,33639248!==this.data.readUInt32LE(0))throw new u(o.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0));this._filename=this.produceFilename()};ar.prototype.versionMadeBy=function(){return this.data.readUInt16LE(4)},ar.prototype.versionNeeded=function(){return this.data.readUInt16LE(6)},ar.prototype.flag=function(){return this.data.readUInt16LE(8)},ar.prototype.compressionMethod=function(){return this.data.readUInt16LE(10)},ar.prototype.lastModFileTime=function(){return rr(this.data.readUInt16LE(12),this.data.readUInt16LE(14))},ar.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(12)},ar.prototype.crc32=function(){return this.data.readUInt32LE(16)},ar.prototype.compressedSize=function(){return this.data.readUInt32LE(20)},ar.prototype.uncompressedSize=function(){return this.data.readUInt32LE(24)},ar.prototype.fileNameLength=function(){return this.data.readUInt16LE(28)},ar.prototype.extraFieldLength=function(){return this.data.readUInt16LE(30)},ar.prototype.fileCommentLength=function(){return this.data.readUInt16LE(32)},ar.prototype.diskNumberStart=function(){return this.data.readUInt16LE(34)},ar.prototype.internalAttributes=function(){return this.data.readUInt16LE(36)},ar.prototype.externalAttributes=function(){return this.data.readUInt32LE(38)},ar.prototype.headerRelativeOffset=function(){return this.data.readUInt32LE(42)},ar.prototype.produceFilename=function(){return nr(this.data,this.useUTF8(),46,this.fileNameLength()).replace(/\\/g,"/")},ar.prototype.fileName=function(){return this._filename},ar.prototype.rawFileName=function(){return this.data.slice(46,46+this.fileNameLength())},ar.prototype.extraField=function(){var e=44+this.fileNameLength();return this.data.slice(e,e+this.extraFieldLength())},ar.prototype.fileComment=function(){var e=46+this.fileNameLength()+this.extraFieldLength();return nr(this.data,this.useUTF8(),e,this.fileCommentLength())},ar.prototype.rawFileComment=function(){var e=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(e,e+this.fileCommentLength())},ar.prototype.totalSize=function(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()},ar.prototype.isDirectory=function(){var e=this.fileName();return!!(16&this.externalAttributes())||"/"===e.charAt(e.length-1)},ar.prototype.isFile=function(){return!this.isDirectory()},ar.prototype.useUTF8=function(){return 2048==(2048&this.flag())},ar.prototype.isEncrypted=function(){return 1==(1&this.flag())},ar.prototype.getFileData=function(){var e=this.headerRelativeOffset(),t=new sr(this.zipData.slice(e));return new or(t,this,this.zipData.slice(e+t.totalSize()))},ar.prototype.getData=function(){return this.getFileData().decompress()},ar.prototype.getRawData=function(){return this.getFileData().getRawData()},ar.prototype.getStats=function(){return new _(d.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var cr=function(e){if(this.data=e,101010256!==this.data.readUInt32LE(0))throw new u(o.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))};cr.prototype.diskNumber=function(){return this.data.readUInt16LE(4)},cr.prototype.cdDiskNumber=function(){return this.data.readUInt16LE(6)},cr.prototype.cdDiskEntryCount=function(){return this.data.readUInt16LE(8)},cr.prototype.cdTotalEntryCount=function(){return this.data.readUInt16LE(10)},cr.prototype.cdSize=function(){return this.data.readUInt32LE(12)},cr.prototype.cdOffset=function(){return this.data.readUInt32LE(16)},cr.prototype.cdZipCommentLength=function(){return this.data.readUInt16LE(20)},cr.prototype.cdZipComment=function(){return nr(this.data,!0,22,this.cdZipCommentLength())},cr.prototype.rawCdZipComment=function(){return this.data.slice(22,22+this.cdZipCommentLength())};var hr=function(e,t,i,r){this.index=e,this.directoryEntries=t,this.eocd=i,this.data=r},lr=function(e){function t(i,r,n){void 0===r&&(r=""),void 0===n&&(n=!0),e.call(this),this.name=r,this._index=new Ki,this._directoryEntries=[],this._eocd=null,x(n,t.Name,{zipData:"zip data as a Buffer",name:r}),i instanceof hr?(this._index=i.index,this._directoryEntries=i.directoryEntries,this._eocd=i.eocd,this.data=i.data):(this.data=i,this.populateIndex())}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){try{t.computeIndex(e.zipData,(function(r){var n=new t(r,e.name,!1);i(null,n)}),!1)}catch(e){i(e)}},t.isAvailable=function(){return!0},t.RegisterDecompressionMethod=function(e,t){ir[e]=t},t.computeIndex=function(e,i,r){void 0===r&&(r=!0),r&&console.warn("[ZipFS] ZipFS.computeIndex is now deprecated, and will be removed in the next major release. Please update your code to use 'ZipFS.Create({ zipData: zip file as a Buffer}, cb)' instead.");var n=new Ki,s=t.getEOCD(e);if(s.diskNumber()!==s.cdDiskNumber())throw new u(o.EINVAL,"ZipFS does not support spanned zip files.");var a=s.cdOffset();if(4294967295===a)throw new u(o.EINVAL,"ZipFS does not support Zip64.");var c=a+s.cdSize();t.computeIndexResponsive(e,n,a,c,i,[],s)},t.getEOCD=function(e){for(var t=Math.min(65557,e.length-1),i=22;i<t;i++)if(101010256===e.readUInt32LE(e.length-i))return new cr(e.slice(e.length-i));throw new u(o.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")},t.addToIndex=function(e,t){var i=e.fileName();if("/"===i.charAt(0))throw new Error("WHY IS THIS ABSOLUTE");"/"===i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),e.isDirectory()?t.addPathFast("/"+i,new Xi(e)):t.addPathFast("/"+i,new Vi(e))},t.computeIndexResponsive=function(e,i,r,n,s,o,a){if(r<n){for(var c=0;c++<200&&r<n;){var h=new ar(e,e.slice(r));t.addToIndex(h,i),r+=h.totalSize(),o.push(h)}vi((function(){t.computeIndexResponsive(e,i,r,n,s,o,a)}))}else s(new hr(i,o,a,e))},t.prototype.getName=function(){return t.Name+(""!==this.name?" "+this.name:"")},t.prototype.getCentralDirectoryEntry=function(e){var t=this._index.getInode(e);if(null===t)throw u.ENOENT(e);if(Yi(t))return t.getData();if(Zi(t))return t.getData();throw u.EPERM("Invalid inode: "+t)},t.prototype.getCentralDirectoryEntryAt=function(e){var t=this._directoryEntries[e];if(!t)throw new RangeError("Invalid directory index: "+e+".");return t},t.prototype.getNumberOfCentralDirectoryEntries=function(){return this._directoryEntries.length},t.prototype.getEndOfCentralDirectory=function(){return this._eocd},t.prototype.diskSpace=function(e,t){t(this.data.length,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.statSync=function(e,t){var i,r=this._index.getInode(e);if(null===r)throw u.ENOENT(e);if(Yi(r))i=r.getData().getStats();else{if(!Zi(r))throw new u(o.EINVAL,"Invalid inode.");i=r.getStats()}return i},t.prototype.openSync=function(e,t,i){if(t.isWriteable())throw new u(o.EPERM,e);var r=this._index.getInode(e);if(!r)throw u.ENOENT(e);if(!Yi(r))throw u.EISDIR(e);var n=r.getData(),s=n.getStats();switch(t.pathExistsAction()){case l.THROW_EXCEPTION:case l.TRUNCATE_FILE:throw u.EEXIST(e);case l.NOP:return new J(this,e,t,s,n.getData());default:throw new u(o.EINVAL,"Invalid FileMode object.")}},t.prototype.readdirSync=function(e){var t=this._index.getInode(e);if(t){if(Zi(t))return t.getListing();throw u.ENOTDIR(e)}throw u.ENOENT(e)},t.prototype.readFileSync=function(e,t,i){var r=this.openSync(e,i,420);try{var n=r.getBuffer();return null===t?U(n):n.toString(t)}finally{r.closeSync()}},t.prototype.populateIndex=function(){var e=this,i=this._eocd=t.getEOCD(this.data);if(i.diskNumber()!==i.cdDiskNumber())throw new u(o.EINVAL,"ZipFS does not support spanned zip files.");var r=i.cdOffset();if(4294967295===r)throw new u(o.EINVAL,"ZipFS does not support Zip64.");for(var n=r+i.cdSize();r<n;){var s=new ar(e.data,e.data.slice(r));r+=s.totalSize(),t.addToIndex(s,e._index),e._directoryEntries.push(s)}},t}(Y);function ur(e,t,i){return e.toString("ascii",t,t+i).trim()}function fr(e,t,i){if(1===i)return String.fromCharCode(e[t]);for(var r=Math.floor(i/2),n=new Array(r),s=0;s<r;s++){var o=t+(s<<1);n[s]=String.fromCharCode(e[o+1]|e[o]<<8)}return n.join("")}function dr(e,t){var i=parseInt(ur(e,t,4),10),r=parseInt(ur(e,t+4,2),10),n=parseInt(ur(e,t+6,2),10),s=parseInt(ur(e,t+8,2),10),o=parseInt(ur(e,t+10,2),10),a=parseInt(ur(e,t+12,2),10),c=parseInt(ur(e,t+14,2),10);return new Date(i,r,n,s,o,a,100*c)}function pr(e,t){var i=e[t],r=e[t+1],n=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5];return new Date(i,r-1,n,s,o,a)}function _r(e,t){var i=e.slice(t),r=new Cr(i);switch(r.signatureWord()){case 17221:return new kr(i);case 20548:return new Lr(i);case 21328:return new Rr(i);case 21332:return new Dr(i);case 17746:return new xr(i);case 17747:return new Ar(i);case 20568:return new Ir(i);case 20558:return new Or(i);case 21324:return new Br(i);case 20045:return new Mr(i);case 17228:return new Pr(i);case 20556:return new Nr(i);case 21061:return new Ur(i);case 21574:return new Hr(i);case 21318:return new jr(i);case 21074:return new Tr(i);default:return r}}function gr(e,t,i,r){i-=4;for(var n=new Array;t<i;){var s=_r(e,t),o=s.length();if(0===o)return n;if(t+=o,s instanceof Dr)break;s instanceof kr?n=n.concat(s.getEntries(r)):n.push(s)}return n}lr.Name="ZipFS",lr.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:z},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},lr.CompressionMethod=er,lr.RegisterDecompressionMethod(er.DEFLATE,(function(e,t,i){return M(tr(e.slice(0,t),{chunkSize:i}))})),lr.RegisterDecompressionMethod(er.STORED,(function(e,t,i){return U(e,0,i)}));var vr=function(e){this._data=e};vr.prototype.type=function(){return this._data[0]},vr.prototype.standardIdentifier=function(){return ur(this._data,1,5)},vr.prototype.version=function(){return this._data[6]},vr.prototype.data=function(){return this._data.slice(7,2048)};var yr=function(e){function t(t){e.call(this,t),this._root=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.systemIdentifier=function(){return this._getString32(8)},t.prototype.volumeIdentifier=function(){return this._getString32(40)},t.prototype.volumeSpaceSize=function(){return this._data.readUInt32LE(80)},t.prototype.volumeSetSize=function(){return this._data.readUInt16LE(120)},t.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(124)},t.prototype.logicalBlockSize=function(){return this._data.readUInt16LE(128)},t.prototype.pathTableSize=function(){return this._data.readUInt32LE(132)},t.prototype.locationOfTypeLPathTable=function(){return this._data.readUInt32LE(140)},t.prototype.locationOfOptionalTypeLPathTable=function(){return this._data.readUInt32LE(144)},t.prototype.locationOfTypeMPathTable=function(){return this._data.readUInt32BE(148)},t.prototype.locationOfOptionalTypeMPathTable=function(){return this._data.readUInt32BE(152)},t.prototype.rootDirectoryEntry=function(e){return null===this._root&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(e)),this._root},t.prototype.volumeSetIdentifier=function(){return this._getString(190,128)},t.prototype.publisherIdentifier=function(){return this._getString(318,128)},t.prototype.dataPreparerIdentifier=function(){return this._getString(446,128)},t.prototype.applicationIdentifier=function(){return this._getString(574,128)},t.prototype.copyrightFileIdentifier=function(){return this._getString(702,38)},t.prototype.abstractFileIdentifier=function(){return this._getString(740,36)},t.prototype.bibliographicFileIdentifier=function(){return this._getString(776,37)},t.prototype.volumeCreationDate=function(){return dr(this._data,813)},t.prototype.volumeModificationDate=function(){return dr(this._data,830)},t.prototype.volumeExpirationDate=function(){return dr(this._data,847)},t.prototype.volumeEffectiveDate=function(){return dr(this._data,864)},t.prototype.fileStructureVersion=function(){return this._data[881]},t.prototype.applicationUsed=function(){return this._data.slice(883,1395)},t.prototype.reserved=function(){return this._data.slice(1395,2048)},t.prototype._getString32=function(e){return this._getString(e,32)},t}(vr),mr=function(e){function t(t){if(e.call(this,t),1!==this.type())throw new u(o.EIO,"Invalid primary volume descriptor.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.name=function(){return"ISO9660"},t.prototype._constructRootDirectoryRecord=function(e){return new br(e,-1)},t.prototype._getString=function(e,t){return this._getString(e,t)},t}(yr),Sr=function(e){function t(t){if(e.call(this,t),2!==this.type())throw new u(o.EIO,"Invalid supplementary volume descriptor.");var i=this.escapeSequence(),r=i[2];if(37!==i[0]||47!==i[1]||64!==r&&67!==r&&69!==r)throw new u(o.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+i.toString())}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.name=function(){return"Joliet"},t.prototype.escapeSequence=function(){return this._data.slice(88,120)},t.prototype._constructRootDirectoryRecord=function(e){return new Er(e,-1)},t.prototype._getString=function(e,t){return fr(this._data,e,t)},t}(yr),wr=function(e,t){this._suEntries=null,this._fileOrDir=null,this._data=e,this._rockRidgeOffset=t};wr.prototype.hasRockRidge=function(){return this._rockRidgeOffset>-1},wr.prototype.getRockRidgeOffset=function(){return this._rockRidgeOffset},wr.prototype.rootCheckForRockRidge=function(e){var t=this.getDirectory(e);this._rockRidgeOffset=t.getDotEntry(e)._getRockRidgeOffset(e),this._rockRidgeOffset>-1&&(this._fileOrDir=null)},wr.prototype.length=function(){return this._data[0]},wr.prototype.extendedAttributeRecordLength=function(){return this._data[1]},wr.prototype.lba=function(){return 2048*this._data.readUInt32LE(2)},wr.prototype.dataLength=function(){return this._data.readUInt32LE(10)},wr.prototype.recordingDate=function(){return pr(this._data,18)},wr.prototype.fileFlags=function(){return this._data[25]},wr.prototype.fileUnitSize=function(){return this._data[26]},wr.prototype.interleaveGapSize=function(){return this._data[27]},wr.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(28)},wr.prototype.identifier=function(){return this._getString(33,this._data[32])},wr.prototype.fileName=function(e){if(this.hasRockRidge()){var t=this._rockRidgeFilename(e);if(null!==t)return t}var i=this.identifier();if(this.isDirectory(e))return i;var r=i.indexOf(";");return-1===r?i:"."===i[r-1]?i.slice(0,r-1):i.slice(0,r)},wr.prototype.isDirectory=function(e){var t=!!(2&this.fileFlags());return!t&&this.hasRockRidge()&&(t=this.getSUEntries(e).filter((function(e){return e instanceof Pr})).length>0),t},wr.prototype.isSymlink=function(e){return this.hasRockRidge()&&this.getSUEntries(e).filter((function(e){return e instanceof Br})).length>0},wr.prototype.getSymlinkPath=function(e){for(var t="",i=this.getSUEntries(e),r=this._getGetString(),n=0,s=i;n<s.length;n+=1){var o=s[n];if(o instanceof Br){for(var a=0,c=o.componentRecords();a<c.length;a+=1){var h=c[a],l=h.flags();2&l?t+="./":4&l?t+="../":8&l?t+="/":(t+=h.content(r),1&l||(t+="/"))}if(!o.continueFlag())break}}return t.length>1&&"/"===t[t.length-1]?t.slice(0,t.length-1):t},wr.prototype.getFile=function(e){if(this.isDirectory(e))throw new Error("Tried to get a File from a directory.");return null===this._fileOrDir&&(this._fileOrDir=e.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir},wr.prototype.getDirectory=function(e){if(!this.isDirectory(e))throw new Error("Tried to get a Directory from a file.");return null===this._fileOrDir&&(this._fileOrDir=this._constructDirectory(e)),this._fileOrDir},wr.prototype.getSUEntries=function(e){return this._suEntries||this._constructSUEntries(e),this._suEntries},wr.prototype._rockRidgeFilename=function(e){var t=this.getSUEntries(e).filter((function(e){return e instanceof Mr}));if(0===t.length||6&t[0].flags())return null;for(var i="",r=this._getGetString(),n=0,s=t;n<s.length;n+=1){var o=s[n];if(i+=o.name(r),!(1&o.flags()))break}return i},wr.prototype._constructSUEntries=function(e){var t=33+this._data[32];t%2==1&&t++,t+=this._rockRidgeOffset,this._suEntries=gr(this._data,t,this.length(),e)},wr.prototype._getRockRidgeOffset=function(e){this._rockRidgeOffset=0;var t=this.getSUEntries(e);if(t.length>0){var i=t[0];if(i instanceof Rr&&i.checkBytesPass())for(var r=1;r<t.length;r++){var n=t[r];if(n instanceof Tr||n instanceof xr&&"IEEE_P1282"===n.extensionIdentifier())return i.bytesSkipped()}}return this._rockRidgeOffset=-1,-1};var br=function(e){function t(t,i){e.call(this,t,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._getString=function(e,t){return ur(this._data,e,t)},t.prototype._constructDirectory=function(e){return new $r(this,e)},t.prototype._getGetString=function(){return ur},t}(wr),Er=function(e){function t(t,i){e.call(this,t,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._getString=function(e,t){return fr(this._data,e,t)},t.prototype._constructDirectory=function(e){return new Wr(this,e)},t.prototype._getGetString=function(){return fr},t}(wr),Cr=function(e){this._data=e};Cr.prototype.signatureWord=function(){return this._data.readUInt16BE(0)},Cr.prototype.signatureWordString=function(){return ur(this._data,0,2)},Cr.prototype.length=function(){return this._data[2]},Cr.prototype.suVersion=function(){return this._data[3]};var kr=function(e){function t(t){e.call(this,t),this._entries=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.continuationLba=function(){return this._data.readUInt32LE(4)},t.prototype.continuationLbaOffset=function(){return this._data.readUInt32LE(12)},t.prototype.continuationLength=function(){return this._data.readUInt32LE(20)},t.prototype.getEntries=function(e){if(!this._entries){var t=2048*this.continuationLba()+this.continuationLbaOffset();this._entries=gr(e,t,this.continuationLength(),e)}return this._entries},t}(Cr),Lr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cr),Rr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.checkBytesPass=function(){return 190===this._data[4]&&239===this._data[5]},t.prototype.bytesSkipped=function(){return this._data[6]},t}(Cr),Dr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cr),xr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.identifierLength=function(){return this._data[4]},t.prototype.descriptorLength=function(){return this._data[5]},t.prototype.sourceLength=function(){return this._data[6]},t.prototype.extensionVersion=function(){return this._data[7]},t.prototype.extensionIdentifier=function(){return ur(this._data,8,this.identifierLength())},t.prototype.extensionDescriptor=function(){return ur(this._data,8+this.identifierLength(),this.descriptorLength())},t.prototype.extensionSource=function(){return ur(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())},t}(Cr),Ar=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.extensionSequence=function(){return this._data[4]},t}(Cr),Tr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cr),Ir=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.mode=function(){return this._data.readUInt32LE(4)},t.prototype.fileLinks=function(){return this._data.readUInt32LE(12)},t.prototype.uid=function(){return this._data.readUInt32LE(20)},t.prototype.gid=function(){return this._data.readUInt32LE(28)},t.prototype.inode=function(){return this._data.readUInt32LE(36)},t}(Cr),Or=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.devTHigh=function(){return this._data.readUInt32LE(4)},t.prototype.devTLow=function(){return this._data.readUInt32LE(12)},t}(Cr),Br=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.continueFlag=function(){return 1&this.flags()},t.prototype.componentRecords=function(){for(var e=new Array,t=5;t<this.length();){var i=new Fr(this._data.slice(t));e.push(i),t+=i.length()}return e},t}(Cr),Fr=function(e){this._data=e};Fr.prototype.flags=function(){return this._data[0]},Fr.prototype.length=function(){return 2+this.componentLength()},Fr.prototype.componentLength=function(){return this._data[1]},Fr.prototype.content=function(e){return e(this._data,2,this.componentLength())};var Mr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.name=function(e){return e(this._data,5,this.length()-5)},t}(Cr),Pr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.childDirectoryLba=function(){return this._data.readUInt32LE(4)},t}(Cr),Nr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.parentDirectoryLba=function(){return this._data.readUInt32LE(4)},t}(Cr),Ur=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cr),Hr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flags=function(){return this._data[4]},t.prototype.creation=function(){return 1&this.flags()?this._longFormDates()?dr(this._data,5):pr(this._data,5):null},t.prototype.modify=function(){if(2&this.flags()){var e=1&this.flags()?1:0;return this._longFormDates?dr(this._data,5+17*e):pr(this._data,5+7*e)}return null},t.prototype.access=function(){if(4&this.flags()){var e=1&this.flags()?1:0;return e+=2&this.flags()?1:0,this._longFormDates?dr(this._data,5+17*e):pr(this._data,5+7*e)}return null},t.prototype.backup=function(){if(16&this.flags()){var e=1&this.flags()?1:0;return e+=2&this.flags()?1:0,e+=4&this.flags()?1:0,this._longFormDates?dr(this._data,5+17*e):pr(this._data,5+7*e)}return null},t.prototype.expiration=function(){if(32&this.flags()){var e=1&this.flags()?1:0;return e+=2&this.flags()?1:0,e+=4&this.flags()?1:0,e+=16&this.flags()?1:0,this._longFormDates?dr(this._data,5+17*e):pr(this._data,5+7*e)}return null},t.prototype.effective=function(){if(64&this.flags()){var e=1&this.flags()?1:0;return e+=2&this.flags()?1:0,e+=4&this.flags()?1:0,e+=16&this.flags()?1:0,e+=32&this.flags()?1:0,this._longFormDates?dr(this._data,5+17*e):pr(this._data,5+7*e)}return null},t.prototype._longFormDates=function(){return!!this.flags()},t}(Cr),jr=function(e){function t(t){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.virtualSizeHigh=function(){return this._data.readUInt32LE(4)},t.prototype.virtualSizeLow=function(){return this._data.readUInt32LE(12)},t.prototype.tableDepth=function(){return this._data[20]},t}(Cr),zr=function(e,t){var i=this;this._fileList=[],this._fileMap={},this._record=e;var r=e.lba(),n=r+e.dataLength();for(2&e.fileFlags()||(r=2048*e.getSUEntries(t).filter((function(e){return e instanceof Pr}))[0].childDirectoryLba(),n=1/0);r<n;)if(0!==t[r]){var s=i._constructDirectoryRecord(t.slice(r)),o=s.fileName(t);"\0"!==o&&""!==o?s.hasRockRidge()&&0!==s.getSUEntries(t).filter((function(e){return e instanceof Ur})).length||(i._fileMap[o]=s,i._fileList.push(o)):n===1/0&&(n=r+s.dataLength()),r+=s.length()}else r++};zr.prototype.getRecord=function(e){return this._fileMap[e]},zr.prototype.getFileList=function(){return this._fileList},zr.prototype.getDotEntry=function(e){return this._constructDirectoryRecord(e.slice(this._record.lba()))};var $r=function(e){function t(t,i){e.call(this,t,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._constructDirectoryRecord=function(e){return new br(e,this._record.getRockRidgeOffset())},t}(zr),Wr=function(e){function t(t,i){e.call(this,t,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._constructDirectoryRecord=function(e){return new Er(e,this._record.getRockRidgeOffset())},t}(zr),qr=function(e){function t(i,r,n){var s=this;void 0===r&&(r=""),void 0===n&&(n=!0),e.call(this),this._data=i,x(n,t.Name,{data:"ISO data as a Buffer",name:r});for(var a=!1,c=32768,h=new Array;!a;){var l=i.slice(c);switch(new vr(l).type()){case 1:h.push(new mr(l));break;case 2:h.push(new Sr(l));break;case 255:a=!0}c+=2048}if(0===h.length)throw new u(o.EIO,"Unable to find a suitable volume descriptor.");h.forEach((function(e){s._pvd&&2===s._pvd.type()||(s._pvd=e)})),this._root=this._pvd.rootDirectoryEntry(i),this._name=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.Create=function(e,i){var r;try{r=new t(e.data,e.name,!1)}catch(e){}finally{i(void 0,r)}},t.isAvailable=function(){return!0},t.prototype.getName=function(){var e="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(e+="-RockRidge"),e},t.prototype.diskSpace=function(e,t){t(this._data.length,0)},t.prototype.isReadOnly=function(){return!0},t.prototype.supportsLinks=function(){return!1},t.prototype.supportsProps=function(){return!1},t.prototype.supportsSynch=function(){return!0},t.prototype.statSync=function(e,t){var i=this._getDirectoryRecord(e);if(null===i)throw u.ENOENT(e);return this._getStats(e,i)},t.prototype.openSync=function(e,t,i){if(t.isWriteable())throw new u(o.EPERM,e);var r=this._getDirectoryRecord(e);if(!r)throw u.ENOENT(e);if(r.isSymlink(this._data))return this.openSync(c.resolve(e,r.getSymlinkPath(this._data)),t,i);if(r.isDirectory(this._data))throw u.EISDIR(e);var n=r.getFile(this._data),s=this._getStats(e,r);switch(t.pathExistsAction()){case l.THROW_EXCEPTION:case l.TRUNCATE_FILE:throw u.EEXIST(e);case l.NOP:return new J(this,e,t,s,n);default:throw new u(o.EINVAL,"Invalid FileMode object.")}},t.prototype.readdirSync=function(e){var t=this._getDirectoryRecord(e);if(t){if(t.isDirectory(this._data))return t.getDirectory(this._data).getFileList().slice(0);throw u.ENOTDIR(e)}throw u.ENOENT(e)},t.prototype.readFileSync=function(e,t,i){var r=this.openSync(e,i,420);try{var n=r.getBuffer();return null===t?U(n):n.toString(t)}finally{r.closeSync()}},t.prototype._getDirectoryRecord=function(e){if("/"===e)return this._root;for(var t=e.split("/").slice(1),i=this._root,r=0,n=t;r<n.length;r+=1){var s=n[r];if(!i.isDirectory(this._data))return null;if(!(i=i.getDirectory(this._data).getRecord(s)))return null}return i},t.prototype._getStats=function(e,t){if(t.isSymlink(this._data)){var i=c.resolve(e,t.getSymlinkPath(this._data)),r=this._getDirectoryRecord(i);return r?this._getStats(i,r):null}var n=t.dataLength(),s=365,o=t.recordingDate(),a=o,h=o,l=o;if(t.hasRockRidge())for(var u=0,f=t.getSUEntries(this._data);u<f.length;u+=1){var p=f[u];if(p instanceof Ir)s=p.mode();else if(p instanceof Hr){var g=p.flags();4&g&&(a=p.access()),2&g&&(h=p.modify()),1&g&&(l=p.creation())}}return s&=365,new _(t.isDirectory(this._data)?d.DIRECTORY:d.FILE,n,s,a,h,l)},t}(Y);qr.Name="IsoFS",qr.Options={data:{type:"object",description:"The ISO file in a buffer",validator:z}},[ee,St,Et,Ct,It,Kt,Qt,qr,ri,ni,Li,zi,Gi,lr].forEach((function(e){var t=e.Create;e.Create=function(i,r){var n="function"==typeof i,s=n?i:r,o=n?{}:i;$(e,o,(function(i){i?s(i):t.call(e,o,s)}))}}));var Kr,Vr={AsyncMirror:ee,Dropbox:St,Emscripten:Et,FolderAdapter:Ct,HTML5FS:It,InMemory:Kt,IndexedDB:Qt,IsoFS:qr,LocalStorage:ri,MountableFileSystem:ni,OverlayFS:Li,WorkerFS:zi,XmlHttpRequest:Gi,ZipFS:lr};function Xr(e){switch(e){case"fs":return k;case"path":return c;case"buffer":return a;case"process":return s;case"bfs_utils":return W;default:return Vr[e]}}function Yr(e){return k.initialize(e)}function Zr(e,t){var i=e.fs;if(!i)return t(new u(o.EPERM,'Missing "fs" property on configuration object.'));var r=e.options,n=0,s=!1;function a(){if(!s){s=!0;var e=Vr[i];e?e.Create(r,t):t(new u(o.EPERM,"File system "+i+" is not available in BrowserFS."))}}if(null!==r&&"object"==typeof r){var c=!1;Object.keys(r).filter((function(e){return"fs"!==e})).forEach((function(e){var i=r[e];null!==i&&"object"==typeof i&&i.fs&&(n++,Zr(i,(function(i,o){if(n--,i){if(s)return;s=!0,t(i)}else r[e]=o,0===n&&c&&a()})))})),c=!0}0===n&&a()}s.initializeTTYs&&s.initializeTTYs(),"b"!=="ab".substr(-1)&&(String.prototype.substr=(Kr=String.prototype.substr,function(e,t){return e<0&&(e=this.length+e),Kr.call(this,e,t)})),"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&(Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e<0&&(e=this.length+e)<0&&(e=0),t<0&&(t=this.length+t)<0&&(t=0),t<e&&(t=e),new Uint8Array(this.buffer,this.byteOffset+e,t-e)})),t.install=function(t){t.Buffer=e,t.process=s;var i=t.require?t.require:null;t.require=function(e){var t=Xr(e);return t||i.apply(null,Array.prototype.slice.call(arguments,0))}},t.registerFileSystem=function(e,t){Vr[e]=t},t.BFSRequire=Xr,t.initialize=Yr,t.configure=function(e,t){Zr(e,(function(e,i){i?(Yr(i),t()):t(e)}))},t.getFileSystem=Zr,t.EmscriptenFS=V,t.FileSystem=Vr,t.Errors=f,t.setImmediate=vi}).call(t,i(1),function(){return this}(),i(5)(e),i(6))},function(e,t,i){e.exports=i(2).Buffer},function(e,t,i){(function(e){
/*!
    	 * The buffer module from node.js, for the browser.
    	 *
    	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
    	 * @license  MIT
    	 */
var r=i(3),n=i(4);t.Buffer=e,t.SlowBuffer=function(t){return+t!=t&&(t=0),e.alloc(+t)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function o(t){if(t>s)throw new RangeError("Invalid typed array length");var i=new Uint8Array(t);return i.__proto__=e.prototype,i}function e(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(e)}return a(e,t,i)}function a(t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return U(t)?function(t,i,r){if(i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");var n;return(n=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r)).__proto__=e.prototype,n}(t,i,r):"string"==typeof t?function(t,i){if("string"==typeof i&&""!==i||(i="utf8"),!e.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,i),n=o(r),s=n.write(t,i);return s!==r&&(n=n.slice(0,s)),n}(t,i):function(t){if(e.isBuffer(t)){var i=0|u(t.length),r=o(i);return 0===r.length||t.copy(r,0,0,i),r}if(t){if(H(t)||"length"in t)return"number"!=typeof t.length||j(t.length)?o(0):l(t);if("Buffer"===t.type&&Array.isArray(t.data))return l(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e){return c(e),o(e<0?0:0|u(e))}function l(e){for(var t=e.length<0?0:0|u(e.length),i=o(t),r=0;r<t;r+=1)i[r]=255&e[r];return i}function u(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function f(t,i){if(e.isBuffer(t))return t.length;if(H(t)||U(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(i){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return M(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return P(t).length;default:if(n)return M(t).length;i=(""+i).toLowerCase(),n=!0}}function d(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,i);case"utf8":case"utf-8":return C(this,t,i);case"ascii":return L(this,t,i);case"latin1":case"binary":return R(this,t,i);case"base64":return E(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function p(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function _(t,i,r,n,s){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),j(r=+r)&&(r=s?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(s)return-1;r=t.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof i&&(i=e.from(i,n)),e.isBuffer(i))return 0===i.length?-1:g(t,i,r,n,s);if("number"==typeof i)return i&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,i,r):Uint8Array.prototype.lastIndexOf.call(t,i,r):g(t,[i],r,n,s);throw new TypeError("val must be string, number or Buffer")}function g(e,t,i,r,n){var s,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,i/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){var l=-1;for(s=i;s<a;s++)if(h(e,s)===h(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*o}else-1!==l&&(s-=s-l),l=-1}else for(i+c>a&&(i=a-c),s=i;s>=0;s--){for(var u=!0,f=0;f<c;f++)if(h(e,s+f)!==h(t,f)){u=!1;break}if(u)return s}return-1}function v(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?(r=Number(r))>n&&(r=n):r=n;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(j(a))return o;e[i+o]=a}return o}function y(e,t,i,r){return N(M(t,e.length-i),e,i,r)}function m(e,t,i,r){return N(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function S(e,t,i,r){return m(e,t,i,r)}function w(e,t,i,r){return N(P(t),e,i,r)}function b(e,t,i,r){return N(function(e,t){for(var i,r,n,s=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(i=e.charCodeAt(o))>>8,n=i%256,s.push(n),s.push(r);return s}(t,e.length-i),e,i,r)}function E(e,t,i){return 0===t&&i===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,i))}function C(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var s,o,a,c,h=e[n],l=null,u=h>239?4:h>223?3:h>191?2:1;if(n+u<=i)switch(u){case 1:h<128&&(l=h);break;case 2:128==(192&(s=e[n+1]))&&(c=(31&h)<<6|63&s)>127&&(l=c);break;case 3:s=e[n+1],o=e[n+2],128==(192&s)&&128==(192&o)&&(c=(15&h)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=e[n+1],o=e[n+2],a=e[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,u=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),n+=u}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);for(var i="",r=0;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=k));return i}(r)}t.kMaxLength=s,e.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(e,t,i){return a(e,t,i)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(e,t,i){return function(e,t,i){return c(e),e<=0?o(e):void 0!==t?"string"==typeof i?o(e).fill(t,i):o(e).fill(t):o(e)}(e,t,i)},e.allocUnsafe=function(e){return h(e)},e.allocUnsafeSlow=function(e){return h(e)},e.isBuffer=function(e){return null!=e&&!0===e._isBuffer},e.compare=function(t,i){if(!e.isBuffer(t)||!e.isBuffer(i))throw new TypeError("Arguments must be Buffers");if(t===i)return 0;for(var r=t.length,n=i.length,s=0,o=Math.min(r,n);s<o;++s)if(t[s]!==i[s]){r=t[s],n=i[s];break}return r<n?-1:n<r?1:0},e.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,i){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var r;if(void 0===i)for(i=0,r=0;r<t.length;++r)i+=t[r].length;var n=e.allocUnsafe(i),s=0;for(r=0;r<t.length;++r){var o=t[r];if(!e.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,s),s+=o.length}return n},e.byteLength=f,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},e.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},e.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},e.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):d.apply(this,arguments)},e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},e.prototype.compare=function(t,i,r,n,s){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===i&&(i=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),i<0||r>t.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&i>=r)return 0;if(n>=s)return-1;if(i>=r)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(n>>>=0),a=(r>>>=0)-(i>>>=0),c=Math.min(o,a),h=this.slice(n,s),l=t.slice(i,r),u=0;u<c;++u)if(h[u]!==l[u]){o=h[u],a=l[u];break}return o<a?-1:a<o?1:0},e.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},e.prototype.indexOf=function(e,t,i){return _(this,e,t,i,!0)},e.prototype.lastIndexOf=function(e,t,i){return _(this,e,t,i,!1)},e.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return v(this,e,t,i);case"utf8":case"utf-8":return y(this,e,t,i);case"ascii":return m(this,e,t,i);case"latin1":case"binary":return S(this,e,t,i);case"base64":return w(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,i);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function L(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function R(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function D(e,t,i){var r,n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var s="",o=t;o<i;++o)s+=(r=e[o])<16?"0"+r.toString(16):r.toString(16);return s}function x(e,t,i){for(var r=e.slice(t,i),n="",s=0;s<r.length;s+=2)n+=String.fromCharCode(r[s]+256*r[s+1]);return n}function A(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function T(t,i,r,n,s,o){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>s||i<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function I(e,t,i,r,n,s){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function O(e,t,i,r,s){return t=+t,i>>>=0,s||I(e,0,i,4),n.write(e,t,i,r,23,4),i+4}function B(e,t,i,r,s){return t=+t,i>>>=0,s||I(e,0,i,8),n.write(e,t,i,r,52,8),i+8}e.prototype.slice=function(t,i){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(i=void 0===i?r:~~i)<0?(i+=r)<0&&(i=0):i>r&&(i=r),i<t&&(i=t);var n=this.subarray(t,i);return n.__proto__=e.prototype,n},e.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var r=this[e],n=1,s=0;++s<t&&(n*=256);)r+=this[e+s]*n;return r},e.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},e.prototype.readUInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),this[e]},e.prototype.readUInt16LE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]|this[e+1]<<8},e.prototype.readUInt16BE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]<<8|this[e+1]},e.prototype.readUInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},e.prototype.readUInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var r=this[e],n=1,s=0;++s<t&&(n*=256);)r+=this[e+s]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},e.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var r=t,n=1,s=this[e+--r];r>0&&(n*=256);)s+=this[e+--r]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},e.prototype.readInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},e.prototype.readInt16LE=function(e,t){e>>>=0,t||A(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},e.prototype.readInt16BE=function(e,t){e>>>=0,t||A(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},e.prototype.readInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e.prototype.readInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e.prototype.readFloatLE=function(e,t){return e>>>=0,t||A(e,4,this.length),n.read(this,e,!0,23,4)},e.prototype.readFloatBE=function(e,t){return e>>>=0,t||A(e,4,this.length),n.read(this,e,!1,23,4)},e.prototype.readDoubleLE=function(e,t){return e>>>=0,t||A(e,8,this.length),n.read(this,e,!0,52,8)},e.prototype.readDoubleBE=function(e,t){return e>>>=0,t||A(e,8,this.length),n.read(this,e,!1,52,8)},e.prototype.writeUIntLE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||T(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,s=0;for(this[t]=255&e;++s<i&&(n*=256);)this[t+s]=e/n&255;return t+i},e.prototype.writeUIntBE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||T(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+i},e.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,1,255,0),this[t]=255&e,t+1},e.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},e.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t>>>=0,!r){var n=Math.pow(2,8*i-1);T(this,e,t,i,n-1,-n)}var s=0,o=1,a=0;for(this[t]=255&e;++s<i&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+i},e.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t>>>=0,!r){var n=Math.pow(2,8*i-1);T(this,e,t,i,n-1,-n)}var s=i-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+i},e.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},e.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},e.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeFloatLE=function(e,t,i){return O(this,e,t,!0,i)},e.prototype.writeFloatBE=function(e,t,i){return O(this,e,t,!1,i)},e.prototype.writeDoubleLE=function(e,t,i){return B(this,e,t,!0,i)},e.prototype.writeDoubleBE=function(e,t,i){return B(this,e,t,!1,i)},e.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n,s=r-i;if(this===e&&i<t&&t<r)for(n=s-1;n>=0;--n)e[n+t]=this[n+i];else if(s<1e3)for(n=0;n<s;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},e.prototype.fill=function(t,i,r,n){if("string"==typeof t){if("string"==typeof i?(n=i,i=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!e.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(i<0||this.length<i||this.length<r)throw new RangeError("Out of range index");if(r<=i)return this;var o;if(i>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=i;o<r;++o)this[o]=t;else{var a=e.isBuffer(t)?t:new e(t,n),c=a.length;for(o=0;o<r-i;++o)this[o+i]=a[o%c]}return this};var F=/[^+/0-9A-Za-z-_]/g;function M(e,t){var i;t=t||1/0;for(var r=e.length,n=null,s=[],o=0;o<r;++o){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&s.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function P(e){return r.toByteArray(function(e){if((e=e.trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function U(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function H(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function j(e){return e!=e}}).call(t,i(1))},function(e,t){t.byteLength=function(e){return 3*e.length/4-c(e)},t.toByteArray=function(e){var t,i,s,o,a,h,l=e.length;a=c(e),h=new n(3*l/4-a),s=a>0?l-4:l;var u=0;for(t=0,i=0;t<s;t+=4,i+=3)o=r[e.charCodeAt(t)]<<18|r[e.charCodeAt(t+1)]<<12|r[e.charCodeAt(t+2)]<<6|r[e.charCodeAt(t+3)],h[u++]=o>>16&255,h[u++]=o>>8&255,h[u++]=255&o;return 2===a?(o=r[e.charCodeAt(t)]<<2|r[e.charCodeAt(t+1)]>>4,h[u++]=255&o):1===a&&(o=r[e.charCodeAt(t)]<<10|r[e.charCodeAt(t+1)]<<4|r[e.charCodeAt(t+2)]>>2,h[u++]=o>>8&255,h[u++]=255&o),h},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,s="",o=[],a=16383,c=0,l=r-n;c<l;c+=a)o.push(h(e,c,c+a>l?l:c+a));return 1===n?(t=e[r-1],s+=i[t>>2],s+=i[t<<4&63],s+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],s+=i[t>>10],s+=i[t>>4&63],s+=i[t<<2&63],s+="="),o.push(s),o.join("")};for(var i=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)i[o]=s[o],r[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function h(e,t,r){for(var n,s,o=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(i[(s=n)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,n){var s,o,a=8*n-r-1,c=(1<<a)-1,h=c>>1,l=-7,u=i?n-1:0,f=i?-1:1,d=e[t+u];for(u+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=256*s+e[t+u],u+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=256*o+e[t+u],u+=f,l-=8);if(0===s)s=1-h;else{if(s===c)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=h}return(d?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,i,r,n,s){var o,a,c,h=8*s-n-1,l=(1<<h)-1,u=l>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+u>=1?f/c:f*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=l?(a=0,o=l):o+u>=1?(a=(t*c-1)*Math.pow(2,n),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[i+d]=255&a,d+=p,a/=256,n-=8);for(o=o<<n|a,h+=n;h>0;e[i+d]=255&o,d+=p,o/=256,h-=8);e[i+d-p]|=128*_}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,i){var r=new(i(7)),n={};function s(e){n[e]||("function"==typeof r[e]?n[e]=function(){return r[e].apply(r,arguments)}:n[e]=r[e])}for(var o in r)s(o);n.initializeTTYs=function(){null===r.stdin&&(r.initializeTTYs(),n.stdin=r.stdin,n.stdout=r.stdout,n.stderr=r.stderr)},r.nextTick((function(){n.initializeTTYs()})),e.exports=n},function(e,t,i){(function(t){var r=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=i(8),s=null,o=function(){function e(e,t){this.fun=e,this.array=t}return e.prototype.run=function(){this.fun.apply(null,this.array)},e}(),a=function(){function e(){this._queue=[],this._draining=!1,this._currentQueue=null,this._queueIndex=-1}return e.prototype.push=function(e){var t=this;1!==this._queue.push(e)||this._draining||setTimeout((function(){return t._drainQueue()}),0)},e.prototype._cleanUpNextTick=function(){this._draining=!1,this._currentQueue&&this._currentQueue.length?this._queue=this._currentQueue.concat(this._queue):this._queueIndex=-1,this._queue.length&&this._drainQueue()},e.prototype._drainQueue=function(){var e=this;if(!this._draining){var t=setTimeout((function(){return e._cleanUpNextTick()}));this._draining=!0;for(var i=this._queue.length;i;){for(this._currentQueue=this._queue,this._queue=[];++this._queueIndex<i;)this._currentQueue&&this._currentQueue[this._queueIndex].run();this._queueIndex=-1,i=this._queue.length}this._currentQueue=null,this._draining=!1,clearTimeout(t)}},e}(),c=function(e){function n(){e.apply(this,arguments),this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.execArgv=[],this.stdout=null,this.stderr=null,this.stdin=null,this.domain=null,this._queue=new a,this.execPath=t,this.env={},this.exitCode=0,this._gid=1,this._uid=1,this.version="v5.0",this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"},this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:!1,node_install_waf:!1,node_prefix:"",node_shared_cares:!1,node_shared_http_parser:!1,node_shared_libuv:!1,node_shared_zlib:!1,node_shared_v8:!1,node_use_dtrace:!1,node_use_etw:!1,node_use_openssl:!1,node_shared_openssl:!1,strict_aliasing:!1,target_arch:"x32",v8_use_snapshot:!1,v8_no_strict_aliasing:0,visibility:""}},this.pid=1e3*Math.random()|0,this.title="node",this.arch="x32",this._mask=18,this.connected=void 0}return r(n,e),n.prototype.chdir=function(e){null===s&&(s=i(9)),this._cwd=s.resolve(e)},n.prototype.cwd=function(){return this._cwd},n.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},n.prototype.nextTick=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this._queue.push(new o(e,t))},n.prototype.abort=function(){this.emit("abort")},n.prototype.exit=function(e){this.exitCode=e,this.emit("exit",[e])},n.prototype.getgid=function(){return this._gid},n.prototype.setgid=function(e){this._gid="number"==typeof e?e:1},n.prototype.getuid=function(){return this._uid},n.prototype.setuid=function(e){this._uid="number"==typeof e?e:1},n.prototype.kill=function(e,t){this.emit("kill",[e,t])},n.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}},n.prototype.umask=function(e){void 0===e&&(e=this._mask);var t=this._mask;return this._mask=e,this.emit("umask",[e]),t},n.prototype.hrtime=function(){var e,t=(e="undefined"!=typeof performance?performance.now():Date.now?Date.now():(new Date).getTime())/1e3|0;return[t,e=1e6*(e-=1e3*t)|0]},n.prototype.initializeTTYs=function(){if(null===this.stdout){var e=i(10);this.stdout=new e,this.stderr=new e,this.stdin=new e}},n.prototype.disconnect=function(){},n}(n.EventEmitter);e.exports=c}).call(t,"/")},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,o,a,c,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(s(i=this._events[e]))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(n(i))for(a=Array.prototype.slice.call(arguments,1),o=(h=i.slice()).length,c=0;c<o;c++)h[c].apply(this,a);return!0},i.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var i,s,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(i=this._events[e]).length,s=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(i)){for(a=o;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){s=a;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){(function(t){var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(){function e(){}return e.normalize=function(t){""===t&&(t=".");for(var i=t.charAt(0)===e.sep,r=(t=e._removeDuplicateSeps(t)).split(e.sep),n=[],s=0;s<r.length;s++){var o=r[s];"."!==o&&(".."===o&&(i||!i&&n.length>0&&".."!==n[0])?n.pop():n.push(o))}return!i&&n.length<2&&(1===n.length?""===n[0]&&n.unshift("."):n.push(".")),t=n.join(e.sep),i&&t.charAt(0)!==e.sep&&(t=e.sep+t),t},e.join=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];for(var r=[],n=0;n<t.length;n++){var s=t[n];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&r.push(s)}return e.normalize(r.join(e.sep))},e.resolve=function(){for(var i=[],r=0;r<arguments.length;r++)i[r-0]=arguments[r];for(var n=[],s=0;s<i.length;s++){var o=i[s];if("string"!=typeof o)throw new TypeError("Invalid argument type to path.join: "+typeof o);""!==o&&(o.charAt(0)===e.sep&&(n=[]),n.push(o))}var a=e.normalize(n.join(e.sep));if(a.length>1&&a.charAt(a.length-1)===e.sep)return a.substr(0,a.length-1);if(a.charAt(0)!==e.sep){"."!==a.charAt(0)||1!==a.length&&a.charAt(1)!==e.sep||(a=1===a.length?"":a.substr(2));var c=t.cwd();a=""!==a?this.normalize(c+("/"!==c?e.sep:"")+a):c}return a},e.relative=function(t,i){var r;t=e.resolve(t),i=e.resolve(i);var n=t.split(e.sep),s=i.split(e.sep);s.shift(),n.shift();var o=0,a=[];for(r=0;r<n.length;r++)if(n[r]!==s[r]){o=n.length-r;break}a=s.slice(r),1===n.length&&""===n[0]&&(o=0),o>n.length&&(o=n.length);var c="";for(r=0;r<o;r++)c+="../";return(c+=a.join(e.sep)).length>1&&c.charAt(c.length-1)===e.sep&&(c=c.substr(0,c.length-1)),c},e.dirname=function(t){var i=(t=e._removeDuplicateSeps(t)).charAt(0)===e.sep,r=t.split(e.sep);return""===r.pop()&&r.length>0&&r.pop(),r.length>1||1===r.length&&!i?r.join(e.sep):i?e.sep:"."},e.basename=function(t,i){if(void 0===i&&(i=""),""===t)return t;var r=(t=e.normalize(t)).split(e.sep),n=r[r.length-1];return""===n&&r.length>1?r[r.length-2]:i.length>0&&n.substr(n.length-i.length)===i?n.substr(0,n.length-i.length):n},e.extname=function(t){var i=(t=e.normalize(t)).split(e.sep);if(""===(t=i.pop())&&i.length>0&&(t=i.pop()),".."===t)return"";var r=t.lastIndexOf(".");return-1===r||0===r?"":t.substr(r)},e.isAbsolute=function(t){return t.length>0&&t.charAt(0)===e.sep},e._makeLong=function(e){return e},e.parse=function(e){var t,r,n=(t=e,(r=i.exec(t)).shift(),r);return{root:n[0],dir:n[0]+n[1].slice(0,-1),base:n[2],ext:n[3],name:n[2].slice(0,n[2].length-n[3].length)}},e.format=function(t){if(null===t||"object"!=typeof t)throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof t);if("string"!=typeof(t.root||""))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof t.root);return(t.dir?t.dir+e.sep:"")+(t.base||"")},e._removeDuplicateSeps=function(e){return e=e.replace(this._replaceRegex,this.sep)},e.sep="/",e._replaceRegex=new RegExp("//+","g"),e.delimiter=":",e.posix=e,e.win32=e,e}();e.exports=r}).call(t,i(6))},function(e,t,i){(function(t){var r=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=function(e){function i(){e.call(this),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0,this._bufferedWrites=[],this._waitingForWrites=!1}return r(i,e),i.prototype.setRawMode=function(e){this.isRaw!==e&&(this.isRaw=e,this.emit("modeChange"))},i.prototype.changeColumns=function(e){e!==this.columns&&(this.columns=e,this.emit("resize"))},i.prototype.changeRows=function(e){e!==this.rows&&(this.rows=e,this.emit("resize"))},i.isatty=function(e){return e&&e instanceof i},i.prototype._write=function(e,i,r){var n;try{var s;s="string"==typeof e?new t(e,i):e,this._bufferedWrites.push(s),this._waitingForWrites&&this._read(1024)}catch(e){n=e}finally{r(n)}},i.prototype._read=function(e){if(0===this._bufferedWrites.length)this._waitingForWrites=!0;else for(;this._bufferedWrites.length>0&&(this._waitingForWrites=this.push(this._bufferedWrites.shift()),this._waitingForWrites););},i}(i(11).Duplex);e.exports=n}).call(t,i(1))},function(e,t,i){e.exports=n;var r=i(8).EventEmitter;function n(){r.call(this)}i(12)(n,r),n.Readable=i(13),n.Writable=i(27),n.Duplex=i(28),n.Transform=i(29),n.PassThrough=i(30),n.Stream=n,n.prototype.pipe=function(e,t){var i=this;function n(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",n),e.on("drain",s),e._isStdio||t&&!1===t.end||(i.on("end",a),i.on("close",c));var o=!1;function a(){o||(o=!0,e.end())}function c(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function h(e){if(l(),0===r.listenerCount(this,"error"))throw e}function l(){i.removeListener("data",n),e.removeListener("drain",s),i.removeListener("end",a),i.removeListener("close",c),i.removeListener("error",h),e.removeListener("error",h),i.removeListener("end",l),i.removeListener("close",l),e.removeListener("close",l)}return i.on("error",h),e.on("error",h),i.on("end",l),i.on("close",l),e.on("close",l),e.emit("pipe",i),e}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t,i){(function(r){var n=function(){try{return i(11)}catch(e){}}();(t=e.exports=i(14)).Stream=n||t,t.Readable=t,t.Writable=i(22),t.Duplex=i(21),t.Transform=i(25),t.PassThrough=i(26),!r.browser&&"disable"===r.env.READABLE_STREAM&&n&&(e.exports=n)}).call(t,i(6))},function(e,t,i){(function(t){e.exports=g;var r,n=i(15),s=i(16);g.ReadableState=_,i(8).EventEmitter;var o,a=function(e,t){return e.listeners(t).length};!function(){try{o=i(11)}catch(e){}finally{o||(o=i(8).EventEmitter)}}();var c=i(2).Buffer,h=i(17),l=i(18);l.inherits=i(12);var u=i(19),f=void 0;f=u&&u.debuglog?u.debuglog("stream"):function(){};var d,p=i(20);function _(e,t){r=r||i(21),e=e||{},this.objectMode=!!e.objectMode,t instanceof r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:s,this.highWaterMark=~~this.highWaterMark,this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=i(24).StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function g(e){if(r=r||i(21),!(this instanceof g))return new g(e);this._readableState=new _(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),o.call(this)}function v(e,t,i,r,s){var o=function(e,t){var i=null;return c.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(t,i);if(o)e.emit("error",o);else if(null===i)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,S(e)}}(e,t);else if(t.objectMode||i&&i.length>0)if(t.ended&&!s){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&s){var h=new Error("stream.unshift() after end event");e.emit("error",h)}else{var l;!t.decoder||s||r||(i=t.decoder.write(i),l=!t.objectMode&&0===i.length),s||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,s?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&S(e))),function(e,t){t.readingMore||(t.readingMore=!0,n(b,e,t))}(e,t)}else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}l.inherits(g,o),g.prototype.push=function(e,t){var i=this._readableState;return i.objectMode||"string"!=typeof e||(t=t||i.defaultEncoding)!==i.encoding&&(e=h.from(e,t),t=""),v(this,i,e,t,!1)},g.prototype.unshift=function(e){return v(this,this._readableState,e,"",!0)},g.prototype.isPaused=function(){return!1===this._readableState.flowing},g.prototype.setEncoding=function(e){return d||(d=i(24).StringDecoder),this._readableState.decoder=new d(e),this._readableState.encoding=e,this};var y=8388608;function m(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=y?e=y:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n(w,e):w(e))}function w(e){f("emit readable"),e.emit("readable"),k(e)}function b(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function E(e){f("readable nexttick read 0"),e.read(0)}function C(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),k(e),t.flowing&&!t.reading&&e.read(0)}function k(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,r=1,n=i.data;for(e-=n.length;i=i.next;){var s=i.data,o=e>s.length?s.length:e;if(o===s.length?n+=s:n+=s.slice(0,e),0==(e-=o)){o===s.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(o));break}++r}return t.length-=r,n}(e,t):function(e,t){var i=h.allocUnsafe(e),r=t.head,n=1;for(r.data.copy(i),e-=r.data.length;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(i,i.length-e,0,o),0==(e-=o)){o===s.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++n}return t.length-=n,i}(e,t),r}(e,t.buffer,t.decoder),i);var i}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}g.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):S(this),null;if(0===(e=m(e,t))&&t.ended)return 0===t.length&&R(this),null;var r,n=t.needReadable;return f("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",n=!0),t.ended||t.reading?f("reading or ended",n=!1):n&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=m(i,t))),null===(r=e>0?L(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&R(this)),null!==r&&this.emit("data",r),r},g.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},g.prototype.pipe=function(e,i){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,i);var c=i&&!1===i.end||e===t.stdout||e===t.stderr?p:l;function h(e){f("onunpipe"),e===r&&p()}function l(){f("onend"),e.end()}o.endEmitted?n(c):r.once("end",c),e.on("unpipe",h);var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,k(e))}}(r);e.on("drain",u);var d=!1;function p(){f("cleanup"),e.removeListener("close",y),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",v),e.removeListener("unpipe",h),r.removeListener("end",l),r.removeListener("end",p),r.removeListener("data",g),d=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u()}var _=!1;function g(t){f("ondata"),_=!1,!1!==e.write(t)||_||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==x(o.pipes,e))&&!d&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,_=!0),r.pause())}function v(t){f("onerror",t),S(),e.removeListener("error",v),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",m),S()}function m(){f("onfinish"),e.removeListener("close",y),S()}function S(){f("unpipe"),r.unpipe(e)}return r.on("data",g),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",v),e.once("close",y),e.once("finish",m),e.emit("pipe",r),o.flowing||(f("pipe resume"),r.resume()),e},g.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var s=x(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},g.prototype.on=function(e,t){var i=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):n(E,this))}return i},g.prototype.addListener=g.prototype.on,g.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n(C,e,t))}(this,e)),this},g.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},g.prototype.wrap=function(e){var t=this._readableState,i=!1,r=this;for(var n in e.on("end",(function(){if(f("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(n){f("wrapped data"),t.decoder&&(n=t.decoder.write(n)),t.objectMode&&null==n||(t.objectMode||n&&n.length)&&(r.push(n)||(i=!0,e.pause()))})),e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));return function(e,t){for(var i=0,r=e.length;i<r;i++)t(e[i],i)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,r.emit.bind(r,t))})),r._read=function(t){f("wrapped _read",t),i&&(i=!1,e.resume())},r},g._fromList=L}).call(t,i(6))},function(e,t,i){(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports=function(e,i,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,i)}));case 3:return t.nextTick((function(){e.call(null,i,r)}));case 4:return t.nextTick((function(){e.call(null,i,r,n)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return t.nextTick((function(){e.apply(null,s)}))}}:e.exports=t.nextTick}).call(t,i(6))},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){(function(e){var r=i(2),n=r.Buffer,s=r.SlowBuffer,o=r.kMaxLength||2147483647;t.alloc=function(e,t,i){if("function"==typeof n.alloc)return n.alloc(e,t,i);if("number"==typeof i)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>o)throw new RangeError("size is too large");var r=i,s=t;void 0===s&&(r=void 0,s=0);var a=new n(e);if("string"==typeof s)for(var c=new n(s,r),h=c.length,l=-1;++l<e;)a[l]=c[l%h];else a.fill(s);return a},t.allocUnsafe=function(e){if("function"==typeof n.allocUnsafe)return n.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>o)throw new RangeError("size is too large");return new n(e)},t.from=function(t,i,r){if("function"==typeof n.from&&(!e.Uint8Array||Uint8Array.from!==n.from))return n.from(t,i,r);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("string"==typeof t)return new n(t,i);if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var s=i;if(1===arguments.length)return new n(t);void 0===s&&(s=0);var o=r;if(void 0===o&&(o=t.byteLength-s),s>=t.byteLength)throw new RangeError("'offset' is out of bounds");if(o>t.byteLength-s)throw new RangeError("'length' is out of bounds");return new n(t.slice(s,s+o))}if(n.isBuffer(t)){var a=new n(t.length);return t.copy(a,0,0,t.length),a}if(t){if(Array.isArray(t)||"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return new n(t);if("Buffer"===t.type&&Array.isArray(t.data))return new n(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},t.allocUnsafeSlow=function(e){if("function"==typeof n.allocUnsafeSlow)return n.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=o)throw new RangeError("size is too large");return new s(e)}}).call(t,function(){return this}())},function(e,t,i){(function(e){function i(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===i(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===i(e)},t.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(t,i(1))},function(e,t){},function(e,t,i){i(2).Buffer;var r=i(17);function n(){this.head=null,this.tail=null,this.length=0}e.exports=n,n.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},n.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},n.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},n.prototype.clear=function(){this.head=this.tail=null,this.length=0},n.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},n.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),i=this.head,n=0;i;)i.data.copy(t,n),n+=i.data.length,i=i.next;return t}},function(e,t,i){var r=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=u;var n=i(15),s=i(18);s.inherits=i(12);var o=i(14),a=i(22);s.inherits(u,o);for(var c=r(a.prototype),h=0;h<c.length;h++){var l=c[h];u.prototype[l]||(u.prototype[l]=a.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n(d,this)}function d(e){e.end()}},function(e,t,i){(function(t){e.exports=_;var r,n=i(15),s=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?setImmediate:n;_.WritableState=p;var o=i(18);o.inherits=i(12);var a,c={deprecate:i(23)};!function(){try{a=i(11)}catch(e){}finally{a||(a=i(8).EventEmitter)}}();var h,l=i(2).Buffer,u=i(17);function f(){}function d(e,t,i){this.chunk=e,this.encoding=t,this.callback=i,this.next=null}function p(e,t){r=r||i(21),e=e||{},this.objectMode=!!e.objectMode,t instanceof r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var o=e.highWaterMark,a=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:a,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var c=!1===e.decodeStrings;this.decodeStrings=!c,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,r=i.sync,o=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,r,s){--t.pendingcb,i?n(s,r):s(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,i,r,t,o);else{var a=m(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||y(e,i),r?s(v,e,i,a,o):v(e,i,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new b(this)}function _(e){if(r=r||i(21),!(h.call(_,this)||this instanceof r))return new _(e);this._writableState=new p(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),a.call(this)}function g(e,t,i,r,n,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,i?e._writev(n,t.onwrite):e._write(n,s,t.onwrite),t.sync=!1}function v(e,t,i,r){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),w(e,t)}function y(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var r=t.bufferedRequestCount,n=new Array(r),s=t.corkedRequestsFree;s.entry=i;for(var o=0;i;)n[o]=i,i=i.next,o+=1;g(e,t,!0,t.length,n,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new b(t)}else{for(;i;){var a=i.chunk,c=i.encoding,h=i.callback;if(g(e,t,!1,t.objectMode?1:a.length,a,c,h),i=i.next,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=i,t.bufferProcessing=!1}function m(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function w(e,t){var i=m(t);return i&&(0===t.pendingcb?(S(e,t),t.finished=!0,e.emit("finish")):S(e,t)),i}function b(e){var t=this;this.next=null,this.entry=null,this.finish=function(i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}o.inherits(_,a),p.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(p.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!h.call(this,e)||e&&e._writableState instanceof p}})):h=function(e){return e instanceof this},_.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},_.prototype.write=function(e,t,i){var r=this._writableState,s=!1,o=l.isBuffer(e);return"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=f),r.ended?function(e,t){var i=new Error("write after end");e.emit("error",i),n(t,i)}(this,i):(o||function(e,t,i,r){var s=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),n(r,o),s=!1),s}(this,r,e,i))&&(r.pendingcb++,s=function(e,t,i,r,n,s){i||(r=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,i)),t}(t,r,n),l.isBuffer(r)&&(n="buffer"));var o=t.objectMode?1:r.length;t.length+=o;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest=new d(r,n,s),c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else g(e,t,!1,o,r,n,s);return a}(this,r,o,e,t,i)),s},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||y(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},_.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},_.prototype._writev=null,_.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,i){t.ending=!0,w(e,t),i&&(t.finished?n(i):e.once("finish",i)),t.ended=!0,e.writable=!1}(this,r,i)}}).call(t,i(6))},function(e,t){(function(t){function i(e){try{if(!t.localStorage)return!1}catch(e){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(t,function(){return this}())},function(e,t,i){var r=i(2).Buffer,n=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},s=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!n(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=c;break;default:return void(this.write=o)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function o(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function c(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}s.prototype.write=function(e){for(var t="";this.charLength;){var i=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";if(e=e.slice(i,e.length),!((r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,n=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived),n=(t+=e.toString(this.encoding,0,n)).length-1,(r=t.charCodeAt(n))>=55296&&r<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,n)}return t},s.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=t},s.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var i=this.charReceived,r=this.charBuffer,n=this.encoding;t+=r.slice(0,i).toString(n)}return t}},function(e,t,i){e.exports=o;var r=i(21),n=i(18);function s(e){this.afterTransform=function(t,i){return function(e,t,i){var r=e._transformState;r.transforming=!1;var n=r.writecb;if(!n)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=i&&e.push(i),n(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}(e,t,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState=new s(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e,i){a(t,e,i)})):a(t)}))}function a(e,t,i){if(t)return e.emit("error",t);null!=i&&e.push(i);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}n.inherits=i(12),n.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,i){var r=this._transformState;if(r.writecb=i,r.writechunk=e,r.writeencoding=t,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,i){e.exports=s;var r=i(25),n=i(18);function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}n.inherits=i(12),n.inherits(s,r),s.prototype._transform=function(e,t,i){i(null,e)}},function(e,t,i){e.exports=i(22)},function(e,t,i){e.exports=i(21)},function(e,t,i){e.exports=i(25)},function(e,t,i){e.exports=i(26)},function(e,t,i){var r=i(32),n=i(33),s=i(38),o=i(39),a=i(40),c=i(41),h=i(42),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=r.inflateInit2(this.strm,t.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);this.header=new h,r.inflateGetHeader(this.strm,this.header)}function f(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}u.prototype.push=function(e,t){var i,a,c,h,u,f,d=this.strm,p=this.options.chunkSize,_=this.options.dictionary,g=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(p),d.next_out=0,d.avail_out=p),(i=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&_&&(f="string"==typeof _?s.string2buf(_):"[object ArrayBuffer]"===l.call(_)?new Uint8Array(_):_,i=r.inflateSetDictionary(this.strm,f)),i===o.Z_BUF_ERROR&&!0===g&&(i=o.Z_OK,g=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(d.output,d.next_out),h=d.next_out-c,u=s.buf2string(d.output,c),d.next_out=h,d.avail_out=p-h,h&&n.arraySet(d.output,d.output,c,h,0),this.onData(u)):this.onData(n.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=r.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=f,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.ungzip=f},function(e,t,i){var r=i(33),n=i(34),s=i(35),o=i(36),a=i(37),c=-2,h=12,l=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function f(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):c}function _(e,t){var i,r;return e&&e.state?(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,p(e))):c}function g(e,t){var i,r;return e?(r=new f,e.state=r,r.window=null,0!==(i=_(e,t))&&(e.state=null),i):c}var v,y,m=!0;function S(e){if(m){var t;for(v=new r.Buf32(512),y=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,y,0,e.work,{bits:5}),m=!1}e.lencode=v,e.lenbits=9,e.distcode=y,e.distbits=5}function w(e,t,i,n){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),n>=o.wsize?(r.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>n&&(s=n),r.arraySet(o.window,t,i-n,s,o.wnext),(n-=s)?(r.arraySet(o.window,t,i-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}t.inflateReset=p,t.inflateReset2=_,t.inflateResetKeep=d,t.inflateInit=function(e){return g(e,15)},t.inflateInit2=g,t.inflate=function(e,t){var i,f,d,p,_,g,v,y,m,b,E,C,k,L,R,D,x,A,T,I,O,B,F,M,P=0,N=new r.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(i=e.state).mode===h&&(i.mode=13),_=e.next_out,d=e.output,v=e.avail_out,p=e.next_in,f=e.input,g=e.avail_in,y=i.hold,m=i.bits,b=g,E=v,B=0;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;m<16;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(2&i.wrap&&35615===y){i.check=0,N[0]=255&y,N[1]=y>>>8&255,i.check=s(i.check,N,2,0),y=0,m=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=l;break}if(8!=(15&y)){e.msg="unknown compression method",i.mode=l;break}if(m-=4,O=8+(15&(y>>>=4)),0===i.wbits)i.wbits=O;else if(O>i.wbits){e.msg="invalid window size",i.mode=l;break}i.dmax=1<<O,e.adler=i.check=1,i.mode=512&y?10:h,y=0,m=0;break;case 2:for(;m<16;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(i.flags=y,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=l;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=l;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(N[0]=255&y,N[1]=y>>>8&255,i.check=s(i.check,N,2,0)),y=0,m=0,i.mode=3;case 3:for(;m<32;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.head&&(i.head.time=y),512&i.flags&&(N[0]=255&y,N[1]=y>>>8&255,N[2]=y>>>16&255,N[3]=y>>>24&255,i.check=s(i.check,N,4,0)),y=0,m=0,i.mode=4;case 4:for(;m<16;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(N[0]=255&y,N[1]=y>>>8&255,i.check=s(i.check,N,2,0)),y=0,m=0,i.mode=5;case 5:if(1024&i.flags){for(;m<16;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(N[0]=255&y,N[1]=y>>>8&255,i.check=s(i.check,N,2,0)),y=0,m=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((C=i.length)>g&&(C=g),C&&(i.head&&(O=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),r.arraySet(i.head.extra,f,p,C,O)),512&i.flags&&(i.check=s(i.check,f,C,p)),g-=C,p+=C,i.length-=C),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===g)break e;C=0;do{O=f[p+C++],i.head&&O&&i.length<65536&&(i.head.name+=String.fromCharCode(O))}while(O&&C<g);if(512&i.flags&&(i.check=s(i.check,f,C,p)),g-=C,p+=C,O)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===g)break e;C=0;do{O=f[p+C++],i.head&&O&&i.length<65536&&(i.head.comment+=String.fromCharCode(O))}while(O&&C<g);if(512&i.flags&&(i.check=s(i.check,f,C,p)),g-=C,p+=C,O)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;m<16;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=l;break}y=0,m=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=h;break;case 10:for(;m<32;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}e.adler=i.check=u(y),y=0,m=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=_,e.avail_out=v,e.next_in=p,e.avail_in=g,i.hold=y,i.bits=m,2;e.adler=i.check=1,i.mode=h;case h:if(5===t||6===t)break e;case 13:if(i.last){y>>>=7&m,m-=7&m,i.mode=27;break}for(;m<3;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}switch(i.last=1&y,m-=1,3&(y>>>=1)){case 0:i.mode=14;break;case 1:if(S(i),i.mode=20,6===t){y>>>=2,m-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=l}y>>>=2,m-=2;break;case 14:for(y>>>=7&m,m-=7&m;m<32;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=l;break}if(i.length=65535&y,y=0,m=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(C=i.length){if(C>g&&(C=g),C>v&&(C=v),0===C)break e;r.arraySet(d,f,p,C,_),g-=C,p+=C,v-=C,_+=C,i.length-=C;break}i.mode=h;break;case 17:for(;m<14;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(i.nlen=257+(31&y),y>>>=5,m-=5,i.ndist=1+(31&y),y>>>=5,m-=5,i.ncode=4+(15&y),y>>>=4,m-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=l;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;m<3;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.lens[U[i.have++]]=7&y,y>>>=3,m-=3}for(;i.have<19;)i.lens[U[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,F={bits:i.lenbits},B=a(0,i.lens,0,19,i.lencode,0,i.work,F),i.lenbits=F.bits,B){e.msg="invalid code lengths set",i.mode=l;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;D=(P=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,x=65535&P,!((R=P>>>24)<=m);){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(x<16)y>>>=R,m-=R,i.lens[i.have++]=x;else{if(16===x){for(M=R+2;m<M;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(y>>>=R,m-=R,0===i.have){e.msg="invalid bit length repeat",i.mode=l;break}O=i.lens[i.have-1],C=3+(3&y),y>>>=2,m-=2}else if(17===x){for(M=R+3;m<M;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}m-=R,O=0,C=3+(7&(y>>>=R)),y>>>=3,m-=3}else{for(M=R+7;m<M;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}m-=R,O=0,C=11+(127&(y>>>=R)),y>>>=7,m-=7}if(i.have+C>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=l;break}for(;C--;)i.lens[i.have++]=O}}if(i.mode===l)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=l;break}if(i.lenbits=9,F={bits:i.lenbits},B=a(1,i.lens,0,i.nlen,i.lencode,0,i.work,F),i.lenbits=F.bits,B){e.msg="invalid literal/lengths set",i.mode=l;break}if(i.distbits=6,i.distcode=i.distdyn,F={bits:i.distbits},B=a(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,F),i.distbits=F.bits,B){e.msg="invalid distances set",i.mode=l;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(g>=6&&v>=258){e.next_out=_,e.avail_out=v,e.next_in=p,e.avail_in=g,i.hold=y,i.bits=m,o(e,E),_=e.next_out,d=e.output,v=e.avail_out,p=e.next_in,f=e.input,g=e.avail_in,y=i.hold,m=i.bits,i.mode===h&&(i.back=-1);break}for(i.back=0;D=(P=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,x=65535&P,!((R=P>>>24)<=m);){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(D&&0==(240&D)){for(A=R,T=D,I=x;D=(P=i.lencode[I+((y&(1<<A+T)-1)>>A)])>>>16&255,x=65535&P,!(A+(R=P>>>24)<=m);){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}y>>>=A,m-=A,i.back+=A}if(y>>>=R,m-=R,i.back+=R,i.length=x,0===D){i.mode=26;break}if(32&D){i.back=-1,i.mode=h;break}if(64&D){e.msg="invalid literal/length code",i.mode=l;break}i.extra=15&D,i.mode=22;case 22:if(i.extra){for(M=i.extra;m<M;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,m-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;D=(P=i.distcode[y&(1<<i.distbits)-1])>>>16&255,x=65535&P,!((R=P>>>24)<=m);){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(0==(240&D)){for(A=R,T=D,I=x;D=(P=i.distcode[I+((y&(1<<A+T)-1)>>A)])>>>16&255,x=65535&P,!(A+(R=P>>>24)<=m);){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}y>>>=A,m-=A,i.back+=A}if(y>>>=R,m-=R,i.back+=R,64&D){e.msg="invalid distance code",i.mode=l;break}i.offset=x,i.extra=15&D,i.mode=24;case 24:if(i.extra){for(M=i.extra;m<M;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,m-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=l;break}i.mode=25;case 25:if(0===v)break e;if(C=E-v,i.offset>C){if((C=i.offset-C)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=l;break}C>i.wnext?(C-=i.wnext,k=i.wsize-C):k=i.wnext-C,C>i.length&&(C=i.length),L=i.window}else L=d,k=_-i.offset,C=i.length;C>v&&(C=v),v-=C,i.length-=C;do{d[_++]=L[k++]}while(--C);0===i.length&&(i.mode=21);break;case 26:if(0===v)break e;d[_++]=i.length,v--,i.mode=21;break;case 27:if(i.wrap){for(;m<32;){if(0===g)break e;g--,y|=f[p++]<<m,m+=8}if(E-=v,e.total_out+=E,i.total+=E,E&&(e.adler=i.check=i.flags?s(i.check,d,E,_-E):n(i.check,d,E,_-E)),E=v,(i.flags?y:u(y))!==i.check){e.msg="incorrect data check",i.mode=l;break}y=0,m=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;m<32;){if(0===g)break e;g--,y+=f[p++]<<m,m+=8}if(y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=l;break}y=0,m=0}i.mode=29;case 29:B=1;break e;case l:B=-3;break e;case 31:return-4;default:return c}return e.next_out=_,e.avail_out=v,e.next_in=p,e.avail_in=g,i.hold=y,i.bits=m,(i.wsize||E!==e.avail_out&&i.mode<l&&(i.mode<27||4!==t))&&w(e,e.output,e.next_out,E-e.avail_out),b-=e.avail_in,E-=e.avail_out,e.total_in+=b,e.total_out+=E,i.total+=E,i.wrap&&E&&(e.adler=i.check=i.flags?s(i.check,d,E,e.next_out-E):n(i.check,d,E,e.next_out-E)),e.data_type=i.bits+(i.last?64:0)+(i.mode===h?128:0)+(20===i.mode||15===i.mode?256:0),(0===b&&0===E||4===t)&&0===B&&(B=-5),B},t.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?c:(i.head=t,t.done=!1,0):c},t.inflateSetDictionary=function(e,t){var i,r=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?c:11===i.mode&&n(1,t,r,0)!==i.check?-3:w(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,0):c},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var s=0;s<r;s++)e[n+s]=t[i+s]},flattenChunks:function(e){var t,i,r,n,s,o;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(o=new Uint8Array(r),n=0,t=0,i=e.length;t<i;t++)s=e[t],o.set(s,n),n+=s.length;return o}},n={arraySet:function(e,t,i,r,n){for(var s=0;s<r;s++)e[n+s]=t[i+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,n))},t.setTyped(i)},function(e,t){e.exports=function(e,t,i,r){for(var n=65535&e|0,s=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{s=s+(n=n+t[r++]|0)|0}while(--o);n%=65521,s%=65521}return n|s<<16|0}},function(e,t){var i=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();e.exports=function(e,t,r,n){var s=i,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},function(e,t){e.exports=function(e,t){var i,r,n,s,o,a,c,h,l,u,f,d,p,_,g,v,y,m,S,w,b,E,C,k,L;i=e.state,r=e.next_in,k=e.input,n=r+(e.avail_in-5),s=e.next_out,L=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=i.dmax,h=i.wsize,l=i.whave,u=i.wnext,f=i.window,d=i.hold,p=i.bits,_=i.lencode,g=i.distcode,v=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;e:do{p<15&&(d+=k[r++]<<p,p+=8,d+=k[r++]<<p,p+=8),m=_[d&v];t:for(;;){if(d>>>=S=m>>>24,p-=S,0==(S=m>>>16&255))L[s++]=65535&m;else{if(!(16&S)){if(0==(64&S)){m=_[(65535&m)+(d&(1<<S)-1)];continue t}if(32&S){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}w=65535&m,(S&=15)&&(p<S&&(d+=k[r++]<<p,p+=8),w+=d&(1<<S)-1,d>>>=S,p-=S),p<15&&(d+=k[r++]<<p,p+=8,d+=k[r++]<<p,p+=8),m=g[d&y];i:for(;;){if(d>>>=S=m>>>24,p-=S,!(16&(S=m>>>16&255))){if(0==(64&S)){m=g[(65535&m)+(d&(1<<S)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(b=65535&m,p<(S&=15)&&(d+=k[r++]<<p,(p+=8)<S&&(d+=k[r++]<<p,p+=8)),(b+=d&(1<<S)-1)>c){e.msg="invalid distance too far back",i.mode=30;break e}if(d>>>=S,p-=S,b>(S=s-o)){if((S=b-S)>l&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(E=0,C=f,0===u){if(E+=h-S,S<w){w-=S;do{L[s++]=f[E++]}while(--S);E=s-b,C=L}}else if(u<S){if(E+=h+u-S,(S-=u)<w){w-=S;do{L[s++]=f[E++]}while(--S);if(E=0,u<w){w-=S=u;do{L[s++]=f[E++]}while(--S);E=s-b,C=L}}}else if(E+=u-S,S<w){w-=S;do{L[s++]=f[E++]}while(--S);E=s-b,C=L}for(;w>2;)L[s++]=C[E++],L[s++]=C[E++],L[s++]=C[E++],w-=3;w&&(L[s++]=C[E++],w>1&&(L[s++]=C[E++]))}else{E=s-b;do{L[s++]=L[E++],L[s++]=L[E++],L[s++]=L[E++],w-=3}while(w>2);w&&(L[s++]=L[E++],w>1&&(L[s++]=L[E++]))}break}}break}}while(r<n&&s<a);r-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=r,e.next_out=s,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=s<a?a-s+257:257-(s-a),i.hold=d,i.bits=p}},function(e,t,i){var r=i(33),n=15,s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,i,h,l,u,f,d){var p,_,g,v,y,m,S,w,b,E=d.bits,C=0,k=0,L=0,R=0,D=0,x=0,A=0,T=0,I=0,O=0,B=null,F=0,M=new r.Buf16(16),P=new r.Buf16(16),N=null,U=0;for(C=0;C<=n;C++)M[C]=0;for(k=0;k<h;k++)M[t[i+k]]++;for(D=E,R=n;R>=1&&0===M[R];R--);if(D>R&&(D=R),0===R)return l[u++]=20971520,l[u++]=20971520,d.bits=1,0;for(L=1;L<R&&0===M[L];L++);for(D<L&&(D=L),T=1,C=1;C<=n;C++)if(T<<=1,(T-=M[C])<0)return-1;if(T>0&&(0===e||1!==R))return-1;for(P[1]=0,C=1;C<n;C++)P[C+1]=P[C]+M[C];for(k=0;k<h;k++)0!==t[i+k]&&(f[P[t[i+k]]++]=k);if(0===e?(B=N=f,m=19):1===e?(B=s,F-=257,N=o,U-=257,m=256):(B=a,N=c,m=-1),O=0,k=0,C=L,y=u,x=D,A=0,g=-1,v=(I=1<<D)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){S=C-A,f[k]<m?(w=0,b=f[k]):f[k]>m?(w=N[U+f[k]],b=B[F+f[k]]):(w=96,b=0),p=1<<C-A,L=_=1<<x;do{l[y+(O>>A)+(_-=p)]=S<<24|w<<16|b|0}while(0!==_);for(p=1<<C-1;O&p;)p>>=1;if(0!==p?(O&=p-1,O+=p):O=0,k++,0==--M[C]){if(C===R)break;C=t[i+f[k]]}if(C>D&&(O&v)!==g){for(0===A&&(A=D),y+=L,T=1<<(x=C-A);x+A<R&&!((T-=M[x+A])<=0);)x++,T<<=1;if(I+=1<<x,1===e&&I>852||2===e&&I>592)return 1;l[g=O&v]=D<<24|x<<16|y-u|0}}return 0!==O&&(l[y+O]=C-A<<24|64<<16|0),d.bits=D,0}},function(e,t,i){var r=i(33),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&n))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var i="",o=0;o<t;o++)i+=String.fromCharCode(e[o]);return i}o[254]=o[254]=1,t.string2buf=function(e){var t,i,n,s,o,a=e.length,c=0;for(s=0;s<a;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),c+=i<128?1:i<2048?2:i<65536?3:4;for(t=new r.Buf8(c),o=0,s=0;o<c;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},t.buf2string=function(e,t){var i,r,n,s,a=t||e.length,h=new Array(2*a);for(r=0,i=0;i<a;)if((n=e[i++])<128)h[r++]=n;else if((s=o[n])>4)h[r++]=65533,i+=s-1;else{for(n&=2===s?31:3===s?15:7;s>1&&i<a;)n=n<<6|63&e[i++],s--;s>1?h[r++]=65533:n<65536?h[r++]=n:(n-=65536,h[r++]=55296|n>>10&1023,h[r++]=56320|1023&n)}return c(h,r)},t.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+o[e[i]]>t?i:t}},function(e,t){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}])},e.exports=i()})),Ue=Me(Ne),He=Pe((function(e){!function(){function t(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function i(e){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(e)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function r(e,t){e.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+t+";"}function n(e){var t=e.g.offsetWidth,i=t+100;return e.j.style.width=i+"px",e.i.scrollLeft=i,e.h.scrollLeft=e.h.scrollWidth+100,e.l!==t&&(e.l=t,!0)}function s(e,i){function r(){var e=s;n(e)&&null!==e.g.parentNode&&i(e.l)}var s=e;t(e.h,r),t(e.i,r),n(e)}function o(e,t,i){t=t||{},i=i||window,this.family=e,this.style=t.style||"normal",this.weight=t.weight||"normal",this.stretch=t.stretch||"normal",this.context=i}var a=null,c=null,h=null,l=null;function u(e){return null===l&&(l=!!e.document.fonts),l}function f(e,t){var i=e.style,r=e.weight;if(null===h){var n=document.createElement("div");try{n.style.font="condensed 100px sans-serif"}catch(e){}h=""!==n.style.font}return[i,r,h?e.stretch:"","100px",t].join(" ")}o.prototype.load=function(e,t){var n=this,o=e||"BESbswy",h=0,l=t||3e3,d=(new Date).getTime();return new Promise((function(e,t){if(u(n.context)&&!function(e){return null===c&&(u(e)&&/Apple/.test(window.navigator.vendor)?(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),c=!!e&&603>parseInt(e[1],10)):c=!1),c}(n.context)){var p=new Promise((function(e,t){!function i(){(new Date).getTime()-d>=l?t(Error(l+"ms timeout exceeded")):n.context.document.fonts.load(f(n,'"'+n.family+'"'),o).then((function(t){1<=t.length?e():setTimeout(i,25)}),t)}()})),_=new Promise((function(e,t){h=setTimeout((function(){t(Error(l+"ms timeout exceeded"))}),l)}));Promise.race([_,p]).then((function(){clearTimeout(h),e(n)}),t)}else!function(e){document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",(function t(){document.removeEventListener("DOMContentLoaded",t),e()})):document.attachEvent("onreadystatechange",(function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),e())}))}((function(){function c(){var t;(t=-1!=g&&-1!=v||-1!=g&&-1!=y||-1!=v&&-1!=y)&&((t=g!=v&&g!=y&&v!=y)||(null===a&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=a&&(g==m&&v==m&&y==m||g==S&&v==S&&y==S||g==w&&v==w&&y==w)),t=!t),t&&(null!==b.parentNode&&b.parentNode.removeChild(b),clearTimeout(h),e(n))}var u=new i(o),p=new i(o),_=new i(o),g=-1,v=-1,y=-1,m=-1,S=-1,w=-1,b=document.createElement("div");b.dir="ltr",r(u,f(n,"sans-serif")),r(p,f(n,"serif")),r(_,f(n,"monospace")),b.appendChild(u.g),b.appendChild(p.g),b.appendChild(_.g),n.context.document.body.appendChild(b),m=u.g.offsetWidth,S=p.g.offsetWidth,w=_.g.offsetWidth,function e(){if((new Date).getTime()-d>=l)null!==b.parentNode&&b.parentNode.removeChild(b),t(Error(l+"ms timeout exceeded"));else{var i=n.context.document.hidden;!0!==i&&void 0!==i||(g=u.g.offsetWidth,v=p.g.offsetWidth,y=_.g.offsetWidth,c()),h=setTimeout(e,50)}}(),s(u,(function(e){g=e,c()})),r(u,f(n,'"'+n.family+'",sans-serif')),s(p,(function(e){v=e,c()})),r(p,f(n,'"'+n.family+'",serif')),s(_,(function(e){y=e,c()})),r(_,f(n,'"'+n.family+'",monospace'))}))}))},e.exports=o}()})),je=Ue.BFSRequire("path"),ze=Ue.BFSRequire("fs"),$e=Pe((function(e,t){self,e.exports=(()=>{var e={4567:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const r=i(9042),n=i(6114),s=i(9924),o=i(3656),a=i(844),c=i(5596),h=i(9631);class l extends a.Disposable{constructor(e,t){super(),this._terminal=e,this._renderService=t,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let e=0;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new s.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize((e=>this._handleResize(e.rows)))),this.register(this._terminal.onRender((e=>this._refreshRows(e.start,e.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((e=>this._handleChar(e)))),this.register(this._terminal.onLineFeed((()=>this._handleChar("\n")))),this.register(this._terminal.onA11yTab((e=>this._handleTab(e)))),this.register(this._terminal.onKey((e=>this._handleKey(e.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this._screenDprMonitor=new c.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener((()=>this._refreshRowsDimensions())),this.register((0,o.addDisposableDomListener)(window,"resize",(()=>this._refreshRowsDimensions()))),this.register((0,a.toDisposable)((()=>{(0,h.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0})))}_handleBoundaryFocus(e,t){const i=e.target,r=this._rowElements[0===t?1:this._rowElements.length-2];if(i.getAttribute("aria-posinset")===(0===t?"1":`${this._terminal.buffer.lines.length}`))return;if(e.relatedTarget!==r)return;let n,s;if(0===t?(n=i,s=this._rowElements.pop(),this._rowContainer.removeChild(s)):(n=this._rowElements.shift(),s=i,this._rowContainer.removeChild(n)),n.removeEventListener("focus",this._topBoundaryFocusListener),s.removeEventListener("focus",this._bottomBoundaryFocusListener),0===t){const e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{const e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===t?-1:1),this._rowElements[0===t?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=document.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=r.tooMuchOutput)),n.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout((()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)}),0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,n.isMac&&(0,h.removeElementFromParent)(this._liveRegion)}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._renderRowsDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const i=this._terminal.buffer,r=i.lines.length.toString();for(let n=e;n<=t;n++){const e=i.translateBufferLineToString(i.ydisp+n,!0),t=(i.ydisp+n+1).toString(),s=this._rowElements[n];s&&(0===e.length?s.innerText=" ":s.textContent=e,s.setAttribute("aria-posinset",t),s.setAttribute("aria-setsize",r))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}t.AccessibilityManager=l},3614:(e,t)=>{function i(e){return e.replace(/\r?\n/g,"\r")}function r(e,t){return t?"[200~"+e+"[201~":e}function n(e,t,n){e=r(e=i(e),n.decPrivateModes.bracketedPasteMode),n.triggerDataEvent(e,!0),t.value=""}function s(e,t,i){const r=i.getBoundingClientRect(),n=e.clientX-r.left-10,s=e.clientY-r.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${n}px`,t.style.top=`${s}px`,t.style.zIndex="1000",t.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=i,t.bracketTextForPaste=r,t.copyHandler=function(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()},t.handlePasteEvent=function(e,t,i){e.stopPropagation(),e.clipboardData&&n(e.clipboardData.getData("text/plain"),t,i)},t.paste=n,t.moveTextAreaUnderMouseCursor=s,t.rightClickHandler=function(e,t,i,r,n){s(e,t,i),n&&r.rightClickSelect(e),t.value=r.selectionText,t.select()}},7239:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const r=i(1505);t.ColorContrastCache=class{constructor(){this._color=new r.TwoKeyMap,this._css=new r.TwoKeyMap}setCss(e,t,i){this._css.set(e,t,i)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,i){this._color.set(e,t,i)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}}},9631:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeElementFromParent=void 0,t.removeElementFromParent=function(...e){var t;for(const i of e)null===(t=null==i?void 0:i.parentElement)||void 0===t||t.removeChild(i)}},3656:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(e,t,i,r){e.addEventListener(t,i,r);let n=!1;return{dispose:()=>{n||(n=!0,e.removeEventListener(t,i,r))}}}},6465:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier2=void 0;const s=i(2585),o=i(8460),a=i(844),c=i(3656);let h=class extends a.Disposable{constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new o.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new o.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,a.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,a.toDisposable)((()=>{this._lastMouseEvent=void 0})))}get currentLink(){return this._currentLink}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{const t=this._linkProviders.indexOf(e);-1!==t&&this._linkProviders.splice(t,1)}}}attachToDom(e,t,i){this._element=e,this._mouseService=t,this._renderService=i,this.register((0,c.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,c.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;const i=e.composedPath();for(let e=0;e<i.length;e++){const t=i[e];if(t.classList.contains("xterm"))break;if(t.classList.contains("xterm-hover"))return}this._lastBufferCell&&t.x===this._lastBufferCell.x&&t.y===this._lastBufferCell.y||(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y)return this._clearCurrentLink(),void this._askForLink(e,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){var i,r;this._activeProviderReplies&&t||(null===(i=this._activeProviderReplies)||void 0===i||i.forEach((e=>{null==e||e.forEach((e=>{e.link.dispose&&e.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=e.y);let n=!1;for(const[i,s]of this._linkProviders.entries())t?(null===(r=this._activeProviderReplies)||void 0===r?void 0:r.get(i))&&(n=this._checkLinkProviderResult(i,e,n)):s.provideLinks(e.y,(t=>{var r,s;if(this._isMouseOut)return;const o=null==t?void 0:t.map((e=>({link:e})));null===(r=this._activeProviderReplies)||void 0===r||r.set(i,o),n=this._checkLinkProviderResult(i,e,n),(null===(s=this._activeProviderReplies)||void 0===s?void 0:s.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)}))}_removeIntersectingLinks(e,t){const i=new Set;for(let r=0;r<t.size;r++){const n=t.get(r);if(n)for(let t=0;t<n.length;t++){const r=n[t],s=r.link.range.start.y<e?0:r.link.range.start.x,o=r.link.range.end.y>e?this._bufferService.cols:r.link.range.end.x;for(let e=s;e<=o;e++){if(i.has(e)){n.splice(t--,1);break}i.add(e)}}}}_checkLinkProviderResult(e,t,i){var r;if(!this._activeProviderReplies)return i;const n=this._activeProviderReplies.get(e);let s=!1;for(let t=0;t<e;t++)this._activeProviderReplies.has(t)&&!this._activeProviderReplies.get(t)||(s=!0);if(!s&&n){const e=n.find((e=>this._linkAtPosition(e.link,t)));e&&(i=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviders.length&&!i)for(let e=0;e<this._activeProviderReplies.size;e++){const n=null===(r=this._activeProviderReplies.get(e))||void 0===r?void 0:r.find((e=>this._linkAtPosition(e.link,t)));if(n){i=!0,this._handleNewLink(n);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,a.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var e,t;return null===(t=null===(e=this._currentLink)||void 0===e?void 0:e.state)||void 0===t?void 0:t.decorations.pointerCursor},set:e=>{var t,i;(null===(t=this._currentLink)||void 0===t?void 0:t.state)&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&(null===(i=this._element)||void 0===i||i.classList.toggle("xterm-cursor-pointer",e)))}},underline:{get:()=>{var e,t;return null===(t=null===(e=this._currentLink)||void 0===e?void 0:e.state)||void 0===t?void 0:t.decorations.underline},set:t=>{var i,r,n;(null===(i=this._currentLink)||void 0===i?void 0:i.state)&&(null===(n=null===(r=this._currentLink)||void 0===r?void 0:r.state)||void 0===n?void 0:n.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((e=>{const t=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,i=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(t,e.end+1+this._bufferService.buffer.ydisp),i&&this._element){const e=this._positionFromMouseEvent(i,this._element,this._mouseService);e&&this._askForLink(e,!1)}}))))}_linkHover(e,t,i){var r;(null===(r=this._currentLink)||void 0===r?void 0:r.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(i,t.text)}_fireUnderlineEvent(e,t){const i=e.range,r=this._bufferService.buffer.ydisp,n=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-r-1,i.end.x,i.end.y-r-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(n)}_linkLeave(e,t,i){var r;(null===(r=this._currentLink)||void 0===r?void 0:r.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(i,t.text)}_linkAtPosition(e,t){const i=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,n=t.y*this._bufferService.cols+t.x;return i<=n&&n<=r}_positionFromMouseEvent(e,t,i){const r=i.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,i,r,n){return{x1:e,y1:t,x2:i,y2:r,cols:this._bufferService.cols,fg:n}}};h=r([n(0,s.IBufferService)],h),t.Linkifier2=h},9042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const s=i(511),o=i(2585);let a=class{constructor(e,t,i){this._bufferService=e,this._optionsService=t,this._oscLinkService=i}provideLinks(e,t){var i;const r=this._bufferService.buffer.lines.get(e-1);if(!r)return void t(void 0);const n=[],o=this._optionsService.rawOptions.linkHandler,a=new s.CellData,h=r.getTrimmedLength();let l=-1,u=-1,f=!1;for(let t=0;t<h;t++)if(-1!==u||r.hasContent(t)){if(r.loadCell(t,a),a.hasExtendedAttrs()&&a.extended.urlId){if(-1===u){u=t,l=a.extended.urlId;continue}f=a.extended.urlId!==l}else-1!==u&&(f=!0);if(f||-1!==u&&t===h-1){const r=null===(i=this._oscLinkService.getLinkData(l))||void 0===i?void 0:i.uri;if(r){const i={start:{x:u+1,y:e},end:{x:t+(f||t!==h-1?0:1),y:e}};let s=!1;if(!(null==o?void 0:o.allowNonHttpProtocols))try{const e=new URL(r);["http:","https:"].includes(e.protocol)||(s=!0)}catch(e){s=!0}s||n.push({text:r,range:i,activate:(e,t)=>o?o.activate(e,t,i):c(0,t),hover:(e,t)=>{var r;return null===(r=null==o?void 0:o.hover)||void 0===r?void 0:r.call(o,e,t,i)},leave:(e,t)=>{var r;return null===(r=null==o?void 0:o.leave)||void 0===r?void 0:r.call(o,e,t,i)}})}f=!1,a.hasExtendedAttrs()&&a.extended.urlId?(u=t,l=a.extended.urlId):(u=-1,l=-1)}}t(n)}};function c(e,t){if(confirm(`Do you want to navigate to ${t}?\n\nWARNING: This link could potentially be dangerous`)){const i=window.open();if(i){try{i.opener=null}catch(e){}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}a=r([n(0,o.IBufferService),n(1,o.IOptionsService),n(2,o.IOscLinkService)],a),t.OscLinkProvider=a},6193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(e,t){this._parentWindow=e,this._renderCallback=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}}},5596:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenDprMonitor=void 0;const r=i(844);class n extends r.Disposable{constructor(e){super(),this._parentWindow=e,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,r.toDisposable)((()=>{this.clearListener()})))}setListener(e){this._listener&&this.clearListener(),this._listener=e,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var e;this._outerListener&&(null===(e=this._resolutionMediaMatchList)||void 0===e||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}t.ScreenDprMonitor=n},3236:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const r=i(2950),n=i(1680),s=i(3614),o=i(2584),a=i(5435),c=i(9312),h=i(6114),l=i(3656),u=i(9042),f=i(4567),d=i(1296),p=i(7399),_=i(8460),g=i(8437),v=i(3230),y=i(4725),m=i(428),S=i(8934),w=i(6465),b=i(5114),E=i(8969),C=i(8055),k=i(4269),L=i(5941),R=i(3107),D=i(5744),x=i(9074),A=i(2585),T=i(3730),I=i(844),O=i(6731),B="undefined"!=typeof window?window.document:null;class F extends E.CoreTerminal{constructor(e={}){super(e),this.browser=h,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new _.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new _.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new _.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new _.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new _.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new _.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new _.EventEmitter),this._onBlur=this.register(new _.EventEmitter),this._onA11yCharEmitter=this.register(new _.EventEmitter),this._onA11yTabEmitter=this.register(new _.EventEmitter),this._onWillOpen=this.register(new _.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(w.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(T.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(x.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((e,t)=>this.refresh(e,t)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((e=>this._reportWindowsOptions(e)))),this.register(this._inputHandler.onColor((e=>this._handleColorEvent(e)))),this.register((0,_.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,_.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,_.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,_.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((e=>this._afterResize(e.cols,e.rows)))),this.register((0,I.toDisposable)((()=>{var e,t;this._customKeyEventHandler=void 0,null===(t=null===(e=this.element)||void 0===e?void 0:e.parentNode)||void 0===t||t.removeChild(this.element)})))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(const t of e){let e,i="";switch(t.index){case 256:e="foreground",i="10";break;case 257:e="background",i="11";break;case 258:e="cursor",i="12";break;default:e="ansi",i="4;"+t.index}switch(t.type){case 0:const r=C.color.toColorRGB("ansi"===e?this._themeService.colors.ansi[t.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${o.C0.ESC}]${i};${(0,L.toRgbString)(r)}${o.C1_ESCAPED.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors((e=>e.ansi[t.index]=C.rgba.toColor(...t.color)));else{const i=e;this._themeService.modifyColors((e=>e[i]=C.rgba.toColor(...t.color)))}break;case 2:this._themeService.restoreColor(t.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){var t;e?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new f.AccessibilityManager(this,this._renderService)):(null===(t=this._accessibilityManager)||void 0===t||t.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(o.C0.ESC+"[I"),this.updateCursorStyle(e),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var e;return null===(e=this.textarea)||void 0===e?void 0:e.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(o.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;const i=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,n=t.getWidth(i),s=this._renderService.dimensions.css.cell.width*n,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=i*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=s+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,l.addDisposableDomListener)(this.element,"copy",(e=>{this.hasSelection()&&(0,s.copyHandler)(e,this._selectionService)})));const e=e=>(0,s.handlePasteEvent)(e,this.textarea,this.coreService);this.register((0,l.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,l.addDisposableDomListener)(this.element,"paste",e)),h.isFirefox?this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(e=>{2===e.button&&(0,s.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,l.addDisposableDomListener)(this.element,"contextmenu",(e=>{(0,s.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),h.isLinux&&this.register((0,l.addDisposableDomListener)(this.element,"auxclick",(e=>{1===e.button&&(0,s.moveTextAreaUnderMouseCursor)(e,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,l.addDisposableDomListener)(this.textarea,"keyup",(e=>this._keyUp(e)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keydown",(e=>this._keyDown(e)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keypress",(e=>this._keyPress(e)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionupdate",(e=>this._compositionHelper.compositionupdate(e)))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,l.addDisposableDomListener)(this.textarea,"input",(e=>this._inputEvent(e)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(e){var t;if(!e)throw new Error("Terminal requires a parent element.");e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=e.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),e.appendChild(this.element);const i=B.createDocumentFragment();this._viewportElement=B.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),i.appendChild(this._viewportElement),this._viewportScrollArea=B.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=B.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=B.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),i.appendChild(this.screenElement),this.textarea=B.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",u.promptLabel),h.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(b.CoreBrowserService,this.textarea,null!==(t=this._document.defaultView)&&void 0!==t?t:window),this._instantiationService.setService(y.ICoreBrowserService,this._coreBrowserService),this.register((0,l.addDisposableDomListener)(this.textarea,"focus",(e=>this._handleTextAreaFocus(e)))),this.register((0,l.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(m.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(y.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(O.ThemeService),this._instantiationService.setService(y.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(k.CharacterJoinerService),this._instantiationService.setService(y.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(v.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(y.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((e=>this._onRender.fire(e)))),this.onResize((e=>this._renderService.resize(e.cols,e.rows))),this._compositionView=B.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(i);try{this._onWillOpen.fire(this.element)}catch(e){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(S.MouseService),this._instantiationService.setService(y.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(n.Viewport,(e=>this.scrollLines(e,!0,1)),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(c.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(y.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((e=>this.scrollLines(e.amount,e.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((e=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,l.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(R.BufferDecorationRenderer,this.screenElement)),this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(e=>this._selectionService.handleMouseDown(e)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new f.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(e=>this._handleScreenReaderModeOptionChange(e)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(D.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(D.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(d.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const e=this,t=this.element;function i(t){const i=e._mouseService.getMouseReportCoords(t,e.screenElement);if(!i)return!1;let r,n;switch(t.overrideType||t.type){case"mousemove":n=32,void 0===t.buttons?(r=3,void 0!==t.button&&(r=t.button<3?t.button:3)):r=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":n=0,r=t.button<3?t.button:3;break;case"mousedown":n=1,r=t.button<3?t.button:3;break;case"wheel":if(0===e.viewport.getLinesScrolled(t))return!1;n=t.deltaY<0?0:1,r=4;break;default:return!1}return!(void 0===n||void 0===r||r>4)&&e.coreMouseService.triggerMouseEvent({col:i.col,row:i.row,x:i.x,y:i.y,button:r,action:n,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}const r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},n={mouseup:e=>(i(e),e.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(e)),wheel:e=>(i(e),this.cancel(e,!0)),mousedrag:e=>{e.buttons&&i(e)},mousemove:e=>{e.buttons||i(e)}};this.register(this.coreMouseService.onProtocolChange((e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?r.mousemove||(t.addEventListener("mousemove",n.mousemove),r.mousemove=n.mousemove):(t.removeEventListener("mousemove",r.mousemove),r.mousemove=null),16&e?r.wheel||(t.addEventListener("wheel",n.wheel,{passive:!1}),r.wheel=n.wheel):(t.removeEventListener("wheel",r.wheel),r.wheel=null),2&e?r.mouseup||(r.mouseup=n.mouseup):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),4&e?r.mousedrag||(r.mousedrag=n.mousedrag):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,l.addDisposableDomListener)(t,"mousedown",(e=>{if(e.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(e))return i(e),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(e)}))),this.register((0,l.addDisposableDomListener)(t,"wheel",(e=>{if(!r.wheel){if(!this.buffer.hasScrollback){const t=this.viewport.getLinesScrolled(e);if(0===t)return;const i=o.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B");let r="";for(let e=0;e<Math.abs(t);e++)r+=i;return this.coreService.triggerDataEvent(r,!0),this.cancel(e,!0)}return this.viewport.handleWheel(e)?this.cancel(e):void 0}}),{passive:!1})),this.register((0,l.addDisposableDomListener)(t,"touchstart",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(e),this.cancel(e)}),{passive:!0})),this.register((0,l.addDisposableDomListener)(t,"touchmove",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(e)?void 0:this.cancel(e)}),{passive:!1}))}refresh(e,t){var i;null===(i=this._renderService)||void 0===i||i.refreshRows(e,t)}updateCursorStyle(e){var t;(null===(t=this._selectionService)||void 0===t?void 0:t.shouldColumnSelect(e))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t,i=0){super.scrollLines(e,t,i),this.refresh(0,this.rows-1)}paste(e){(0,s.paste)(e,this.textarea,this.coreService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}registerLinkProvider(e){return this.linkifier2.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,t,i){this._selectionService.setSelection(e,t,i)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var e;null===(e=this._selectionService)||void 0===e||e.clearSelection()}selectAll(){var e;null===(e=this._selectionService)||void 0===e||e.selectAll()}selectLines(e,t){var i;null===(i=this._selectionService)||void 0===i||i.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;const t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;t||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);const i=(0,p.evaluateKeyboardEvent)(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===i.type||2===i.type){const t=this.rows-1;return this.scrollLines(2===i.type?-t:t),this.cancel(e,!0)}return 1===i.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,e)||(i.cancel&&this.cancel(e,!0),!i.key||!!(e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(i.key!==o.C0.ETX&&i.key!==o.C0.CR||(this.textarea.value=""),this._onKey.fire({key:i.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey?this.cancel(e,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(e,t){const i=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return"keypress"===t.type?i:i&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(function(e){return 16===e.keyCode||17===e.keyCode||18===e.keyCode}(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(null===e.which||void 0===e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!(!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)||(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){e!==this.cols||t!==this.rows?super.resize(e,t):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(e,t){var i,r;null===(i=this._charSizeService)||void 0===i||i.measure(),null===(r=this.viewport)||void 0===r||r.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(g.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var e,t;this.options.rows=this.rows,this.options.cols=this.cols;const i=this._customKeyEventHandler;this._setup(),super.reset(),null===(e=this._selectionService)||void 0===e||e.reset(),this._decorationService.reset(),this._customKeyEventHandler=i,this.refresh(0,this.rows-1),null===(t=this.viewport)||void 0===t||t.syncScrollArea()}clearTextureAtlas(){var e;null===(e=this._renderService)||void 0===e||e.clearTextureAtlas()}_reportFocus(){var e;(null===(e=this.element)||void 0===e?void 0:e.classList.contains("focus"))?this.coreService.triggerDataEvent(o.C0.ESC+"[I"):this.coreService.triggerDataEvent(o.C0.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case a.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const e=this._renderService.dimensions.css.canvas.width.toFixed(0),t=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${o.C0.ESC}[4;${t};${e}t`);break;case a.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const i=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${o.C0.ESC}[6;${r};${i}t`)}}cancel(e,t){if(this.options.cancelEvents||t)return e.preventDefault(),e.stopPropagation(),!1}}t.Terminal=F},9924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(e,t=1e3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t;const r=Date.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){const e=r-this._lastRefreshMs,t=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),t)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}}},1680:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const s=i(844),o=i(3656),a=i(4725),c=i(2585);let h=class extends s.Disposable{constructor(e,t,i,r,n,s,a,c,h){super(),this._scrollLines=e,this._viewportElement=t,this._scrollArea=i,this._bufferService=r,this._optionsService=n,this._charSizeService=s,this._renderService=a,this._coreBrowserService=c,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((e=>this._renderDimensions=e))),this._handleThemeChange(h.colors),this.register(h.onChangeColors((e=>this._handleThemeChange(e)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()),0)}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}_refresh(e){if(e)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(t)}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,t){const i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&0!==this._viewportElement.scrollTop||t>0&&i<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const t=this._getPixelsScrolled(e);return 0!==t&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}_getPixelsScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getLinesScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(e,t){const i=this._optionsService.rawOptions.fastScrollModifier;return"alt"===i&&t.altKey||"ctrl"===i&&t.ctrlKey||"shift"===i&&t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const t=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,0!==t&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}};h=r([n(3,c.IBufferService),n(4,c.IOptionsService),n(5,a.ICharSizeService),n(6,a.IRenderService),n(7,a.ICoreBrowserService),n(8,a.IThemeService)],h),t.Viewport=h},3107:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const s=i(3656),o=i(4725),a=i(844),c=i(2585);let h=class extends a.Disposable{constructor(e,t,i,r){super(),this._screenElement=e,this._bufferService=t,this._decorationService=i,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register((0,s.addDisposableDomListener)(window,"resize",(()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((e=>this._removeDecoration(e)))),this.register((0,a.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var t;const i=document.createElement("div");i.classList.add("xterm-decoration"),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const r=null!==(t=e.options.x)&&void 0!==t?t:0;return r&&r>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){const t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i)),i.style.top=t*this._renderService.dimensions.css.cell.height+"px",i.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(i)}}_refreshXPosition(e,t=e.element){var i;if(!t)return;const r=null!==(i=e.options.x)&&void 0!==i?i:0;"right"===(e.options.anchor||"left")?t.style.right=r?r*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=r?r*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var t;null===(t=this._decorationElements.get(e))||void 0===t||t.remove(),this._decorationElements.delete(e),e.dispose()}};h=r([n(1,c.IBufferService),n(2,c.IDecorationService),n(3,o.IRenderService)],h),t.BufferDecorationRenderer=h},5871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(const t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(t,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,i){return t>=e.startBufferLine-this._linePadding[i||"full"]&&t<=e.endBufferLine+this._linePadding[i||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}}},5744:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const s=i(5871),o=i(3656),a=i(4725),c=i(844),h=i(2585),l={full:0,left:0,center:0,right:0},u={full:0,left:0,center:0,right:0},f={full:0,left:0,center:0,right:0};let d=class extends c.Disposable{constructor(e,t,i,r,n,o,a){var h;super(),this._viewportElement=e,this._screenElement=t,this._bufferService=i,this._decorationService=r,this._renderService=n,this._optionsService=o,this._coreBrowseService=a,this._colorZoneStore=new s.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),null===(h=this._viewportElement.parentElement)||void 0===h||h.insertBefore(this._canvas,this._viewportElement);const l=this._canvas.getContext("2d");if(!l)throw new Error("Ctx cannot be null");this._ctx=l,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,c.toDisposable)((()=>{var e;null===(e=this._canvas)||void 0===e||e.remove()})))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register((0,o.addDisposableDomListener)(this._coreBrowseService.window,"resize",(()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const e=Math.floor(this._canvas.width/3),t=Math.ceil(this._canvas.width/3);u.full=this._canvas.width,u.left=e,u.center=t,u.right=e,this._refreshDrawHeightConstants(),f.full=0,f.left=0,f.center=u.left,f.right=u.left+u.center}_refreshDrawHeightConstants(){l.full=Math.round(2*this._coreBrowseService.dpr);const e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowseService.dpr);l.left=t,l.center=t,l.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const e of this._decorationService.decorations)this._colorZoneStore.addDecoration(e);this._ctx.lineWidth=1;const e=this._colorZoneStore.zones;for(const t of e)"full"!==t.position&&this._renderColorZone(t);for(const t of e)"full"===t.position&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(f[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-l[e.position||"full"]/2),u[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+l[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};d=r([n(2,h.IBufferService),n(3,h.IDecorationService),n(4,a.IRenderService),n(5,h.IOptionsService),n(6,a.ICoreBrowserService)],d),t.OverviewRulerRenderer=d},2950:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const s=i(4725),o=i(2585),a=i(2584);let c=class{constructor(e,t,i,r,n,s){this._textarea=e,this._compositionView=t,this._bufferService=i,this._optionsService=r,this._coreService=n,this._renderService=s,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(229===e.keyCode)return!1;if(16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let t;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,t=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),t.length>0&&this._coreService.triggerDataEvent(t,!0)}}),0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const e=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const t=this._textarea.value,i=t.replace(e,"");this._dataAlreadySent=i,t.length>e.length?this._coreService.triggerDataEvent(i,!0):t.length<e.length?this._coreService.triggerDataEvent(`${a.C0.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}}),0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),t=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=t+"px",this._compositionView.style.lineHeight=t+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const n=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};c=r([n(2,o.IBufferService),n(3,o.IOptionsService),n(4,o.ICoreService),n(5,s.IRenderService)],c),t.CompositionHelper=c},9806:(e,t)=>{function i(e,t,i){const r=i.getBoundingClientRect(),n=e.getComputedStyle(i),s=parseInt(n.getPropertyValue("padding-left")),o=parseInt(n.getPropertyValue("padding-top"));return[t.clientX-r.left-s,t.clientY-r.top-o]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=i,t.getCoords=function(e,t,r,n,s,o,a,c,h){if(!o)return;const l=i(e,t,r);return l?(l[0]=Math.ceil((l[0]+(h?a/2:0))/a),l[1]=Math.ceil(l[1]/c),l[0]=Math.min(Math.max(l[0],1),n+(h?1:0)),l[1]=Math.min(Math.max(l[1],1),s),l):void 0}},9504:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const r=i(2584);function n(e,t,i,r){const n=e-s(e,i),a=t-s(t,i),l=Math.abs(n-a)-function(e,t,i){let r=0;const n=e-s(e,i),a=t-s(t,i);for(let s=0;s<Math.abs(n-a);s++){const a="A"===o(e,t)?-1:1,c=i.buffer.lines.get(n+a*s);(null==c?void 0:c.isWrapped)&&r++}return r}(e,t,i);return h(l,c(o(e,t),r))}function s(e,t){let i=0,r=t.buffer.lines.get(e),n=null==r?void 0:r.isWrapped;for(;n&&e>=0&&e<t.rows;)i++,r=t.buffer.lines.get(--e),n=null==r?void 0:r.isWrapped;return i}function o(e,t){return e>t?"A":"B"}function a(e,t,i,r,n,s){let o=e,a=t,c="";for(;o!==i||a!==r;)o+=n?1:-1,n&&o>s.cols-1?(c+=s.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!n&&o<0&&(c+=s.buffer.translateBufferLineToString(a,!1,0,e+1),o=s.cols-1,e=o,a--);return c+s.buffer.translateBufferLineToString(a,!1,e,o)}function c(e,t){const i=t?"O":"[";return r.C0.ESC+i+e}function h(e,t){e=Math.floor(e);let i="";for(let r=0;r<e;r++)i+=t;return i}t.moveToCellSequence=function(e,t,i,r){const o=i.buffer.x,l=i.buffer.y;if(!i.buffer.hasScrollback)return function(e,t,i,r,o,l){return 0===n(t,r,o,l).length?"":h(a(e,t,e,t-s(t,o),!1,o).length,c("D",l))}(o,l,0,t,i,r)+n(l,t,i,r)+function(e,t,i,r,o,l){let u;u=n(t,r,o,l).length>0?r-s(r,o):t;const f=r,d=function(e,t,i,r,o,a){let c;return c=n(i,r,o,a).length>0?r-s(r,o):t,e<i&&c<=r||e>=i&&c<r?"C":"D"}(e,t,i,r,o,l);return h(a(e,u,i,f,"C"===d,o).length,c(d,l))}(o,l,e,t,i,r);let u;if(l===t)return u=o>e?"D":"C",h(Math.abs(o-e),c(u,r));u=l>t?"D":"C";const f=Math.abs(l-t);return h(function(e,t){return t.cols-e}(l>t?e:o,i)+(f-1)*i.cols+1+((l>t?o:e)-1),c(u,r))}},1296:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const s=i(9631),o=i(3787),a=i(2223),c=i(6171),h=i(4725),l=i(8055),u=i(8460),f=i(844),d=i(2585),p="xterm-dom-renderer-owner-",_="xterm-focus";let g=1,v=class extends f.Disposable{constructor(e,t,i,r,n,a,h,l,d,_){super(),this._element=e,this._screenElement=t,this._viewportElement=i,this._linkifier2=r,this._charSizeService=a,this._optionsService=h,this._bufferService=l,this._coreBrowserService=d,this._terminalClass=g++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new u.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,c.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(_.onChangeColors((e=>this._injectCss(e)))),this._injectCss(_.colors),this._rowFactory=n.createInstance(o.DomRendererRowFactory,document),this._element.classList.add(p+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((e=>this._handleLinkHover(e)))),this.register(this._linkifier2.onHideLinkUnderline((e=>this._handleLinkLeave(e)))),this.register((0,f.toDisposable)((()=>{this._element.classList.remove(p+this._terminalClass),(0,s.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)})))}_updateDimensions(){const e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const e of this._rowElements)e.style.width=`${this.dimensions.css.canvas.width}px`,e.style.height=`${this.dimensions.css.cell.height}px`,e.style.lineHeight=`${this.dimensions.css.cell.height}px`,e.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const t=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .xterm-rows { color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;t+=`${this._terminalSelector} span:not(.${o.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${o.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${o.ITALIC_CLASS} { font-style: italic;}`,t+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",t+="@keyframes blink_block_"+this._terminalClass+" { 0% {"+`  background-color: ${e.cursor.css};`+`  color: ${e.cursorAccent.css}; } 50% {`+`  background-color: ${e.cursorAccent.css};`+`  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${o.CURSOR_CLASS}.${o.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${o.CURSOR_CLASS}.${o.CURSOR_BLINK_CLASS}:not(.${o.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${o.CURSOR_CLASS}.${o.CURSOR_BLINK_CLASS}.${o.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${o.CURSOR_CLASS}.${o.CURSOR_STYLE_BLOCK_CLASS} {`+` background-color: ${e.cursor.css};`+` color: ${e.cursorAccent.css};}`+`${this._terminalSelector} .xterm-rows .${o.CURSOR_CLASS}.${o.CURSOR_STYLE_BAR_CLASS} {`+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}`+`${this._terminalSelector} .xterm-rows .${o.CURSOR_CLASS}.${o.CURSOR_STYLE_UNDERLINE_CLASS} {`+` box-shadow: 0 -1px 0 ${e.cursor.css} inset;}`,t+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(const[i,r]of e.ansi.entries())t+=`${this._terminalSelector} .xterm-fg-${i} { color: ${r.css}; }${this._terminalSelector} .xterm-bg-${i} { background-color: ${r.css}; }`;t+=`${this._terminalSelector} .xterm-fg-${a.INVERTED_DEFAULT_COLOR} { color: ${l.color.opaque(e.background).css}; }${this._terminalSelector} .xterm-bg-${a.INVERTED_DEFAULT_COLOR} { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(e,t){for(let e=this._rowElements.length;e<=t;e++){const e=document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(_)}handleFocus(){this._rowContainer.classList.add(_)}handleSelectionChanged(e,t,i){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(e,t,i),this.renderRows(0,this._bufferService.rows-1),!e||!t)return;const r=e[1]-this._bufferService.buffer.ydisp,n=t[1]-this._bufferService.buffer.ydisp,s=Math.max(r,0),o=Math.min(n,this._bufferService.rows-1);if(s>=this._bufferService.rows||o<0)return;const a=document.createDocumentFragment();if(i){const i=e[0]>t[0];a.appendChild(this._createSelectionElement(s,i?t[0]:e[0],i?e[0]:t[0],o-s+1))}else{const i=r===s?e[0]:0,c=s===n?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(s,i,c));const h=o-s-1;if(a.appendChild(this._createSelectionElement(s+1,0,this._bufferService.cols,h)),s!==o){const e=n===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,e))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,i,r=1){const n=document.createElement("div");return n.style.height=r*this.dimensions.css.cell.height+"px",n.style.top=e*this.dimensions.css.cell.height+"px",n.style.left=t*this.dimensions.css.cell.width+"px",n.style.width=this.dimensions.css.cell.width*(i-t)+"px",n}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(const e of this._rowElements)e.replaceChildren()}renderRows(e,t){const i=this._bufferService.buffer.ybase+this._bufferService.buffer.y,r=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),n=this._optionsService.rawOptions.cursorBlink;for(let s=e;s<=t;s++){const e=this._rowElements[s],t=s+this._bufferService.buffer.ydisp,o=this._bufferService.buffer.lines.get(t),a=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[s]&&this._cellToRowElements[s].length===this._bufferService.cols||(this._cellToRowElements[s]=new Int16Array(this._bufferService.cols)),e.replaceChildren(this._rowFactory.createRow(o,t,t===i,a,r,n,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[s]))}}get _terminalSelector(){return`.${p}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,i,r,n,s){if(e=this._cellToRowElements[i][e],t=this._cellToRowElements[r][t],-1!==e&&-1!==t)for(;e!==t||i!==r;){const t=this._rowElements[i];if(!t)return;const r=t.children[e];r&&(r.style.textDecoration=s?"underline":"none"),++e>=n&&(e=0,i++)}}};v=r([n(4,d.IInstantiationService),n(5,h.ICharSizeService),n(6,d.IOptionsService),n(7,d.IBufferService),n(8,h.ICoreBrowserService),n(9,h.IThemeService)],v),t.DomRenderer=v},3787:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=t.CURSOR_STYLE_UNDERLINE_CLASS=t.CURSOR_STYLE_BAR_CLASS=t.CURSOR_STYLE_BLOCK_CLASS=t.CURSOR_BLINK_CLASS=t.CURSOR_CLASS=t.STRIKETHROUGH_CLASS=t.UNDERLINE_CLASS=t.ITALIC_CLASS=t.DIM_CLASS=t.BOLD_CLASS=void 0;const s=i(2223),o=i(643),a=i(511),c=i(2585),h=i(8055),l=i(4725),u=i(4269),f=i(6171),d=i(3734);t.BOLD_CLASS="xterm-bold",t.DIM_CLASS="xterm-dim",t.ITALIC_CLASS="xterm-italic",t.UNDERLINE_CLASS="xterm-underline",t.STRIKETHROUGH_CLASS="xterm-strikethrough",t.CURSOR_CLASS="xterm-cursor",t.CURSOR_BLINK_CLASS="xterm-cursor-blink",t.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",t.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",t.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let p=class{constructor(e,t,i,r,n,s,o){this._document=e,this._characterJoinerService=t,this._optionsService=i,this._coreBrowserService=r,this._coreService=n,this._decorationService=s,this._themeService=o,this._workCell=new a.CellData,this._columnSelectMode=!1}handleSelectionChanged(e,t,i){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=i}createRow(e,i,r,n,a,c,l,f,p){const g=this._document.createDocumentFragment(),v=this._characterJoinerService.getJoinedCharacters(i);let y=0;for(let t=Math.min(e.length,f)-1;t>=0;t--)if(e.loadCell(t,this._workCell).getCode()!==o.NULL_CELL_CODE||r&&t===a){y=t+1;break}const m=this._themeService.colors;let S=-1,w=0;for(;w<y;w++){e.loadCell(w,this._workCell);let f=this._workCell.getWidth();if(0===f){p[w]=S;continue}let y=!1,b=w,E=this._workCell;if(v.length>0&&w===v[0][0]){y=!0;const t=v.shift();E=new u.JoinedCellData(this._workCell,e.translateToString(!0,t[0],t[1]),t[1]-t[0]),b=t[1]-1,f=E.getWidth()}const C=this._document.createElement("span");if(f>1&&(C.style.width=l*f+"px"),y&&(C.style.display="inline",a>=w&&a<=b&&(a=w)),!this._coreService.isCursorHidden&&r&&w===a)switch(C.classList.add(t.CURSOR_CLASS),c&&C.classList.add(t.CURSOR_BLINK_CLASS),n){case"bar":C.classList.add(t.CURSOR_STYLE_BAR_CLASS);break;case"underline":C.classList.add(t.CURSOR_STYLE_UNDERLINE_CLASS);break;default:C.classList.add(t.CURSOR_STYLE_BLOCK_CLASS)}if(E.isBold()&&C.classList.add(t.BOLD_CLASS),E.isItalic()&&C.classList.add(t.ITALIC_CLASS),E.isDim()&&C.classList.add(t.DIM_CLASS),E.isInvisible()?C.textContent=o.WHITESPACE_CELL_CHAR:C.textContent=E.getChars()||o.WHITESPACE_CELL_CHAR,E.isUnderline()&&(C.classList.add(`${t.UNDERLINE_CLASS}-${E.extended.underlineStyle}`)," "===C.textContent&&(C.textContent=" "),!E.isUnderlineColorDefault()))if(E.isUnderlineColorRGB())C.style.textDecorationColor=`rgb(${d.AttributeData.toColorRGB(E.getUnderlineColor()).join(",")})`;else{let e=E.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&E.isBold()&&e<8&&(e+=8),C.style.textDecorationColor=m.ansi[e].css}E.isStrikethrough()&&C.classList.add(t.STRIKETHROUGH_CLASS);let k=E.getFgColor(),L=E.getFgColorMode(),R=E.getBgColor(),D=E.getBgColorMode();const x=!!E.isInverse();if(x){const e=k;k=R,R=e;const t=L;L=D,D=t}let A,T,I=!1;this._decorationService.forEachDecorationAtCell(w,i,void 0,(e=>{"top"!==e.options.layer&&I||(e.backgroundColorRGB&&(D=50331648,R=e.backgroundColorRGB.rgba>>8&16777215,A=e.backgroundColorRGB),e.foregroundColorRGB&&(L=50331648,k=e.foregroundColorRGB.rgba>>8&16777215,T=e.foregroundColorRGB),I="top"===e.options.layer)}));const O=this._isCellInSelection(w,i);let B;switch(I||m.selectionForeground&&O&&(L=50331648,k=m.selectionForeground.rgba>>8&16777215,T=m.selectionForeground),O&&(A=this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque,I=!0),I&&C.classList.add("xterm-decoration-top"),D){case 16777216:case 33554432:B=m.ansi[R],C.classList.add(`xterm-bg-${R}`);break;case 50331648:B=h.rgba.toColor(R>>16,R>>8&255,255&R),this._addStyle(C,`background-color:#${_((R>>>0).toString(16),"0",6)}`);break;default:x?(B=m.foreground,C.classList.add(`xterm-bg-${s.INVERTED_DEFAULT_COLOR}`)):B=m.background}switch(A||E.isDim()&&(A=h.color.multiplyOpacity(B,.5)),L){case 16777216:case 33554432:E.isBold()&&k<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(k+=8),this._applyMinimumContrast(C,B,m.ansi[k],E,A,void 0)||C.classList.add(`xterm-fg-${k}`);break;case 50331648:const e=h.rgba.toColor(k>>16&255,k>>8&255,255&k);this._applyMinimumContrast(C,B,e,E,A,T)||this._addStyle(C,`color:#${_(k.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(C,B,m.foreground,E,A,void 0)||x&&C.classList.add(`xterm-fg-${s.INVERTED_DEFAULT_COLOR}`)}g.appendChild(C),p[w]=++S,w=b}return w<f-1&&p.subarray(w).fill(++S),g}_applyMinimumContrast(e,t,i,r,n,s){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,f.excludeFromContrastRatioDemands)(r.getCode()))return!1;let o;return n||s||(o=this._themeService.colors.contrastCache.getColor(t.rgba,i.rgba)),void 0===o&&(o=h.color.ensureContrastRatio(n||t,s||i,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((n||t).rgba,(s||i).rgba,null!=o?o:null)),!!o&&(this._addStyle(e,`color:${o.css}`),!0)}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){const i=this._selectionStart,r=this._selectionEnd;return!(!i||!r)&&(this._columnSelectMode?i[0]<=r[0]?e>=i[0]&&t>=i[1]&&e<r[0]&&t<=r[1]:e<i[0]&&t>=i[1]&&e>=r[0]&&t<=r[1]:t>i[1]&&t<r[1]||i[1]===r[1]&&t===i[1]&&e>=i[0]&&e<r[0]||i[1]<r[1]&&t===r[1]&&e<r[0]||i[1]<r[1]&&t===i[1]&&e>=i[0])}};function _(e,t,i){for(;e.length<i;)e=t+e;return e}p=r([n(1,l.ICharacterJoinerService),n(2,c.IOptionsService),n(3,l.ICoreBrowserService),n(4,c.ICoreService),n(5,c.IDecorationService),n(6,l.IThemeService)],p),t.DomRendererRowFactory=p},2223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const r=i(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=r.isFirefox||r.isLegacyEdge?"bottom":"ideographic"},6171:(e,t)=>{function i(e){return 57508<=e&&e<=57558}Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderDimensions=t.excludeFromContrastRatioDemands=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(e){if(!e)throw new Error("value must not be falsy");return e},t.isPowerlineGlyph=i,t.isRestrictedPowerlineGlyph=function(e){return 57520<=e&&e<=57527},t.excludeFromContrastRatioDemands=function(e){return i(e)||function(e){return 9472<=e&&e<=9631}(e)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const e=this.selectionStart,t=this.selectionEnd;return!(!e||!t)&&(e[1]>t[1]||e[1]===t[1]&&e[0]>t[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const s=i(2585),o=i(8460),a=i(844);let c=class extends a.Disposable{constructor(e,t,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this.register(new o.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new h(e,t,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}get hasValidSize(){return this.width>0&&this.height>0}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};c=r([n(2,s.IOptionsService)],c),t.CharSizeService=c;class h{constructor(e,t,i){this._document=e,this._parentElement=t,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const e=this._measureElement.getBoundingClientRect();return 0!==e.width&&0!==e.height&&(this._result.width=e.width,this._result.height=Math.ceil(e.height)),this._result}}},4269:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const s=i(3734),o=i(643),a=i(511),c=i(2585);class h extends s.AttributeData{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=h;let l=class e{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new a.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||0===t.length)return[];const i=[],r=t.translateToString(!0);let n=0,s=0,a=0,c=t.getFg(0),h=t.getBg(0);for(let e=0;e<t.getTrimmedLength();e++)if(t.loadCell(e,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==c||this._workCell.bg!==h){if(e-n>1){const e=this._getJoinedRanges(r,a,s,t,n);for(let t=0;t<e.length;t++)i.push(e[t])}n=e,a=s,c=this._workCell.fg,h=this._workCell.bg}s+=this._workCell.getChars().length||o.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-n>1){const e=this._getJoinedRanges(r,a,s,t,n);for(let t=0;t<e.length;t++)i.push(e[t])}return i}_getJoinedRanges(t,i,r,n,s){const o=t.substring(i,r);let a=[];try{a=this._characterJoiners[0].handler(o)}catch(e){console.error(e)}for(let t=1;t<this._characterJoiners.length;t++)try{const i=this._characterJoiners[t].handler(o);for(let t=0;t<i.length;t++)e._mergeRanges(a,i[t])}catch(e){console.error(e)}return this._stringRangesToCellRanges(a,n,s),a}_stringRangesToCellRanges(e,t,i){let r=0,n=!1,s=0,a=e[r];if(a){for(let c=i;c<this._bufferService.cols;c++){const i=t.getWidth(c),h=t.getString(c).length||o.WHITESPACE_CELL_CHAR.length;if(0!==i){if(!n&&a[0]<=s&&(a[0]=c,n=!0),a[1]<=s){if(a[1]=c,a=e[++r],!a)break;a[0]<=s?(a[0]=c,n=!0):n=!1}s+=h}}a&&(a[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let i=!1;for(let r=0;r<e.length;r++){const n=e[r];if(i){if(t[1]<=n[0])return e[r-1][1]=t[1],e;if(t[1]<=n[1])return e[r-1][1]=Math.max(t[1],n[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(t[1]<=n[0])return e.splice(r,0,t),e;if(t[1]<=n[1])return n[0]=Math.min(t[0],n[0]),e;t[0]<n[1]&&(n[0]=Math.min(t[0],n[0]),i=!0)}}return i?e[e.length-1][1]=t[1]:e.push(t),e}};l=r([n(0,c.IBufferService)],l),t.CharacterJoinerService=l},5114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0,t.CoreBrowserService=class{constructor(e,t){this._textarea=e,this.window=t,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}},8934:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const s=i(4725),o=i(9806);let a=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,i,r,n){return(0,o.getCoords)(window,e,t,i,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,n)}getMouseReportCoords(e,t){const i=(0,o.getCoordsRelativeToElement)(window,e,t);if(!(!this._charSizeService.hasValidSize||i[0]<0||i[1]<0||i[0]>=this._renderService.dimensions.css.canvas.width||i[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};a=r([n(0,s.IRenderService),n(1,s.ICharSizeService)],a),t.MouseService=a},3230:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const s=i(6193),o=i(8460),a=i(844),c=i(5596),h=i(3656),l=i(2585),u=i(4725),f=i(7226);let d=class extends a.Disposable{constructor(e,t,i,r,n,a,l,u){if(super(),this._rowCount=e,this._charSizeService=r,this._pausedResizeTask=new f.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new o.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new o.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new o.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new o.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var e;return null===(e=this._renderer)||void 0===e?void 0:e.dispose()}}),this._renderDebouncer=new s.RenderDebouncer(l.window,((e,t)=>this._renderRows(e,t))),this.register(this._renderDebouncer),this._screenDprMonitor=new c.ScreenDprMonitor(l.window),this._screenDprMonitor.setListener((()=>this.handleDevicePixelRatioChange())),this.register(this._screenDprMonitor),this.register(a.onResize((()=>this._fullRefresh()))),this.register(a.buffers.onBufferActivate((()=>{var e;return null===(e=this._renderer)||void 0===e?void 0:e.clear()}))),this.register(i.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(n.onDecorationRegistered((()=>this._fullRefresh()))),this.register(n.onDecorationRemoved((()=>this._fullRefresh()))),this.register(i.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],(()=>{this.clear(),this.handleResize(a.cols,a.rows),this._fullRefresh()}))),this.register(i.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(a.buffer.y,a.buffer.y,!0)))),this.register((0,h.addDisposableDomListener)(l.window,"resize",(()=>this.handleDevicePixelRatioChange()))),this.register(u.onChangeColors((()=>this._fullRefresh()))),"IntersectionObserver"in l.window){const e=new l.window.IntersectionObserver((e=>this._handleIntersectionChange(e[e.length-1])),{threshold:0});e.observe(t),this.register({dispose:()=>e.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,i=!1){this._isPaused?this._needsFullRefresh=!0:(i||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer&&(this._renderer.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(e){var t;null===(t=this._renderer)||void 0===t||t.dispose(),this._renderer=e,this._renderer.onRequestRedraw((e=>this.refreshRows(e.start,e.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer&&(null===(t=(e=this._renderer).clearTextureAtlas)||void 0===t||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.handleResize(e,t))):this._renderer.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;null===(e=this._renderer)||void 0===e||e.handleCharSizeChanged()}handleBlur(){var e;null===(e=this._renderer)||void 0===e||e.handleBlur()}handleFocus(){var e;null===(e=this._renderer)||void 0===e||e.handleFocus()}handleSelectionChanged(e,t,i){var r;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=i,null===(r=this._renderer)||void 0===r||r.handleSelectionChanged(e,t,i)}handleCursorMove(){var e;null===(e=this._renderer)||void 0===e||e.handleCursorMove()}clear(){var e;null===(e=this._renderer)||void 0===e||e.clear()}};d=r([n(2,l.IOptionsService),n(3,u.ICharSizeService),n(4,l.IDecorationService),n(5,l.IBufferService),n(6,u.ICoreBrowserService),n(7,u.IThemeService)],d),t.RenderService=d},9312:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const s=i(6114),o=i(456),a=i(511),c=i(8460),h=i(4725),l=i(2585),u=i(9806),f=i(9504),d=i(844),p=i(4841),_=String.fromCharCode(160),g=new RegExp(_,"g");let v=class extends d.Disposable{constructor(e,t,i,r,n,s,h,l,u){super(),this._element=e,this._screenElement=t,this._linkifier=i,this._bufferService=r,this._coreService=n,this._mouseService=s,this._optionsService=h,this._renderService=l,this._coreBrowserService=u,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new a.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((e=>this._handleTrim(e))),this.register(this._bufferService.buffers.onBufferActivate((e=>this._handleBufferActivate(e)))),this.enable(),this._model=new o.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,d.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!(!e||!t||e[0]===t[0]&&e[1]===t[1])}get selectionText(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";const i=this._bufferService.buffer,r=[];if(3===this._activeSelectionMode){if(e[0]===t[0])return"";const n=e[0]<t[0]?e[0]:t[0],s=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){const e=i.translateBufferLineToString(o,!0,n,s);r.push(e)}}else{const n=e[1]===t[1]?t[0]:void 0;r.push(i.translateBufferLineToString(e[1],!0,e[0],n));for(let n=e[1]+1;n<=t[1]-1;n++){const e=i.lines.get(n),t=i.translateBufferLineToString(n,!0);(null==e?void 0:e.isWrapped)?r[r.length-1]+=t:r.push(t)}if(e[1]!==t[1]){const e=i.lines.get(t[1]),n=i.translateBufferLineToString(t[1],!0,0,t[0]);e&&e.isWrapped?r[r.length-1]+=n:r.push(n)}}return r.map((e=>e.replace(g," "))).join(s.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),s.isLinux&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){const t=this._getMouseBufferCoords(e),i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!!(i&&r&&t)&&this._areCoordsInSelection(t,i,r)}isCellInSelection(e,t){const i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!(!i||!r)&&this._areCoordsInSelection([e,t],i,r)}_areCoordsInSelection(e,t,i){return e[1]>t[1]&&e[1]<i[1]||t[1]===i[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<i[0]||t[1]<i[1]&&e[1]===i[1]&&e[0]<i[0]||t[1]<i[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){var i,r;const n=null===(r=null===(i=this._linkifier.currentLink)||void 0===i?void 0:i.link)||void 0===r?void 0:r.range;if(n)return this._model.selectionStart=[n.start.x-1,n.start.y-1],this._model.selectionStartLength=(0,p.getRangeLength)(n,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const s=this._getMouseBufferCoords(e);return!!s&&(this._selectWordAt(s,t),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){const t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=(0,u.getCoordsRelativeToElement)(this._coreBrowserService.window,e,this._screenElement)[1];const i=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=i?0:(t>i&&(t-=i),t=Math.min(Math.max(t,-50),50),t/=50,t/Math.abs(t)+Math.round(14*t))}shouldForceSelection(e){return s.isMac?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,(2!==e.button||!this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&0===t.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){const t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;const t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const i=this._bufferService.buffer;if(this._model.selectionEnd[1]<i.lines.length){const e=i.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}t&&t[0]===this._model.selectionEnd[0]&&t[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){const t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const t=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(t&&void 0!==t[0]&&void 0!==t[1]){const e=(0,f.moveToCellSequence)(t[0]-1,t[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,i=!(!e||!t||e[0]===t[0]&&e[1]===t[1]);i?e&&t&&(this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&t[0]===this._oldSelectionEnd[0]&&t[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,t,i)):this._oldHasSelection&&this._fireOnSelectionChange(e,t,i)}_fireOnSelectionChange(e,t,i){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=i,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim((e=>this._handleTrim(e)))}_convertViewportColToCharacterIndex(e,t){let i=t;for(let r=0;t>=r;r++){const n=e.loadCell(r,this._workCell).getChars().length;0===this._workCell.getWidth()?i--:n>1&&t!==r&&(i+=n-1)}return i}setSelection(e,t,i){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=i,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,i=!0,r=!0){if(e[0]>=this._bufferService.cols)return;const n=this._bufferService.buffer,s=n.lines.get(e[1]);if(!s)return;const o=n.translateBufferLineToString(e[1],!1);let a=this._convertViewportColToCharacterIndex(s,e[0]),c=a;const h=e[0]-a;let l=0,u=0,f=0,d=0;if(" "===o.charAt(a)){for(;a>0&&" "===o.charAt(a-1);)a--;for(;c<o.length&&" "===o.charAt(c+1);)c++}else{let t=e[0],i=e[0];0===s.getWidth(t)&&(l++,t--),2===s.getWidth(i)&&(u++,i++);const r=s.getString(i).length;for(r>1&&(d+=r-1,c+=r-1);t>0&&a>0&&!this._isCharWordSeparator(s.loadCell(t-1,this._workCell));){s.loadCell(t-1,this._workCell);const e=this._workCell.getChars().length;0===this._workCell.getWidth()?(l++,t--):e>1&&(f+=e-1,a-=e-1),a--,t--}for(;i<s.length&&c+1<o.length&&!this._isCharWordSeparator(s.loadCell(i+1,this._workCell));){s.loadCell(i+1,this._workCell);const e=this._workCell.getChars().length;2===this._workCell.getWidth()?(u++,i++):e>1&&(d+=e-1,c+=e-1),c++,i++}}c++;let p=a+h-l+f,_=Math.min(this._bufferService.cols,c-a+l+u-f-d);if(t||""!==o.slice(a,c).trim()){if(i&&0===p&&32!==s.getCodePoint(0)){const t=n.lines.get(e[1]-1);if(t&&s.isWrapped&&32!==t.getCodePoint(this._bufferService.cols-1)){const t=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(t){const e=this._bufferService.cols-t.start;p-=e,_+=e}}}if(r&&p+_===this._bufferService.cols&&32!==s.getCodePoint(this._bufferService.cols-1)){const t=n.lines.get(e[1]+1);if((null==t?void 0:t.isWrapped)&&32!==t.getCodePoint(0)){const t=this._getWordAt([0,e[1]+1],!1,!1,!0);t&&(_+=t.length)}}return{start:p,length:_}}}_selectWordAt(e,t){const i=this._getWordAt(e,t);if(i){for(;i.start<0;)i.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[i.start,e[1]],this._model.selectionStartLength=i.length}}_selectToWordAt(e){const t=this._getWordAt(e,!0);if(t){let i=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,i--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,i++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,i]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){const t=this._bufferService.buffer.getWrappedRangeForLine(e),i={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,p.getRangeLength)(i,this._bufferService.cols)}};v=r([n(3,l.IBufferService),n(4,l.ICoreService),n(5,h.IMouseService),n(6,l.IOptionsService),n(7,h.IRenderService),n(8,h.ICoreBrowserService)],v),t.SelectionService=v},4725:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const r=i(8343);t.ICharSizeService=(0,r.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,r.createDecorator)("CoreBrowserService"),t.IMouseService=(0,r.createDecorator)("MouseService"),t.IRenderService=(0,r.createDecorator)("RenderService"),t.ISelectionService=(0,r.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,r.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,r.createDecorator)("ThemeService")},6731:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const s=i(7239),o=i(8055),a=i(8460),c=i(844),h=i(2585),l=o.css.toColor("#ffffff"),u=o.css.toColor("#000000"),f=o.css.toColor("#ffffff"),d=o.css.toColor("#000000"),p={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const e=[o.css.toColor("#2e3436"),o.css.toColor("#cc0000"),o.css.toColor("#4e9a06"),o.css.toColor("#c4a000"),o.css.toColor("#3465a4"),o.css.toColor("#75507b"),o.css.toColor("#06989a"),o.css.toColor("#d3d7cf"),o.css.toColor("#555753"),o.css.toColor("#ef2929"),o.css.toColor("#8ae234"),o.css.toColor("#fce94f"),o.css.toColor("#729fcf"),o.css.toColor("#ad7fa8"),o.css.toColor("#34e2e2"),o.css.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let i=0;i<216;i++){const r=t[i/36%6|0],n=t[i/6%6|0],s=t[i%6];e.push({css:o.channels.toCss(r,n,s),rgba:o.channels.toRgba(r,n,s)})}for(let t=0;t<24;t++){const i=8+10*t;e.push({css:o.channels.toCss(i,i,i),rgba:o.channels.toRgba(i,i,i)})}return e})());let _=class extends c.Disposable{constructor(e){super(),this._optionsService=e,this._onChangeColors=this.register(new a.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new s.ColorContrastCache,this._colors={foreground:l,background:u,cursor:f,cursorAccent:d,selectionForeground:void 0,selectionBackgroundTransparent:p,selectionBackgroundOpaque:o.color.blend(u,p),selectionInactiveBackgroundTransparent:p,selectionInactiveBackgroundOpaque:o.color.blend(u,p),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}get colors(){return this._colors}_setTheme(e={}){const i=this._colors;if(i.foreground=g(e.foreground,l),i.background=g(e.background,u),i.cursor=g(e.cursor,f),i.cursorAccent=g(e.cursorAccent,d),i.selectionBackgroundTransparent=g(e.selectionBackground,p),i.selectionBackgroundOpaque=o.color.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=g(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=o.color.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?g(e.selectionForeground,o.NULL_COLOR):void 0,i.selectionForeground===o.NULL_COLOR&&(i.selectionForeground=void 0),o.color.isOpaque(i.selectionBackgroundTransparent)){const e=.3;i.selectionBackgroundTransparent=o.color.opacity(i.selectionBackgroundTransparent,e)}if(o.color.isOpaque(i.selectionInactiveBackgroundTransparent)){const e=.3;i.selectionInactiveBackgroundTransparent=o.color.opacity(i.selectionInactiveBackgroundTransparent,e)}if(i.ansi=t.DEFAULT_ANSI_COLORS.slice(),i.ansi[0]=g(e.black,t.DEFAULT_ANSI_COLORS[0]),i.ansi[1]=g(e.red,t.DEFAULT_ANSI_COLORS[1]),i.ansi[2]=g(e.green,t.DEFAULT_ANSI_COLORS[2]),i.ansi[3]=g(e.yellow,t.DEFAULT_ANSI_COLORS[3]),i.ansi[4]=g(e.blue,t.DEFAULT_ANSI_COLORS[4]),i.ansi[5]=g(e.magenta,t.DEFAULT_ANSI_COLORS[5]),i.ansi[6]=g(e.cyan,t.DEFAULT_ANSI_COLORS[6]),i.ansi[7]=g(e.white,t.DEFAULT_ANSI_COLORS[7]),i.ansi[8]=g(e.brightBlack,t.DEFAULT_ANSI_COLORS[8]),i.ansi[9]=g(e.brightRed,t.DEFAULT_ANSI_COLORS[9]),i.ansi[10]=g(e.brightGreen,t.DEFAULT_ANSI_COLORS[10]),i.ansi[11]=g(e.brightYellow,t.DEFAULT_ANSI_COLORS[11]),i.ansi[12]=g(e.brightBlue,t.DEFAULT_ANSI_COLORS[12]),i.ansi[13]=g(e.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),i.ansi[14]=g(e.brightCyan,t.DEFAULT_ANSI_COLORS[14]),i.ansi[15]=g(e.brightWhite,t.DEFAULT_ANSI_COLORS[15]),e.extendedAnsi){const r=Math.min(i.ansi.length-16,e.extendedAnsi.length);for(let n=0;n<r;n++)i.ansi[n+16]=g(e.extendedAnsi[n],t.DEFAULT_ANSI_COLORS[n+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0!==e)switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}else for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e]}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(e,t){if(void 0!==e)try{return o.css.toColor(e)}catch(e){}return t}_=r([n(0,h.IOptionsService)],_),t.ThemeService=_},6349:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const r=i(8460),n=i(844);class s extends n.Disposable{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this.register(new r.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new r.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new r.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;const t=new Array(e);for(let i=0;i<Math.min(e,this.length);i++)t[i]=this._array[this._getCyclicIndex(i)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...i){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let t=this._length-1;t>=e;t--)this._array[this._getCyclicIndex(t+i.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<i.length;t++)this._array[this._getCyclicIndex(e+t)]=i[t];if(i.length&&this.onInsertEmitter.fire({index:e,amount:i.length}),this._length+i.length>this._maxLength){const e=this._length+i.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=i.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,i){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+i<0)throw new Error("Cannot shift elements in list beyond index 0");if(i>0){for(let r=t-1;r>=0;r--)this.set(e+r+i,this.get(e+r));const r=e+t+i-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<t;r++)this.set(e+r+i,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}}t.CircularList=s},1439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function e(t,i=5){if("object"!=typeof t)return t;const r=Array.isArray(t)?[]:{};for(const n in t)r[n]=i<=1?t[n]:t[n]&&e(t[n],i-1);return r}},8055:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;const r=i(6114);let n=0,s=0,o=0,a=0;var c,h,l;function u(e){const t=e.toString(16);return t.length<2?"0"+t:t}function f(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(e){e.toCss=function(e,t,i,r){return void 0!==r?`#${u(e)}${u(t)}${u(i)}${u(r)}`:`#${u(e)}${u(t)}${u(i)}`},e.toRgba=function(e,t,i,r=255){return(e<<24|t<<16|i<<8|r)>>>0}}(c=t.channels||(t.channels={})),function(e){function t(e,t){return a=Math.round(255*t),[n,s,o]=l.toChannels(e.rgba),{css:c.toCss(n,s,o,a),rgba:c.toRgba(n,s,o,a)}}e.blend=function(e,t){if(a=(255&t.rgba)/255,1===a)return{css:t.css,rgba:t.rgba};const i=t.rgba>>24&255,r=t.rgba>>16&255,h=t.rgba>>8&255,l=e.rgba>>24&255,u=e.rgba>>16&255,f=e.rgba>>8&255;return n=l+Math.round((i-l)*a),s=u+Math.round((r-u)*a),o=f+Math.round((h-f)*a),{css:c.toCss(n,s,o),rgba:c.toRgba(n,s,o)}},e.isOpaque=function(e){return 255==(255&e.rgba)},e.ensureContrastRatio=function(e,t,i){const r=l.ensureContrastRatio(e.rgba,t.rgba,i);if(r)return l.toColor(r>>24&255,r>>16&255,r>>8&255)},e.opaque=function(e){const t=(255|e.rgba)>>>0;return[n,s,o]=l.toChannels(t),{css:c.toCss(n,s,o),rgba:t}},e.opacity=t,e.multiplyOpacity=function(e,i){return a=255&e.rgba,t(e,a*i/255)},e.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]}}(t.color||(t.color={})),function(e){let t,i;if(!r.isNode){const e=document.createElement("canvas");e.width=1,e.height=1;const r=e.getContext("2d",{willReadFrequently:!0});r&&(t=r,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return n=parseInt(e.slice(1,2).repeat(2),16),s=parseInt(e.slice(2,3).repeat(2),16),o=parseInt(e.slice(3,4).repeat(2),16),l.toColor(n,s,o);case 5:return n=parseInt(e.slice(1,2).repeat(2),16),s=parseInt(e.slice(2,3).repeat(2),16),o=parseInt(e.slice(3,4).repeat(2),16),a=parseInt(e.slice(4,5).repeat(2),16),l.toColor(n,s,o,a);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}const r=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(r)return n=parseInt(r[1]),s=parseInt(r[2]),o=parseInt(r[3]),a=Math.round(255*(void 0===r[5]?1:parseFloat(r[5]))),l.toColor(n,s,o,a);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=e,"string"!=typeof t.fillStyle)throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[n,s,o,a]=t.getImageData(0,0,1,1).data,255!==a)throw new Error("css.toColor: Unsupported css format");return{rgba:c.toRgba(n,s,o,a),css:e}}}(t.css||(t.css={})),function(e){function t(e,t,i){const r=e/255,n=t/255,s=i/255;return.2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))}e.relativeLuminance=function(e){return t(e>>16&255,e>>8&255,255&e)},e.relativeLuminance2=t}(h=t.rgb||(t.rgb={})),function(e){function t(e,t,i){const r=e>>24&255,n=e>>16&255,s=e>>8&255;let o=t>>24&255,a=t>>16&255,c=t>>8&255,l=f(h.relativeLuminance2(o,a,c),h.relativeLuminance2(r,n,s));for(;l<i&&(o>0||a>0||c>0);)o-=Math.max(0,Math.ceil(.1*o)),a-=Math.max(0,Math.ceil(.1*a)),c-=Math.max(0,Math.ceil(.1*c)),l=f(h.relativeLuminance2(o,a,c),h.relativeLuminance2(r,n,s));return(o<<24|a<<16|c<<8|255)>>>0}function i(e,t,i){const r=e>>24&255,n=e>>16&255,s=e>>8&255;let o=t>>24&255,a=t>>16&255,c=t>>8&255,l=f(h.relativeLuminance2(o,a,c),h.relativeLuminance2(r,n,s));for(;l<i&&(o<255||a<255||c<255);)o=Math.min(255,o+Math.ceil(.1*(255-o))),a=Math.min(255,a+Math.ceil(.1*(255-a))),c=Math.min(255,c+Math.ceil(.1*(255-c))),l=f(h.relativeLuminance2(o,a,c),h.relativeLuminance2(r,n,s));return(o<<24|a<<16|c<<8|255)>>>0}e.ensureContrastRatio=function(e,r,n){const s=h.relativeLuminance(e>>8),o=h.relativeLuminance(r>>8);if(f(s,o)<n){if(o<s){const o=t(e,r,n),a=f(s,h.relativeLuminance(o>>8));if(a<n){const t=i(e,r,n);return a>f(s,h.relativeLuminance(t>>8))?o:t}return o}const a=i(e,r,n),c=f(s,h.relativeLuminance(a>>8));if(c<n){const i=t(e,r,n);return c>f(s,h.relativeLuminance(i>>8))?a:i}return a}},e.reduceLuminance=t,e.increaseLuminance=i,e.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},e.toColor=function(e,t,i,r){return{css:c.toCss(e,t,i,r),rgba:c.toRgba(e,t,i,r)}}}(l=t.rgba||(t.rgba={})),t.toPaddedHex=u,t.contrastRatio=f},8969:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const r=i(844),n=i(2585),s=i(4348),o=i(7866),a=i(744),c=i(7302),h=i(6975),l=i(8460),u=i(1753),f=i(1480),d=i(7994),p=i(9282),_=i(5435),g=i(5981),v=i(2660);let y=!1;class m extends r.Disposable{constructor(e){super(),this._onBinary=this.register(new l.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new l.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new l.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new l.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new l.EventEmitter),this._instantiationService=new s.InstantiationService,this.optionsService=this.register(new c.OptionsService(e)),this._instantiationService.setService(n.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(a.BufferService)),this._instantiationService.setService(n.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(o.LogService)),this._instantiationService.setService(n.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(h.CoreService)),this._instantiationService.setService(n.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(u.CoreMouseService)),this._instantiationService.setService(n.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(f.UnicodeService)),this._instantiationService.setService(n.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(d.CharsetService),this._instantiationService.setService(n.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(v.OscLinkService),this._instantiationService.setService(n.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new _.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,l.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,l.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,l.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,l.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onSpecificOptionChange("windowsMode",(e=>this._handleWindowsModeOptionChange(e)))),this.register(this._bufferService.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new g.WriteBuffer(((e,t)=>this._inputHandler.parse(e,t)))),this.register((0,l.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,r.toDisposable)((()=>{var e;null===(e=this._windowsMode)||void 0===e||e.dispose(),this._windowsMode=void 0})))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new l.EventEmitter),this._onScroll.event((e=>{var t;null===(t=this._onScrollApi)||void 0===t||t.fire(e.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(const t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=n.LogLevelEnum.WARN&&!y&&(this._logService.warn("writeSync is unreliable and will be removed soon."),y=!0),this._writeBuffer.writeSync(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,a.MINIMUM_COLS),t=Math.max(t,a.MINIMUM_ROWS),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t,i){this._bufferService.scrollLines(e,t,i)}scrollPages(e){this._bufferService.scrollPages(e)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(e){this._bufferService.scrollToLine(e)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(e){var t;e?this._enableWindowsMode():(null===(t=this._windowsMode)||void 0===t||t.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){const e=[];e.push(this.onLineFeed(p.updateWindowsModeWrappedState.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},(()=>((0,p.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsMode={dispose:()=>{for(const t of e)t.dispose()}}}}}t.CoreTerminal=m},8460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const i=[];for(let e=0;e<this._listeners.length;e++)i.push(this._listeners[e]);for(let r=0;r<i.length;r++)i[r].call(void 0,e,t)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},t.forwardEvent=function(e,t){return e((e=>t.fire(e)))}},5435:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const s=i(2584),o=i(7116),a=i(2015),c=i(844),h=i(482),l=i(8437),u=i(8460),f=i(643),d=i(511),p=i(3734),_=i(2585),g=i(6242),v=i(6351),y=i(5941),m={"(":0,")":1,"*":2,"+":3,"-":1,".":2},S=131072;function w(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var b;!function(e){e[e.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",e[e.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(b=t.WindowsOptionsReportType||(t.WindowsOptionsReportType={}));let E=0;class C extends c.Disposable{constructor(e,t,i,r,n,c,f,p,_=new a.EscapeSequenceParser){super(),this._bufferService=e,this._charsetService=t,this._coreService=i,this._logService=r,this._optionsService=n,this._oscLinkService=c,this._coreMouseService=f,this._unicodeService=p,this._parser=_,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new h.StringToUtf32,this._utf8Decoder=new h.Utf8ToUtf32,this._workCell=new d.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=l.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new u.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new u.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new u.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new u.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new u.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new u.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new u.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new u.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new u.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new u.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new u.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new u.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new u.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new k(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._parser.setCsiHandlerFallback(((e,t)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:t.toArray()})})),this._parser.setEscHandlerFallback((e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})})),this._parser.setExecuteHandlerFallback((e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})})),this._parser.setOscHandlerFallback(((e,t,i)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:t,data:i})})),this._parser.setDcsHandlerFallback(((e,t,i)=>{"HOOK"===t&&(i=i.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:t,payload:i})})),this._parser.setPrintHandler(((e,t,i)=>this.print(e,t,i))),this._parser.registerCsiHandler({final:"@"},(e=>this.insertChars(e))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(e=>this.scrollLeft(e))),this._parser.registerCsiHandler({final:"A"},(e=>this.cursorUp(e))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(e=>this.scrollRight(e))),this._parser.registerCsiHandler({final:"B"},(e=>this.cursorDown(e))),this._parser.registerCsiHandler({final:"C"},(e=>this.cursorForward(e))),this._parser.registerCsiHandler({final:"D"},(e=>this.cursorBackward(e))),this._parser.registerCsiHandler({final:"E"},(e=>this.cursorNextLine(e))),this._parser.registerCsiHandler({final:"F"},(e=>this.cursorPrecedingLine(e))),this._parser.registerCsiHandler({final:"G"},(e=>this.cursorCharAbsolute(e))),this._parser.registerCsiHandler({final:"H"},(e=>this.cursorPosition(e))),this._parser.registerCsiHandler({final:"I"},(e=>this.cursorForwardTab(e))),this._parser.registerCsiHandler({final:"J"},(e=>this.eraseInDisplay(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(e=>this.eraseInDisplay(e,!0))),this._parser.registerCsiHandler({final:"K"},(e=>this.eraseInLine(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(e=>this.eraseInLine(e,!0))),this._parser.registerCsiHandler({final:"L"},(e=>this.insertLines(e))),this._parser.registerCsiHandler({final:"M"},(e=>this.deleteLines(e))),this._parser.registerCsiHandler({final:"P"},(e=>this.deleteChars(e))),this._parser.registerCsiHandler({final:"S"},(e=>this.scrollUp(e))),this._parser.registerCsiHandler({final:"T"},(e=>this.scrollDown(e))),this._parser.registerCsiHandler({final:"X"},(e=>this.eraseChars(e))),this._parser.registerCsiHandler({final:"Z"},(e=>this.cursorBackwardTab(e))),this._parser.registerCsiHandler({final:"`"},(e=>this.charPosAbsolute(e))),this._parser.registerCsiHandler({final:"a"},(e=>this.hPositionRelative(e))),this._parser.registerCsiHandler({final:"b"},(e=>this.repeatPrecedingCharacter(e))),this._parser.registerCsiHandler({final:"c"},(e=>this.sendDeviceAttributesPrimary(e))),this._parser.registerCsiHandler({prefix:">",final:"c"},(e=>this.sendDeviceAttributesSecondary(e))),this._parser.registerCsiHandler({final:"d"},(e=>this.linePosAbsolute(e))),this._parser.registerCsiHandler({final:"e"},(e=>this.vPositionRelative(e))),this._parser.registerCsiHandler({final:"f"},(e=>this.hVPosition(e))),this._parser.registerCsiHandler({final:"g"},(e=>this.tabClear(e))),this._parser.registerCsiHandler({final:"h"},(e=>this.setMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(e=>this.setModePrivate(e))),this._parser.registerCsiHandler({final:"l"},(e=>this.resetMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(e=>this.resetModePrivate(e))),this._parser.registerCsiHandler({final:"m"},(e=>this.charAttributes(e))),this._parser.registerCsiHandler({final:"n"},(e=>this.deviceStatus(e))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(e=>this.deviceStatusPrivate(e))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(e=>this.softReset(e))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(e=>this.setCursorStyle(e))),this._parser.registerCsiHandler({final:"r"},(e=>this.setScrollRegion(e))),this._parser.registerCsiHandler({final:"s"},(e=>this.saveCursor(e))),this._parser.registerCsiHandler({final:"t"},(e=>this.windowOptions(e))),this._parser.registerCsiHandler({final:"u"},(e=>this.restoreCursor(e))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(e=>this.insertColumns(e))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(e=>this.deleteColumns(e))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(e=>this.selectProtected(e))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(e=>this.requestMode(e,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(e=>this.requestMode(e,!1))),this._parser.setExecuteHandler(s.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(s.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(s.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(s.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(s.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(s.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(s.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(s.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(s.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(s.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(s.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(s.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new g.OscHandler((e=>(this.setTitle(e),this.setIconName(e),!0)))),this._parser.registerOscHandler(1,new g.OscHandler((e=>this.setIconName(e)))),this._parser.registerOscHandler(2,new g.OscHandler((e=>this.setTitle(e)))),this._parser.registerOscHandler(4,new g.OscHandler((e=>this.setOrReportIndexedColor(e)))),this._parser.registerOscHandler(8,new g.OscHandler((e=>this.setHyperlink(e)))),this._parser.registerOscHandler(10,new g.OscHandler((e=>this.setOrReportFgColor(e)))),this._parser.registerOscHandler(11,new g.OscHandler((e=>this.setOrReportBgColor(e)))),this._parser.registerOscHandler(12,new g.OscHandler((e=>this.setOrReportCursorColor(e)))),this._parser.registerOscHandler(104,new g.OscHandler((e=>this.restoreIndexedColor(e)))),this._parser.registerOscHandler(110,new g.OscHandler((e=>this.restoreFgColor(e)))),this._parser.registerOscHandler(111,new g.OscHandler((e=>this.restoreBgColor(e)))),this._parser.registerOscHandler(112,new g.OscHandler((e=>this.restoreCursorColor(e)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const e in o.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:e},(()=>this.selectCharset("("+e))),this._parser.registerEscHandler({intermediates:")",final:e},(()=>this.selectCharset(")"+e))),this._parser.registerEscHandler({intermediates:"*",final:e},(()=>this.selectCharset("*"+e))),this._parser.registerEscHandler({intermediates:"+",final:e},(()=>this.selectCharset("+"+e))),this._parser.registerEscHandler({intermediates:"-",final:e},(()=>this.selectCharset("-"+e))),this._parser.registerEscHandler({intermediates:".",final:e},(()=>this.selectCharset("."+e))),this._parser.registerEscHandler({intermediates:"/",final:e},(()=>this.selectCharset("/"+e)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((e=>(this._logService.error("Parsing error: ",e),e))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new v.DcsHandler(((e,t)=>this.requestStatusString(e,t))))}getAttrData(){return this._curAttrData}_preserveStack(e,t,i,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=i,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=_.LogLevelEnum.WARN&&Promise.race([e,new Promise(((e,t)=>setTimeout((()=>t("#SLOW_TIMEOUT")),5e3)))]).catch((e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let i,r=this._activeBuffer.x,n=this._activeBuffer.y,s=0;const o=this._parseStack.paused;if(o){if(i=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(i),i;r=this._parseStack.cursorStartX,n=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>S&&(s=this._parseStack.position+S)}if(this._logService.logLevel<=_.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("")}"`),"string"==typeof e?e.split("").map((e=>e.charCodeAt(0))):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<S&&(this._parseBuffer=new Uint32Array(Math.min(e.length,S))),o||this._dirtyRowTracker.clearRange(),e.length>S)for(let t=s;t<e.length;t+=S){const s=t+S<e.length?t+S:e.length,o="string"==typeof e?this._stringDecoder.decode(e.substring(t,s),this._parseBuffer):this._utf8Decoder.decode(e.subarray(t,s),this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,o))return this._preserveStack(r,n,o,t),this._logSlowResolvingAsync(i),i}else if(!o){const t="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,t))return this._preserveStack(r,n,t,0),this._logSlowResolvingAsync(i),i}this._activeBuffer.x===r&&this._activeBuffer.y===n||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(e,t,i){let r,n;const s=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,c=this._coreService.decPrivateModes.wraparound,l=this._coreService.modes.insertMode,u=this._curAttrData;let d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&i-t>0&&2===d.getWidth(this._activeBuffer.x-1)&&d.setCellFromCodePoint(this._activeBuffer.x-1,0,1,u.fg,u.bg,u.extended);for(let p=t;p<i;++p){if(r=e[p],n=this._unicodeService.wcwidth(r),r<127&&s){const e=s[String.fromCharCode(r)];e&&(r=e.charCodeAt(0))}if(o&&this._onA11yChar.fire((0,h.stringFromCodePoint)(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),n||!this._activeBuffer.x){if(this._activeBuffer.x+n-1>=a)if(c){for(;this._activeBuffer.x<a;)d.setCellFromCodePoint(this._activeBuffer.x++,0,1,u.fg,u.bg,u.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=a-1,2===n)continue;if(l&&(d.insertCells(this._activeBuffer.x,n,this._activeBuffer.getNullCell(u),u),2===d.getWidth(a-1)&&d.setCellFromCodePoint(a-1,f.NULL_CELL_CODE,f.NULL_CELL_WIDTH,u.fg,u.bg,u.extended)),d.setCellFromCodePoint(this._activeBuffer.x++,r,n,u.fg,u.bg,u.extended),n>0)for(;--n;)d.setCellFromCodePoint(this._activeBuffer.x++,0,0,u.fg,u.bg,u.extended)}else d.getWidth(this._activeBuffer.x-1)?d.addCodepointToCell(this._activeBuffer.x-1,r):d.addCodepointToCell(this._activeBuffer.x-2,r)}i-t>0&&(d.loadCell(this._activeBuffer.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<a&&i-t>0&&0===d.getWidth(this._activeBuffer.x)&&!d.hasContent(this._activeBuffer.x)&&d.setCellFromCodePoint(this._activeBuffer.x,0,1,u.fg,u.bg,u.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,t):this._parser.registerCsiHandler(e,(e=>!w(e.params[0],this._optionsService.rawOptions.windowOptions)||t(e)))}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new v.DcsHandler(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new g.OscHandler(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null===(e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))||void 0===e?void 0:e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){const t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){const t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){const t=e.params[0];return 0===t?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===t&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){const t=e.params[0];return 1===t&&(this._curAttrData.bg|=536870912),2!==t&&0!==t||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,i,r=!1,n=!1){const s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.replaceCells(t,i,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),n),r&&(s.isWrapped=!1)}_resetBufferLine(e,t=!1){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),i.isWrapped=!1}eraseInDisplay(e,t=!1){let i;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);i<this._bufferService.rows;i++)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 2:for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 3:const e=this._activeBuffer.lines.length-this._bufferService.rows;e>0&&(this._activeBuffer.lines.trimStart(e),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-e,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-e,0),this._onScroll.fire(0))}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,n=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;t--;)this._activeBuffer.lines.splice(n-1,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y;let r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;t--;)this._activeBuffer.lines.splice(i,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(l.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){if(!this._parser.precedingCodepoint)return!0;const t=e.params[0]||1,i=new Uint32Array(t);for(let e=0;e<t;++e)i[e]=this._parser.precedingCodepoint;return this.print(i,0,i.length),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(s.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(s.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(s.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(s.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(s.C0.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),this._charsetService.setgCharset(1,o.DEFAULT_CHARSET),this._charsetService.setgCharset(2,o.DEFAULT_CHARSET),this._charsetService.setgCharset(3,o.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[t]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(e,t){const i=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:a,cols:c}=this._bufferService,{active:h,alt:l}=a,u=this._optionsService.rawOptions,f=e=>e?1:2,d=e.params[0];return p=d,_=t?2===d?3:4===d?f(o.modes.insertMode):12===d?4:20===d?f(u.convertEol):0:1===d?f(i.applicationCursorKeys):3===d?u.windowOptions.setWinLines?80===c?2:132===c?1:0:0:6===d?f(i.origin):7===d?f(i.wraparound):8===d?3:9===d?f("X10"===r):12===d?f(u.cursorBlink):25===d?f(!o.isCursorHidden):45===d?f(i.reverseWraparound):66===d?f(i.applicationKeypad):1e3===d?f("VT200"===r):1002===d?f("DRAG"===r):1003===d?f("ANY"===r):1004===d?f(i.sendFocus):1005===d?4:1006===d?f("SGR"===n):1015===d?4:1016===d?f("SGR_PIXELS"===n):1048===d?1:47===d||1047===d||1049===d?f(h===l):2004===d?f(i.bracketedPasteMode):0,o.triggerDataEvent(`${s.C0.ESC}[${t?"":"?"}${p};${_}$y`),!0;var p,_}_updateAttrColor(e,t,i,r,n){return 2===t?(e|=50331648,e&=-16777216,e|=p.AttributeData.fromColorRGB([i,r,n])):5===t&&(e&=-50331904,e|=33554432|255&i),e}_extractColor(e,t,i){const r=[0,0,-1,0,0,0];let n=0,s=0;do{if(r[s+n]=e.params[t+s],e.hasSubParams(t+s)){const i=e.getSubParams(t+s);let o=0;do{5===r[1]&&(n=1),r[s+o+1+n]=i[o]}while(++o<i.length&&o+s+1+n<r.length);break}if(5===r[1]&&s+n>=2||2===r[1]&&s+n>=5)break;r[1]&&(n=1)}while(++s+t<e.length&&s+n<r.length);for(let e=2;e<r.length;++e)-1===r[e]&&(r[e]=0);switch(r[0]){case 38:i.fg=this._updateAttrColor(i.fg,r[1],r[3],r[4],r[5]);break;case 48:i.bg=this._updateAttrColor(i.bg,r[1],r[3],r[4],r[5]);break;case 58:i.extended=i.extended.clone(),i.extended.underlineColor=this._updateAttrColor(i.extended.underlineColor,r[1],r[3],r[4],r[5])}return s}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,0===e&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=l.DEFAULT_ATTR_DATA.fg,e.bg=l.DEFAULT_ATTR_DATA.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;const t=e.length;let i;const r=this._curAttrData;for(let n=0;n<t;n++)i=e.params[n],i>=30&&i<=37?(r.fg&=-50331904,r.fg|=16777216|i-30):i>=40&&i<=47?(r.bg&=-50331904,r.bg|=16777216|i-40):i>=90&&i<=97?(r.fg&=-50331904,r.fg|=16777224|i-90):i>=100&&i<=107?(r.bg&=-50331904,r.bg|=16777224|i-100):0===i?this._processSGR0(r):1===i?r.fg|=134217728:3===i?r.bg|=67108864:4===i?(r.fg|=268435456,this._processUnderline(e.hasSubParams(n)?e.getSubParams(n)[0]:1,r)):5===i?r.fg|=536870912:7===i?r.fg|=67108864:8===i?r.fg|=1073741824:9===i?r.fg|=2147483648:2===i?r.bg|=134217728:21===i?this._processUnderline(2,r):22===i?(r.fg&=-134217729,r.bg&=-134217729):23===i?r.bg&=-67108865:24===i?(r.fg&=-268435457,this._processUnderline(0,r)):25===i?r.fg&=-536870913:27===i?r.fg&=-67108865:28===i?r.fg&=-1073741825:29===i?r.fg&=2147483647:39===i?(r.fg&=-67108864,r.fg|=16777215&l.DEFAULT_ATTR_DATA.fg):49===i?(r.bg&=-67108864,r.bg|=16777215&l.DEFAULT_ATTR_DATA.bg):38===i||48===i||58===i?n+=this._extractColor(e,n,r):59===i?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):100===i?(r.fg&=-67108864,r.fg|=16777215&l.DEFAULT_ATTR_DATA.fg,r.bg&=-67108864,r.bg|=16777215&l.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${s.C0.ESC}[0n`);break;case 6:const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[${e};${t}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[?${e};${t}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){const t=e.params[0]||1;switch(t){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const i=t%2==1;return this._optionsService.options.cursorBlink=i,!0}setScrollRegion(e){const t=e.params[0]||1;let i;return(e.length<2||(i=e.params[1])>this._bufferService.rows||0===i)&&(i=this._bufferService.rows),i>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}windowOptions(e){if(!w(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;const t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==t&&this._onRequestWindowsOptionsReport.fire(b.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(b.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${s.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==t&&2!==t||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==t&&1!==t||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==t&&2!==t||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==t&&1!==t||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){const t=[],i=e.split(";");for(;i.length>1;){const e=i.shift(),r=i.shift();if(/^\d+$/.exec(e)){const i=parseInt(e);if(0<=i&&i<256)if("?"===r)t.push({type:0,index:i});else{const e=(0,y.parseColor)(r);e&&t.push({type:1,index:i,color:e})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){const t=e.split(";");return!(t.length<2)&&(t[1]?this._createHyperlink(t[0],t[1]):!t[0]&&this._finishHyperlink())}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();const i=e.split(":");let r;const n=i.findIndex((e=>e.startsWith("id=")));return-1!==n&&(r=i[n].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){const i=e.split(";");for(let e=0;e<i.length&&!(t>=this._specialColors.length);++e,++t)if("?"===i[e])this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{const r=(0,y.parseColor)(i[e]);r&&this._onColor.fire([{type:1,index:this._specialColors[t],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;const t=[],i=e.split(";");for(let e=0;e<i.length;++e)if(/^\d+$/.exec(i[e])){const r=parseInt(i[e]);0<=r&&r<256&&t.push({type:2,index:r})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),!0}selectCharset(e){return 2!==e.length?(this.selectDefaultCharset(),!0):("/"===e[0]||this._charsetService.setgCharset(m[e[0]],o.CHARSETS[e[1]]||o.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=l.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){const e=new d.CellData;e.content=1<<22|"E".charCodeAt(0),e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){const i=this._activeBuffer.ybase+this._activeBuffer.y+t,r=this._activeBuffer.lines.get(i);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){const i=this._bufferService.buffer,r=this._optionsService.rawOptions;return(e=>(this._coreService.triggerDataEvent(`${s.C0.ESC}${e}${s.C0.ESC}\\`),!0))('"q'===e?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}}t.InputHandler=C;let k=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(E=e,e=t,t=E),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};k=r([n(0,_.IBufferService)],k)},844:(e,t)=>{function i(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=i,t.getDisposeArrayDisposable=function(e){return{dispose:()=>i(e)}}},1505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}}t.TwoKeyMap=i,t.FourKeyMap=class{constructor(){this._data=new i}set(e,t,r,n,s){this._data.get(e,t)||this._data.set(e,t,new i),this._data.get(e,t).set(r,n,s)}get(e,t,i,r){var n;return null===(n=this._data.get(e,t))||void 0===n?void 0:n.get(i,r)}clear(){this._data.clear()}}},6114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode="undefined"==typeof navigator;const i=t.isNode?"node":navigator.userAgent,r=t.isNode?"node":navigator.platform;t.isFirefox=i.includes("Firefox"),t.isLegacyEdge=i.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(i),t.getSafariVersion=function(){if(!t.isSafari)return 0;const e=i.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(r),t.isIpad="iPad"===r,t.isIphone="iPhone"===r,t.isWindows=["Windows","Win16","Win32","WinCE"].includes(r),t.isLinux=r.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(i)},6106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let i=0;t.SortedList=class{constructor(e){this._getKey=e,this._array=[]}clear(){this._array.length=0}insert(e){0!==this._array.length?(i=this._search(this._getKey(e),0,this._array.length-1),this._array.splice(i,0,e)):this._array.push(e)}delete(e){if(0===this._array.length)return!1;const t=this._getKey(e);if(void 0===t)return!1;if(i=this._search(t,0,this._array.length-1),-1===i)return!1;if(this._getKey(this._array[i])!==t)return!1;do{if(this._array[i]===e)return this._array.splice(i,1),!0}while(++i<this._array.length&&this._getKey(this._array[i])===t);return!1}*getKeyIterator(e){if(0!==this._array.length&&(i=this._search(e,0,this._array.length-1),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{yield this._array[i]}while(++i<this._array.length&&this._getKey(this._array[i])===e)}forEachByKey(e,t){if(0!==this._array.length&&(i=this._search(e,0,this._array.length-1),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{t(this._array[i])}while(++i<this._array.length&&this._getKey(this._array[i])===e)}values(){return this._array.values()}_search(e,t,i){if(i<t)return t;let r=Math.floor((t+i)/2);const n=this._getKey(this._array[r]);if(n>e)return this._search(e,t,r-1);if(n<e)return this._search(e,r+1,i);for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}}},7226:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const r=i(6114);class n{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),n=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),i=Math.max(t,i),n=e.timeRemaining(),1.5*i>n)return r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),void this._start();r=n}this.clear()}}class s extends n{_requestCallback(e){return setTimeout((()=>e(this._createDeadline(16))))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}t.PriorityTaskQueue=s,t.IdleTaskQueue=!r.isNode&&"requestIdleCallback"in window?class extends n{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}}:s,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}}},9282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const r=i(643);t.updateWindowsModeWrappedState=function(e){const t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1),i=null==t?void 0:t.get(e.cols-1),n=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);n&&i&&(n.isWrapped=i[r.CHAR_DATA_CODE_INDEX]!==r.NULL_CELL_CODE&&i[r.CHAR_DATA_CODE_INDEX]!==r.WHITESPACE_CELL_CODE)}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new r}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){const e=new i;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}t.AttributeData=i;class r{constructor(e=0,t=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=t}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(e){this._ext&=-67108864,this._ext|=67108863&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}clone(){return new r(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}t.ExtendedAttrs=r},9092:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferStringIterator=t.Buffer=t.MAX_BUFFER_SIZE=void 0;const r=i(6349),n=i(8437),s=i(511),o=i(643),a=i(4634),c=i(4863),h=i(7116),l=i(3734),u=i(7226);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,t,i){this._hasScrollback=e,this._optionsService=t,this._bufferService=i,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=n.DEFAULT_ATTR_DATA.clone(),this.savedCharset=h.DEFAULT_CHARSET,this.markers=[],this._nullCell=s.CellData.fromCharData([0,o.NULL_CELL_CHAR,o.NULL_CELL_WIDTH,o.NULL_CELL_CODE]),this._whitespaceCell=s.CellData.fromCharData([0,o.WHITESPACE_CELL_CHAR,o.WHITESPACE_CELL_WIDTH,o.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new l.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new l.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new n.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const i=e+this._optionsService.rawOptions.scrollback;return i>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:i}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=n.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const i=this.getNullCell(n.DEFAULT_ATTR_DATA);let r=0;const s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,i);let o=0;if(this._rows<t)for(let r=this._rows;r<t;r++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new n.BufferLine(e,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+o+1?(this.ybase--,o++,this.ydisp>0&&this.ydisp--):this.lines.push(new n.BufferLine(e,i)));else for(let e=this._rows;e>t;e--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){const e=this.lines.length-s;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),o&&(this.y+=o),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,i);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const i=(0,a.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(n.DEFAULT_ATTR_DATA));if(i.length>0){const r=(0,a.reflowLargerCreateNewLayout)(this.lines,i);(0,a.reflowLargerApplyNewLayout)(this.lines,r.layout),this._reflowLargerAdjustViewport(e,t,r.countRemoved)}}_reflowLargerAdjustViewport(e,t,i){const r=this.getNullCell(n.DEFAULT_ATTR_DATA);let s=i;for(;s-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new n.BufferLine(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-i,0)}_reflowSmaller(e,t){const i=this.getNullCell(n.DEFAULT_ATTR_DATA),r=[];let s=0;for(let o=this.lines.length-1;o>=0;o--){let c=this.lines.get(o);if(!c||!c.isWrapped&&c.getTrimmedLength()<=e)continue;const h=[c];for(;c.isWrapped&&o>0;)c=this.lines.get(--o),h.unshift(c);const l=this.ybase+this.y;if(l>=o&&l<o+h.length)continue;const u=h[h.length-1].getTrimmedLength(),f=(0,a.reflowSmallerGetNewLineLengths)(h,this._cols,e),d=f.length-h.length;let p;p=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+d):Math.max(0,this.lines.length-this.lines.maxLength+d);const _=[];for(let e=0;e<d;e++){const e=this.getBlankLine(n.DEFAULT_ATTR_DATA,!0);_.push(e)}_.length>0&&(r.push({start:o+h.length+s,newLines:_}),s+=_.length),h.push(..._);let g=f.length-1,v=f[g];0===v&&(g--,v=f[g]);let y=h.length-d-1,m=u;for(;y>=0;){const e=Math.min(m,v);if(void 0===h[g])break;if(h[g].copyCellsFrom(h[y],m-e,v-e,e,!0),v-=e,0===v&&(g--,v=f[g]),m-=e,0===m){y--;const e=Math.max(y,0);m=(0,a.getWrappedLineTrimmedLength)(h,e,this._cols)}}for(let t=0;t<h.length;t++)f[t]<e&&h[t].setCell(f[t],i);let S=d-p;for(;S-- >0;)0===this.ybase?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+s)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+d,this.ybase+t-1)}if(r.length>0){const e=[],t=[];for(let e=0;e<this.lines.length;e++)t.push(this.lines.get(e));const i=this.lines.length;let n=i-1,o=0,a=r[o];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+s);let c=0;for(let h=Math.min(this.lines.maxLength-1,i+s-1);h>=0;h--)if(a&&a.start>n+c){for(let e=a.newLines.length-1;e>=0;e--)this.lines.set(h--,a.newLines[e]);h++,e.push({index:n+1,amount:a.newLines.length}),c+=a.newLines.length,a=r[++o]}else this.lines.set(h,t[n--]);let h=0;for(let t=e.length-1;t>=0;t--)e[t].index+=h,this.lines.onInsertEmitter.fire(e[t]),h+=e[t].amount;const l=Math.max(0,i+s-this.lines.maxLength);l>0&&this.lines.onTrimEmitter.fire(l)}}stringIndexToBufferIndex(e,t,i=!1){for(;t;){const r=this.lines.get(e);if(!r)return[-1,-1];const n=i?r.getTrimmedLength():r.length;for(let i=0;i<n;++i)if(r.get(i)[o.CHAR_DATA_WIDTH_INDEX]&&(t-=r.get(i)[o.CHAR_DATA_CHAR_INDEX].length||1),t<0)return[e,i];e++}return[e,0]}translateBufferLineToString(e,t,i=0,r){const n=this.lines.get(e);return n?n.translateToString(t,i,r):""}getWrappedRangeForLine(e){let t=e,i=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;i+1<this.lines.length&&this.lines.get(i+1).isWrapped;)i++;return{first:t,last:i}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new c.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim((e=>{t.line-=e,t.line<0&&t.dispose()}))),t.register(this.lines.onInsert((e=>{t.line>=e.index&&(t.line+=e.amount)}))),t.register(this.lines.onDelete((e=>{t.line>=e.index&&t.line<e.index+e.amount&&t.dispose(),t.line>e.index&&(t.line-=e.amount)}))),t.register(t.onDispose((()=>this._removeMarker(t)))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}iterator(e,t,i,r,n){return new f(this,e,t,i,r,n)}};class f{constructor(e,t,i=0,r=e.lines.length,n=0,s=0){this._buffer=e,this._trimRight=t,this._startIndex=i,this._endIndex=r,this._startOverscan=n,this._endOverscan=s,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){const e=this._buffer.getWrappedRangeForLine(this._current);e.first<this._startIndex-this._startOverscan&&(e.first=this._startIndex-this._startOverscan),e.last>this._endIndex+this._endOverscan&&(e.last=this._endIndex+this._endOverscan),e.first=Math.max(e.first,0),e.last=Math.min(e.last,this._buffer.lines.length);let t="";for(let i=e.first;i<=e.last;++i)t+=this._buffer.translateBufferLineToString(i,this._trimRight);return this._current=e.last+1,{range:e,content:t}}}t.BufferStringIterator=f},8437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const r=i(482),n=i(643),s=i(511),o=i(3734);t.DEFAULT_ATTR_DATA=Object.freeze(new o.AttributeData);let a=0;class c{constructor(e,t,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const r=t||s.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let t=0;t<e;++t)this.setCell(t,r);this.length=e}get(e){const t=this._data[3*e+0],i=2097151&t;return[this._data[3*e+1],2097152&t?this._combined[e]:i?(0,r.stringFromCodePoint)(i):"",t>>22,2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):i]}set(e,t){this._data[3*e+1]=t[n.CHAR_DATA_ATTR_INDEX],t[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=t[1],this._data[3*e+0]=2097152|e|t[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&t}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e]:2097151&t?(0,r.stringFromCodePoint)(2097151&t):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,t){return a=3*e,t.content=this._data[a+0],t.fg=this._data[a+1],t.bg=this._data[a+2],2097152&t.content&&(t.combinedData=this._combined[e]),268435456&t.bg&&(t.extended=this._extendedAttrs[e]),t}setCell(e,t){2097152&t.content&&(this._combined[e]=t.combinedData),268435456&t.bg&&(this._extendedAttrs[e]=t.extended),this._data[3*e+0]=t.content,this._data[3*e+1]=t.fg,this._data[3*e+2]=t.bg}setCellFromCodePoint(e,t,i,r,n,s){268435456&n&&(this._extendedAttrs[e]=s),this._data[3*e+0]=t|i<<22,this._data[3*e+1]=r,this._data[3*e+2]=n}addCodepointToCell(e,t){let i=this._data[3*e+0];2097152&i?this._combined[e]+=(0,r.stringFromCodePoint)(t):(2097151&i?(this._combined[e]=(0,r.stringFromCodePoint)(2097151&i)+(0,r.stringFromCodePoint)(t),i&=-2097152,i|=2097152):i=t|1<<22,this._data[3*e+0]=i)}insertCells(e,t,i,r){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs),t<this.length-e){const r=new s.CellData;for(let i=this.length-e-t-1;i>=0;--i)this.setCell(e+t+i,this.loadCell(e+i,r));for(let r=0;r<t;++r)this.setCell(e+r,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);2===this.getWidth(this.length-1)&&this.setCellFromCodePoint(this.length-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs)}deleteCells(e,t,i,r){if(e%=this.length,t<this.length-e){const r=new s.CellData;for(let i=0;i<this.length-e-t;++i)this.setCell(e+i,this.loadCell(e+t+i,r));for(let e=this.length-t;e<this.length;++e)this.setCell(e,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);e&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs)}replaceCells(e,t,i,r,n=!1){if(n)for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs),t<this.length&&2===this.getWidth(t-1)&&!this.isProtected(t)&&this.setCellFromCodePoint(t,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs);e<t&&e<this.length;)this.isProtected(e)||this.setCell(e,i),e++;else for(e&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs),t<this.length&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new o.ExtendedAttrs);e<t&&e<this.length;)this.setCell(e++,i)}resize(e,t){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const i=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*i)this._data=new Uint32Array(this._data.buffer,0,i);else{const e=new Uint32Array(i);e.set(this._data),this._data=e}for(let i=this.length;i<e;++i)this.setCell(i,t)}else{this._data=this._data.subarray(0,i);const t=Object.keys(this._combined);for(let i=0;i<t.length;i++){const r=parseInt(t[i],10);r>=e&&delete this._combined[r]}const r=Object.keys(this._extendedAttrs);for(let t=0;t<r.length;t++){const i=parseInt(r[t],10);i>=e&&delete this._extendedAttrs[i]}}return this.length=e,4*i*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,t=!1){if(t)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const t in e._combined)this._combined[t]=e._combined[t];this._extendedAttrs={};for(const t in e._extendedAttrs)this._extendedAttrs[t]=e._extendedAttrs[t];this.isWrapped=e.isWrapped}clone(){const e=new c(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const t in this._combined)e._combined[t]=this._combined[t];for(const t in this._extendedAttrs)e._extendedAttrs[t]=this._extendedAttrs[t];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,t,i,r,n){const s=e._data;if(n)for(let n=r-1;n>=0;n--){for(let e=0;e<3;e++)this._data[3*(i+n)+e]=s[3*(t+n)+e];268435456&s[3*(t+n)+2]&&(this._extendedAttrs[i+n]=e._extendedAttrs[t+n])}else for(let n=0;n<r;n++){for(let e=0;e<3;e++)this._data[3*(i+n)+e]=s[3*(t+n)+e];268435456&s[3*(t+n)+2]&&(this._extendedAttrs[i+n]=e._extendedAttrs[t+n])}const o=Object.keys(e._combined);for(let r=0;r<o.length;r++){const n=parseInt(o[r],10);n>=t&&(this._combined[n-t+i]=e._combined[n])}}translateToString(e=!1,t=0,i=this.length){e&&(i=Math.min(i,this.getTrimmedLength()));let s="";for(;t<i;){const e=this._data[3*t+0],i=2097151&e;s+=2097152&e?this._combined[t]:i?(0,r.stringFromCodePoint)(i):n.WHITESPACE_CELL_CHAR,t+=e>>22||1}return s}}t.BufferLine=c},4841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}},4634:(e,t)=>{function i(e,t,i){if(t===e.length-1)return e[t].getTrimmedLength();const r=!e[t].hasContent(i-1)&&1===e[t].getWidth(i-1),n=2===e[t+1].getWidth(0);return r&&n?i-1:i}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(e,t,r,n,s){const o=[];for(let a=0;a<e.length-1;a++){let c=a,h=e.get(++c);if(!h.isWrapped)continue;const l=[e.get(a)];for(;c<e.length&&h.isWrapped;)l.push(h),h=e.get(++c);if(n>=a&&n<c){a+=l.length-1;continue}let u=0,f=i(l,u,t),d=1,p=0;for(;d<l.length;){const e=i(l,d,t),n=e-p,o=r-f,a=Math.min(n,o);l[u].copyCellsFrom(l[d],p,f,a,!1),f+=a,f===r&&(u++,f=0),p+=a,p===e&&(d++,p=0),0===f&&0!==u&&2===l[u-1].getWidth(r-1)&&(l[u].copyCellsFrom(l[u-1],r-1,f++,1,!1),l[u-1].setCell(r-1,s))}l[u].replaceCells(f,r,s);let _=0;for(let e=l.length-1;e>0&&(e>u||0===l[e].getTrimmedLength());e--)_++;_>0&&(o.push(a+l.length-_),o.push(_)),a+=l.length-1}return o},t.reflowLargerCreateNewLayout=function(e,t){const i=[];let r=0,n=t[r],s=0;for(let o=0;o<e.length;o++)if(n===o){const i=t[++r];e.onDeleteEmitter.fire({index:o-s,amount:i}),o+=i-1,s+=i,n=t[++r]}else i.push(o);return{layout:i,countRemoved:s}},t.reflowLargerApplyNewLayout=function(e,t){const i=[];for(let r=0;r<t.length;r++)i.push(e.get(t[r]));for(let t=0;t<i.length;t++)e.set(t,i[t]);e.length=t.length},t.reflowSmallerGetNewLineLengths=function(e,t,r){const n=[],s=e.map(((r,n)=>i(e,n,t))).reduce(((e,t)=>e+t));let o=0,a=0,c=0;for(;c<s;){if(s-c<r){n.push(s-c);break}o+=r;const h=i(e,a,t);o>h&&(o-=h,a++);const l=2===e[a].getWidth(o-1);l&&o--;const u=l?r-1:r;n.push(u),c+=u}return n},t.getWrappedLineTrimmedLength=i},5295:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const r=i(9092),n=i(8460),s=i(844);class o extends s.Disposable{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this.register(new n.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new r.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new r.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}t.BufferSet=o},511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const r=i(482),n=i(643),s=i(3734);class o extends s.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new s.ExtendedAttrs,this.combinedData=""}static fromCharData(e){const t=new o;return t.setFromCharData(e),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,r.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[n.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(e[n.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===e[n.CHAR_DATA_CHAR_INDEX].length){const i=e[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){const r=e[n.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(i-55296)+r-56320+65536|e[n.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=e[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[n.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=e[n.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[n.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=o},643:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const r=i(8460),n=i(844);class s{constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=s._nextId++,this._onDispose=this.register(new r.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,n.disposeArray)(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}}t.Marker=s,s._nextId=1},7116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},t.CHARSETS.A={"#":"£"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},t.CHARSETS.C=t.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},t.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},t.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},t.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},t.CHARSETS.E=t.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},t.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},t.CHARSETS.H=t.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(e,t)=>{var i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(e){e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="",e.BS="\b",e.HT="\t",e.LF="\n",e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""}(i=t.C0||(t.C0={})),(r=t.C1||(t.C1={})).PAD="",r.HOP="",r.BPH="",r.NBH="",r.IND="",r.NEL="",r.SSA="",r.ESA="",r.HTS="",r.HTJ="",r.VTS="",r.PLD="",r.PLU="",r.RI="",r.SS2="",r.SS3="",r.DCS="",r.PU1="",r.PU2="",r.STS="",r.CCH="",r.MW="",r.SPA="",r.EPA="",r.SOS="",r.SGCI="",r.SCI="",r.CSI="",r.ST="",r.OSC="",r.PM="",r.APC="",(t.C1_ESCAPED||(t.C1_ESCAPED={})).ST=`${i.ESC}\\`},7399:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const r=i(2584),n={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(e,t,i,s){const o={type:0,cancel:!1,key:void 0},a=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?o.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A":"UIKeyInputLeftArrow"===e.key?o.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D":"UIKeyInputRightArrow"===e.key?o.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(o.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B");break;case 8:if(e.altKey){o.key=r.C0.ESC+r.C0.DEL;break}o.key=r.C0.DEL;break;case 9:if(e.shiftKey){o.key=r.C0.ESC+"[Z";break}o.key=r.C0.HT,o.cancel=!0;break;case 13:o.key=e.altKey?r.C0.ESC+r.C0.CR:r.C0.CR,o.cancel=!0;break;case 27:o.key=r.C0.ESC,e.altKey&&(o.key=r.C0.ESC+r.C0.ESC),o.cancel=!0;break;case 37:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"D",o.key===r.C0.ESC+"[1;3D"&&(o.key=r.C0.ESC+(i?"b":"[1;5D"))):o.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D";break;case 39:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"C",o.key===r.C0.ESC+"[1;3C"&&(o.key=r.C0.ESC+(i?"f":"[1;5C"))):o.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C";break;case 38:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"A",i||o.key!==r.C0.ESC+"[1;3A"||(o.key=r.C0.ESC+"[1;5A")):o.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A";break;case 40:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"B",i||o.key!==r.C0.ESC+"[1;3B"||(o.key=r.C0.ESC+"[1;5B")):o.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(o.key=r.C0.ESC+"[2~");break;case 46:o.key=a?r.C0.ESC+"[3;"+(a+1)+"~":r.C0.ESC+"[3~";break;case 36:o.key=a?r.C0.ESC+"[1;"+(a+1)+"H":t?r.C0.ESC+"OH":r.C0.ESC+"[H";break;case 35:o.key=a?r.C0.ESC+"[1;"+(a+1)+"F":t?r.C0.ESC+"OF":r.C0.ESC+"[F";break;case 33:e.shiftKey?o.type=2:e.ctrlKey?o.key=r.C0.ESC+"[5;"+(a+1)+"~":o.key=r.C0.ESC+"[5~";break;case 34:e.shiftKey?o.type=3:e.ctrlKey?o.key=r.C0.ESC+"[6;"+(a+1)+"~":o.key=r.C0.ESC+"[6~";break;case 112:o.key=a?r.C0.ESC+"[1;"+(a+1)+"P":r.C0.ESC+"OP";break;case 113:o.key=a?r.C0.ESC+"[1;"+(a+1)+"Q":r.C0.ESC+"OQ";break;case 114:o.key=a?r.C0.ESC+"[1;"+(a+1)+"R":r.C0.ESC+"OR";break;case 115:o.key=a?r.C0.ESC+"[1;"+(a+1)+"S":r.C0.ESC+"OS";break;case 116:o.key=a?r.C0.ESC+"[15;"+(a+1)+"~":r.C0.ESC+"[15~";break;case 117:o.key=a?r.C0.ESC+"[17;"+(a+1)+"~":r.C0.ESC+"[17~";break;case 118:o.key=a?r.C0.ESC+"[18;"+(a+1)+"~":r.C0.ESC+"[18~";break;case 119:o.key=a?r.C0.ESC+"[19;"+(a+1)+"~":r.C0.ESC+"[19~";break;case 120:o.key=a?r.C0.ESC+"[20;"+(a+1)+"~":r.C0.ESC+"[20~";break;case 121:o.key=a?r.C0.ESC+"[21;"+(a+1)+"~":r.C0.ESC+"[21~";break;case 122:o.key=a?r.C0.ESC+"[23;"+(a+1)+"~":r.C0.ESC+"[23~";break;case 123:o.key=a?r.C0.ESC+"[24;"+(a+1)+"~":r.C0.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if(i&&!s||!e.altKey||e.metaKey)!i||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&1===e.key.length?o.key=e.key:e.key&&e.ctrlKey&&("_"===e.key&&(o.key=r.C0.US),"@"===e.key&&(o.key=r.C0.NUL)):65===e.keyCode&&(o.type=1);else{const t=n[e.keyCode],i=null==t?void 0:t[e.shiftKey?1:0];if(i)o.key=r.C0.ESC+i;else if(e.keyCode>=65&&e.keyCode<=90){const t=e.ctrlKey?e.keyCode-64:e.keyCode+32;let i=String.fromCharCode(t);e.shiftKey&&(i=i.toUpperCase()),o.key=r.C0.ESC+i}else if(32===e.keyCode)o.key=r.C0.ESC+(e.ctrlKey?r.C0.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let t=e.code.slice(3,4);e.shiftKey||(t=t.toLowerCase()),o.key=r.C0.ESC+t,o.cancel=!0}}else e.keyCode>=65&&e.keyCode<=90?o.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?o.key=r.C0.NUL:e.keyCode>=51&&e.keyCode<=55?o.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?o.key=r.C0.DEL:219===e.keyCode?o.key=r.C0.ESC:220===e.keyCode?o.key=r.C0.FS:221===e.keyCode&&(o.key=r.C0.GS)}return o}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10))+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)},t.utf32ToString=function(e,t=0,i=e.length){let r="";for(let n=t;n<i;++n){let t=e[n];t>65535?(t-=65536,r+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):r+=String.fromCharCode(t)}return r},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){const i=e.length;if(!i)return 0;let r=0,n=0;if(this._interim){const i=e.charCodeAt(n++);56320<=i&&i<=57343?t[r++]=1024*(this._interim-55296)+i-56320+65536:(t[r++]=this._interim,t[r++]=i),this._interim=0}for(let s=n;s<i;++s){const n=e.charCodeAt(s);if(55296<=n&&n<=56319){if(++s>=i)return this._interim=n,r;const o=e.charCodeAt(s);56320<=o&&o<=57343?t[r++]=1024*(n-55296)+o-56320+65536:(t[r++]=n,t[r++]=o)}else 65279!==n&&(t[r++]=n)}return r}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){const i=e.length;if(!i)return 0;let r,n,s,o,a=0,c=0,h=0;if(this.interim[0]){let r=!1,n=this.interim[0];n&=192==(224&n)?31:224==(240&n)?15:7;let s,o=0;for(;(s=63&this.interim[++o])&&o<4;)n<<=6,n|=s;const c=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,l=c-o;for(;h<l;){if(h>=i)return 0;if(s=e[h++],128!=(192&s)){h--,r=!0;break}this.interim[o++]=s,n<<=6,n|=63&s}r||(2===c?n<128?h--:t[a++]=n:3===c?n<2048||n>=55296&&n<=57343||65279===n||(t[a++]=n):n<65536||n>1114111||(t[a++]=n)),this.interim.fill(0)}const l=i-4;let u=h;for(;u<i;){for(;!(!(u<l)||128&(r=e[u])||128&(n=e[u+1])||128&(s=e[u+2])||128&(o=e[u+3]));)t[a++]=r,t[a++]=n,t[a++]=s,t[a++]=o,u+=4;if(r=e[u++],r<128)t[a++]=r;else if(192==(224&r)){if(u>=i)return this.interim[0]=r,a;if(n=e[u++],128!=(192&n)){u--;continue}if(c=(31&r)<<6|63&n,c<128){u--;continue}t[a++]=c}else if(224==(240&r)){if(u>=i)return this.interim[0]=r,a;if(n=e[u++],128!=(192&n)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=n,a;if(s=e[u++],128!=(192&s)){u--;continue}if(c=(15&r)<<12|(63&n)<<6|63&s,c<2048||c>=55296&&c<=57343||65279===c)continue;t[a++]=c}else if(240==(248&r)){if(u>=i)return this.interim[0]=r,a;if(n=e[u++],128!=(192&n)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=n,a;if(s=e[u++],128!=(192&s)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=n,this.interim[2]=s,a;if(o=e[u++],128!=(192&o)){u--;continue}if(c=(7&r)<<18|(63&n)<<12|(63&s)<<6|63&o,c<65536||c>1114111)continue;t[a++]=c}}return a}}},225:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const i=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],r=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let n;t.UnicodeV6=class{constructor(){if(this.version="6",!n){n=new Uint8Array(65536),n.fill(1),n[0]=0,n.fill(0,1,32),n.fill(0,127,160),n.fill(2,4352,4448),n[9001]=2,n[9002]=2,n.fill(2,11904,42192),n[12351]=1,n.fill(2,44032,55204),n.fill(2,63744,64256),n.fill(2,65040,65050),n.fill(2,65072,65136),n.fill(2,65280,65377),n.fill(2,65504,65511);for(let e=0;e<i.length;++e)n.fill(0,i[e][0],i[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?n[e]:function(e,t){let i,r=0,n=t.length-1;if(e<t[0][0]||e>t[n][1])return!1;for(;n>=r;)if(i=r+n>>1,e>t[i][1])r=i+1;else{if(!(e<t[i][0]))return!0;n=i-1}return!1}(e,r)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}}},5981:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const r=i(8460),n=i(844);class s extends n.Disposable{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new r.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(void 0!==t&&this._syncCalls>t)return void(this._syncCalls=0);if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let i;for(this._isSyncWriting=!0;i=this._writeBuffer.shift();){this._action(i);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){const i=e||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],r=this._action(e,t);if(r){const e=e=>Date.now()-i>=12?setTimeout((()=>this._innerWrite(0,e))):this._innerWrite(i,e);return void r.catch((e=>(queueMicrotask((()=>{throw e})),Promise.resolve(!1)))).then(e)}const n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-i>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=s},5941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const i=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,r=/^[\da-f]+$/;function n(e,t){const i=e.toString(16),r=i.length<2?"0"+i:i;switch(t){case 4:return i[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}t.parseColor=function(e){if(!e)return;let t=e.toLowerCase();if(0===t.indexOf("rgb:")){t=t.slice(4);const e=i.exec(t);if(e){const t=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/t*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/t*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/t*255)]}}else if(0===t.indexOf("#")&&(t=t.slice(1),r.exec(t)&&[3,6,9,12].includes(t.length))){const e=t.length/3,i=[0,0,0];for(let r=0;r<3;++r){const n=parseInt(t.slice(e*r,e*r+e),16);i[r]=1===e?n<<4:2===e?n:3===e?n>>4:n>>8}return i}},t.toRgbString=function(e,t=16){const[i,r,s]=e;return`rgb:${n(i,t)}/${n(r,t)}/${n(s,t)}`}},5770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const r=i(482),n=i(8742),s=i(5770),o=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=o,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=o,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||o,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(t);else this._handlerFb(this._ident,"HOOK",t)}put(e,t,i){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i);else this._handlerFb(this._ident,"PUT",(0,r.utf32ToString)(e,t,i))}unhook(e,t=!0){if(this._active.length){let i=!1,r=this._active.length-1,n=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,n=this._stack.fallThrough,this._stack.paused=!1),!n&&!1===i){for(;r>=0&&(i=this._active[r].unhook(e),!0!==i);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}else this._handlerFb(this._ident,"UNHOOK",e);this._active=o,this._ident=0}};const a=new n.Params;a.addParam(0),t.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=a,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():a,this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,r.utf32ToString)(e,t,i),this._data.length>s.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then((e=>(this._params=a,this._data="",this._hitLimit=!1,e)));return this._params=a,this._data="",this._hitLimit=!1,t}}},2015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const r=i(844),n=i(8742),s=i(6242),o=i(6351);class a{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,i,r){this.table[t<<8|e]=i<<4|r}addMany(e,t,i,r){for(let n=0;n<e.length;n++)this.table[t<<8|e[n]]=i<<4|r}}t.TransitionTable=a;const c=160;t.VT500_TRANSITION_TABLE=function(){const e=new a(4095),t=Array.apply(null,Array(256)).map(((e,t)=>t)),i=(e,i)=>t.slice(e,i),r=i(32,127),n=i(0,24);n.push(25),n.push.apply(n,i(28,32));const s=i(0,14);let o;for(o in e.setDefault(1,0),e.addMany(r,0,2,0),s)e.addMany([24,26,153,154],o,3,0),e.addMany(i(128,144),o,3,0),e.addMany(i(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(n,0,3,0),e.addMany(n,1,3,1),e.add(127,1,0,1),e.addMany(n,8,0,8),e.addMany(n,3,3,3),e.add(127,3,0,3),e.addMany(n,4,3,4),e.add(127,4,0,4),e.addMany(n,6,3,6),e.addMany(n,5,3,5),e.add(127,5,0,5),e.addMany(n,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(i(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(n,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(i(64,127),3,7,0),e.addMany(i(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(i(48,60),4,8,4),e.addMany(i(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(i(32,64),6,0,6),e.add(127,6,0,6),e.addMany(i(64,127),6,0,0),e.addMany(i(32,48),3,9,5),e.addMany(i(32,48),5,9,5),e.addMany(i(48,64),5,0,6),e.addMany(i(64,127),5,7,0),e.addMany(i(32,48),4,9,5),e.addMany(i(32,48),1,9,2),e.addMany(i(32,48),2,9,2),e.addMany(i(48,127),2,10,0),e.addMany(i(48,80),1,10,0),e.addMany(i(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(i(96,127),1,10,0),e.add(80,1,11,9),e.addMany(n,9,0,9),e.add(127,9,0,9),e.addMany(i(28,32),9,0,9),e.addMany(i(32,48),9,9,12),e.addMany(i(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(n,11,0,11),e.addMany(i(32,128),11,0,11),e.addMany(i(28,32),11,0,11),e.addMany(n,10,0,10),e.add(127,10,0,10),e.addMany(i(28,32),10,0,10),e.addMany(i(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(i(32,48),10,9,12),e.addMany(n,12,0,12),e.add(127,12,0,12),e.addMany(i(28,32),12,0,12),e.addMany(i(32,48),12,9,12),e.addMany(i(48,64),12,0,11),e.addMany(i(64,127),12,12,13),e.addMany(i(64,127),10,12,13),e.addMany(i(64,127),9,12,13),e.addMany(n,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(c,0,2,0),e.add(c,8,5,8),e.add(c,6,0,6),e.add(c,11,0,11),e.add(c,13,13,13),e}();class h extends r.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new n.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(e,t,i)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,r.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new s.OscParser),this._dcsParser=this.register(new o.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(e,t=[64,126]){let i=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=e.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let t=0;t<e.intermediates.length;++t){const r=e.intermediates.charCodeAt(t);if(32>r||r>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=r}}if(1!==e.final.length)throw new Error("final must be a single byte");const r=e.final.charCodeAt(0);if(t[0]>r||r>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=r,i}identToString(e){const t=[];for(;e;)t.push(String.fromCharCode(255&e)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){const i=this._identifier(e,[48,126]);void 0===this._escHandlers[i]&&(this._escHandlers[i]=[]);const r=this._escHandlers[i];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){const i=this._identifier(e);void 0===this._csiHandlers[i]&&(this._csiHandlers[i]=[]);const r=this._csiHandlers[i];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,i,r,n){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=r,this._parseStack.chunkPos=n}parse(e,t,i){let r,n=0,s=0,o=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,o=this._parseStack.chunkPos+1;else{if(void 0===i||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const t=this._parseStack.handlers;let s=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===i&&s>-1)for(;s>=0&&(r=t[s](this._params),!0!==r);s--)if(r instanceof Promise)return this._parseStack.handlerPos=s,r;this._parseStack.handlers=[];break;case 4:if(!1===i&&s>-1)for(;s>=0&&(r=t[s](),!0!==r);s--)if(r instanceof Promise)return this._parseStack.handlerPos=s,r;this._parseStack.handlers=[];break;case 6:if(n=e[this._parseStack.chunkPos],r=this._dcsParser.unhook(24!==n&&26!==n,i),r)return r;27===n&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(n=e[this._parseStack.chunkPos],r=this._oscParser.end(24!==n&&26!==n,i),r)return r;27===n&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,o=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let i=o;i<t;++i){switch(n=e[i],s=this._transitions.table[this.currentState<<8|(n<160?n:c)],s>>4){case 2:for(let r=i+1;;++r){if(r>=t||(n=e[r])<32||n>126&&n<c){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(n=e[r])<32||n>126&&n<c){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(n=e[r])<32||n>126&&n<c){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(n=e[r])<32||n>126&&n<c){this._printHandler(e,i,r),i=r-1;break}}break;case 3:this._executeHandlers[n]?this._executeHandlers[n]():this._executeHandlerFb(n),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:i,code:n,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const o=this._csiHandlers[this._collect<<8|n];let a=o?o.length-1:-1;for(;a>=0&&(r=o[a](this._params),!0!==r);a--)if(r instanceof Promise)return this._preserveStack(3,o,a,s,i),r;a<0&&this._csiHandlerFb(this._collect<<8|n,this._params),this.precedingCodepoint=0;break;case 8:do{switch(n){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(n-48)}}while(++i<t&&(n=e[i])>47&&n<60);i--;break;case 9:this._collect<<=8,this._collect|=n;break;case 10:const h=this._escHandlers[this._collect<<8|n];let l=h?h.length-1:-1;for(;l>=0&&(r=h[l](),!0!==r);l--)if(r instanceof Promise)return this._preserveStack(4,h,l,s,i),r;l<0&&this._escHandlerFb(this._collect<<8|n),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|n,this._params);break;case 13:for(let r=i+1;;++r)if(r>=t||24===(n=e[r])||26===n||27===n||n>127&&n<c){this._dcsParser.put(e,i,r),i=r-1;break}break;case 14:if(r=this._dcsParser.unhook(24!==n&&26!==n),r)return this._preserveStack(6,[],0,s,i),r;27===n&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let r=i+1;;r++)if(r>=t||(n=e[r])<32||n>127&&n<c){this._oscParser.put(e,i,r),i=r-1;break}break;case 6:if(r=this._oscParser.end(24!==n&&26!==n),r)return this._preserveStack(5,[],0,s,i),r;27===n&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&s}}}t.EscapeSequenceParser=h},6242:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const r=i(5770),n=i(482),s=[];t.OscParser=class{constructor(){this._state=0,this._active=s,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=s}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=s,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||s,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,t,i){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i);else this._handlerFb(this._id,"PUT",(0,n.utf32ToString)(e,t,i))}start(){this.reset(),this._state=1}put(e,t,i){if(3!==this._state){if(1===this._state)for(;t<i;){const i=e[t++];if(59===i){this._state=2,this._start();break}if(i<48||57<i)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+i-48}2===this._state&&i-t>0&&this._put(e,t,i)}}end(e,t=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let i=!1,r=this._active.length-1,n=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,n=this._stack.fallThrough,this._stack.paused=!1),!n&&!1===i){for(;r>=0&&(i=this._active[r].end(e),!0!==i);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].end(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}else this._handlerFb(this._id,"END",e);this._active=s,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,n.utf32ToString)(e,t,i),this._data.length>r.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then((e=>(this._data="",this._hitLimit=!1,e)));return this._data="",this._hitLimit=!1,t}}},8742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const i=2147483647;class r{constructor(e=32,t=32){if(this.maxLength=e,this.maxSubParamsLength=t,t>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(t),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(e){const t=new r;if(!e.length)return t;for(let i=Array.isArray(e[0])?1:0;i<e.length;++i){const r=e[i];if(Array.isArray(r))for(let e=0;e<r.length;++e)t.addSubParam(r[e]);else t.addParam(r)}return t}clone(){const e=new r(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){const e=[];for(let t=0;t<this.length;++t){e.push(this.params[t]);const i=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-i>0&&e.push(Array.prototype.slice.call(this._subParams,i,r))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>i?i:e}}addSubParam(e){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>i?i:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){const t=this._subParamsIdx[e]>>8,i=255&this._subParamsIdx[e];return i-t>0?this._subParams.subarray(t,i):null}getSubParamsAll(){const e={};for(let t=0;t<this.length;++t){const i=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-i>0&&(e[t]=this._subParams.slice(i,r))}return e}addDigit(e){let t;if(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const r=this._digitIsSub?this._subParams:this.params,n=r[t-1];r[t-1]=~n?Math.min(10*n+e,i):e}}t.Params=r},5741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){const i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=()=>this._wrappedAddonDispose(i),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let i=0;i<this._addons.length;i++)if(this._addons[i]===e){t=i;break}if(-1===t)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}}},8771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const r=i(3785),n=i(511);t.BufferApiView=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){const t=this._buffer.lines.get(e);if(t)return new r.BufferLineApiView(t)}getNullCell(){return new n.CellData}}},3785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const r=i(511);t.BufferLineApiView=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new r.CellData)}translateToString(e,t,i){return this._line.translateToString(e,t,i)}}},8285:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const r=i(8771),n=i(8460);t.BufferNamespaceApi=class{constructor(e){this._core=e,this._onBufferChange=new n.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new r.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new r.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,(e=>t(e.toArray())))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,((e,i)=>t(e,i.toArray())))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}}},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}}},744:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const s=i(2585),o=i(5295),a=i(8460),c=i(844);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let h=class extends c.Disposable{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new a.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new a.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new o.BufferSet(e,this))}get buffer(){return this.buffers.active}resize(e,t){this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){const i=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===e.fg&&r.getBg(0)===e.bg||(r=i.getBlankLine(e,t),this._cachedBlankLine=r),r.isWrapped=t;const n=i.ybase+i.scrollTop,s=i.ybase+i.scrollBottom;if(0===i.scrollTop){const e=i.lines.isFull;s===i.lines.length-1?e?i.lines.recycle().copyFrom(r):i.lines.push(r.clone()):i.lines.splice(s+1,0,r.clone()),e?this.isUserScrolling&&(i.ydisp=Math.max(i.ydisp-1,0)):(i.ybase++,this.isUserScrolling||i.ydisp++)}else{const e=s-n+1;i.lines.shiftElements(n+1,e-1,-1),i.lines.set(s,r.clone())}this.isUserScrolling||(i.ydisp=i.ybase),this._onScroll.fire(i.ydisp)}scrollLines(e,t,i){const r=this.buffer;if(e<0){if(0===r.ydisp)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const n=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),n!==r.ydisp&&(t||this._onScroll.fire(r.ydisp))}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(e){const t=e-this.buffer.ydisp;0!==t&&this.scrollLines(t)}};h=r([n(0,s.IOptionsService)],h),t.BufferService=h},7994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}}},1753:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const s=i(2585),o=i(8460),a=i(844),c={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function h(e,t){let i=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return 4===e.button?(i|=64,i|=e.action):(i|=3&e.button,4&e.button&&(i|=64),8&e.button&&(i|=128),32===e.action?i|=32:0!==e.action||t||(i|=3)),i}const l=String.fromCharCode,u={DEFAULT:e=>{const t=[h(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`[M${l(t[0])}${l(t[1])}${l(t[2])}`},SGR:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${h(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${h(e,!0)};${e.x};${e.y}${t}`}};let f=class extends a.Disposable{constructor(e,t){super(),this._bufferService=e,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new o.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const e of Object.keys(c))this.addProtocol(e,c[e]);for(const e of Object.keys(u))this.addEncoding(e,u[e]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows)return!1;if(4===e.button&&32===e.action)return!1;if(3===e.button&&32!==e.action)return!1;if(4!==e.button&&(2===e.action||3===e.action))return!1;if(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(e))return!1;const t=this._encodings[this._activeEncoding](e);return t&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,t,i){if(i){if(e.x!==t.x)return!1;if(e.y!==t.y)return!1}else{if(e.col!==t.col)return!1;if(e.row!==t.row)return!1}return e.button===t.button&&e.action===t.action&&e.ctrl===t.ctrl&&e.alt===t.alt&&e.shift===t.shift}};f=r([n(0,s.IBufferService),n(1,s.ICoreService)],f),t.CoreMouseService=f},6975:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const s=i(2585),o=i(8460),a=i(1439),c=i(844),h=Object.freeze({insertMode:!1}),l=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let u=class extends c.Disposable{constructor(e,t,i){super(),this._bufferService=e,this._logService=t,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new o.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new o.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new o.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new o.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,a.clone)(h),this.decPrivateModes=(0,a.clone)(l)}reset(){this.modes=(0,a.clone)(h),this.decPrivateModes=(0,a.clone)(l)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const i=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&i.ybase!==i.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onBinary.fire(e))}};u=r([n(0,s.IBufferService),n(1,s.ILogService),n(2,s.IOptionsService)],u),t.CoreService=u},9074:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const r=i(8055),n=i(8460),s=i(844),o=i(6106);let a=0,c=0;class h extends s.Disposable{constructor(){super(),this._decorations=new o.SortedList((e=>null==e?void 0:e.marker.line)),this._onDecorationRegistered=this.register(new n.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new n.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,s.toDisposable)((()=>{for(const e of this._decorations.values())this._onDecorationRemoved.fire(e);this.reset()})))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;const t=new l(e);if(t){const e=t.marker.onDispose((()=>t.dispose()));t.onDispose((()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),e.dispose())})),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,i){var r,n,s;let o=0,a=0;for(const c of this._decorations.getKeyIterator(t))o=null!==(r=c.options.x)&&void 0!==r?r:0,a=o+(null!==(n=c.options.width)&&void 0!==n?n:1),e>=o&&e<a&&(!i||(null!==(s=c.options.layer)&&void 0!==s?s:"bottom")===i)&&(yield c)}forEachDecorationAtCell(e,t,i,r){this._decorations.forEachByKey(t,(t=>{var n,s,o;a=null!==(n=t.options.x)&&void 0!==n?n:0,c=a+(null!==(s=t.options.width)&&void 0!==s?s:1),e>=a&&e<c&&(!i||(null!==(o=t.options.layer)&&void 0!==o?o:"bottom")===i)&&r(t)}))}dispose(){for(const e of this._decorations.values())this._onDecorationRemoved.fire(e);this.reset()}}t.DecorationService=h;class l extends s.Disposable{constructor(e){super(),this.options=e,this.isDisposed=!1,this.onRenderEmitter=this.register(new n.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new n.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=r.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=r.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const r=i(2585),n=i(8343);class s{constructor(...e){this._entries=new Map;for(const[t,i]of e)this.set(t,i)}set(e,t){const i=this._entries.get(e);return this._entries.set(e,t),i}forEach(e){for(const[t,i]of this._entries.entries())e(t,i)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}t.ServiceCollection=s,t.InstantiationService=class{constructor(){this._services=new s,this._services.set(r.IInstantiationService,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){const i=(0,n.getServiceDependencies)(e).sort(((e,t)=>e.index-t.index)),r=[];for(const t of i){const i=this._services.get(t.id);if(!i)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${t.id}.`);r.push(i)}const s=i.length>0?i[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...[...t,...r])}}},7866:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogService=void 0;const s=i(844),o=i(2585),a={debug:o.LogLevelEnum.DEBUG,info:o.LogLevelEnum.INFO,warn:o.LogLevelEnum.WARN,error:o.LogLevelEnum.ERROR,off:o.LogLevelEnum.OFF};let c=class extends s.Disposable{constructor(e){super(),this._optionsService=e,this.logLevel=o.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel())))}_updateLogLevel(){this.logLevel=a[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)"function"==typeof e[t]&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,"xterm.js: "+t,...i)}debug(e,...t){this.logLevel<=o.LogLevelEnum.DEBUG&&this._log(console.log,e,t)}info(e,...t){this.logLevel<=o.LogLevelEnum.INFO&&this._log(console.info,e,t)}warn(e,...t){this.logLevel<=o.LogLevelEnum.WARN&&this._log(console.warn,e,t)}error(e,...t){this.logLevel<=o.LogLevelEnum.ERROR&&this._log(console.error,e,t)}};c=r([n(0,o.IOptionsService)],c),t.LogService=c},7302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const r=i(8460),n=i(6114),s=i(844);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const o=["normal","bold","100","200","300","400","500","600","700","800","900"];class a extends s.Disposable{constructor(e){super(),this._onOptionChange=this.register(new r.EventEmitter),this.onOptionChange=this._onOptionChange.event;const i=Object.assign({},t.DEFAULT_OPTIONS);for(const t in e)if(t in i)try{const r=e[t];i[t]=this._sanitizeAndValidateOption(t,r)}catch(e){console.error(e)}this.rawOptions=i,this.options=Object.assign({},i),this._setupOptions()}onSpecificOptionChange(e,t){return this.onOptionChange((i=>{i===e&&t(this.rawOptions[e])}))}onMultipleOptionChange(e,t){return this.onOptionChange((i=>{-1!==e.indexOf(i)&&t()}))}_setupOptions(){const e=e=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},i=(e,i)=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);i=this._sanitizeAndValidateOption(e,i),this.rawOptions[e]!==i&&(this.rawOptions[e]=i,this._onOptionChange.fire(e))};for(const t in this.rawOptions){const r={get:e.bind(this,t),set:i.bind(this,t)};Object.defineProperty(this.options,t,r)}}_sanitizeAndValidateOption(e,i){switch(e){case"cursorStyle":if(i||(i=t.DEFAULT_OPTIONS[e]),!function(e){return"block"===e||"underline"===e||"bar"===e}(i))throw new Error(`"${i}" is not a valid value for ${e}`);break;case"wordSeparator":i||(i=t.DEFAULT_OPTIONS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof i&&1<=i&&i<=1e3)break;i=o.includes(i)?i:t.DEFAULT_OPTIONS[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error(`${e} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,4294967295))<0)throw new Error(`${e} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${i}`);case"rows":case"cols":if(!i&&0!==i)throw new Error(`${e} must be numeric, value: ${i}`)}return i}}t.OptionsService=a},2660:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const s=i(2585);let o=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){const t=this._bufferService.buffer;if(void 0===e.id){const i=t.addMarker(t.ybase+t.y),r={data:e,id:this._nextId++,lines:[i]};return i.onDispose((()=>this._removeMarkerFromLink(r,i))),this._dataByLinkId.set(r.id,r),r.id}const i=e,r=this._getEntryIdKey(i),n=this._entriesWithId.get(r);if(n)return this.addLineToLink(n.id,t.ybase+t.y),n.id;const s=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(i),data:i,lines:[s]};return s.onDispose((()=>this._removeMarkerFromLink(o,s))),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){const i=this._dataByLinkId.get(e);if(i&&i.lines.every((e=>e.line!==t))){const e=this._bufferService.buffer.addMarker(t);i.lines.push(e),e.onDispose((()=>this._removeMarkerFromLink(i,e)))}}getLinkData(e){var t;return null===(t=this._dataByLinkId.get(e))||void 0===t?void 0:t.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){const i=e.lines.indexOf(t);-1!==i&&(e.lines.splice(i,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};o=r([n(0,s.IBufferService)],o),t.OscLinkService=o},8343:(e,t)=>{function i(e,t,i){t.di$target===t?t.di$dependencies.push({id:e,index:i}):(t.di$dependencies=[{id:e,index:i}],t.di$target=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0,t.serviceRegistry=new Map,t.getServiceDependencies=function(e){return e.di$dependencies||[]},t.createDecorator=function(e){if(t.serviceRegistry.has(e))return t.serviceRegistry.get(e);const r=function(e,t,n){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");i(r,e,n)};return r.toString=()=>e,t.serviceRegistry.set(e,r),r}},2585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const r=i(8343);var n;t.IBufferService=(0,r.createDecorator)("BufferService"),t.ICoreMouseService=(0,r.createDecorator)("CoreMouseService"),t.ICoreService=(0,r.createDecorator)("CoreService"),t.ICharsetService=(0,r.createDecorator)("CharsetService"),t.IInstantiationService=(0,r.createDecorator)("InstantiationService"),(n=t.LogLevelEnum||(t.LogLevelEnum={}))[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n[n.OFF=4]="OFF",t.ILogService=(0,r.createDecorator)("LogService"),t.IOptionsService=(0,r.createDecorator)("OptionsService"),t.IOscLinkService=(0,r.createDecorator)("OscLinkService"),t.IUnicodeService=(0,r.createDecorator)("UnicodeService"),t.IDecorationService=(0,r.createDecorator)("DecorationService")},1480:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const r=i(8460),n=i(225);t.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new r.EventEmitter,this.onChange=this._onChange.event;const e=new n.UnicodeV6;this.register(e),this._active=e.version,this._activeProvider=e}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let t=0;const i=e.length;for(let r=0;r<i;++r){let n=e.charCodeAt(r);if(55296<=n&&n<=56319){if(++r>=i)return t+this.wcwidth(n);const s=e.charCodeAt(r);56320<=s&&s<=57343?n=1024*(n-55296)+s-56320+65536:t+=this.wcwidth(s)}t+=this.wcwidth(n)}return t}}}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const t=i(3236),n=i(9042),s=i(7975),o=i(7090),a=i(5741),c=i(8285),h=["cols","rows"];e.Terminal=class{constructor(e){this._core=new t.Terminal(e),this._addonManager=new a.AddonManager,this._publicOptions=Object.assign({},this._core.options);const i=e=>this._core.options[e],r=(e,t)=>{this._checkReadonlyOptions(e),this._core.options[e]=t};for(const e in this._core.options){const t={get:i.bind(this,e),set:r.bind(this,e)};Object.defineProperty(this._publicOptions,e,t)}}_checkReadonlyOptions(e){if(h.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new s.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new o.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new c.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const e=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(const t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.addMarker(e)}registerDecoration(e){var t,i,r;return this._checkProposedApi(),this._verifyPositiveIntegers(null!==(t=e.x)&&void 0!==t?t:0,null!==(i=e.width)&&void 0!==i?i:0,null!==(r=e.height)&&void 0!==r?r:0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,i){this._verifyIntegers(e,t,i),this._core.select(e,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write("\r\n",t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){return this._addonManager.loadAddon(this,e)}static get strings(){return n}_verifyIntegers(...e){for(const t of e)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(const t of e)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}})(),r})()})),We=Me($e),qe=Pe((function(e,t){var i,r;self,e.exports=(i=r={},Object.defineProperty(i,"__esModule",{value:!0}),i.FitAddon=void 0,void(i.FitAddon=class{constructor(){}activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const i=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),n=parseInt(r.getPropertyValue("height")),s=Math.max(0,parseInt(r.getPropertyValue("width"))),o=window.getComputedStyle(this._terminal.element),a=n-(parseInt(o.getPropertyValue("padding-top"))+parseInt(o.getPropertyValue("padding-bottom"))),c=s-(parseInt(o.getPropertyValue("padding-right"))+parseInt(o.getPropertyValue("padding-left")))-i;return{cols:Math.max(2,Math.floor(c/t.css.cell.width)),rows:Math.max(1,Math.floor(a/t.css.cell.height))}}}),r)}));function Ke(t){let i;return{c(){i=b("div"),L(i,"class","main svelte-6e1gei"),D(i,"background-color",t[1].background)},m(e,r){m(e,i,r),t[2](i)},p:e,i:e,o:e,d(e){e&&S(i),t[2](null)}}}Ue.configure({fs:"InMemory"},(()=>{Re.set(!0)})),Re.subscribe((e=>{if(e){ze.mkdirSync("/projects");for(let e of ye)ze.writeFileSync("/projects/"+ve(e).fileName,e.description);ze.writeFileSync("/README.txt",'wow u found me :O\r\nuse "enable-gravity"')}}));class Ve{activate(e){this._terminal=e,e.loadWebfontAndOpen=e=>{const t=this._terminal.options.fontFamily,i=new He(t).load(),r=new He(t,{weight:"bold"}).load();return i.constructor.all([i,r]).then((()=>(this._terminal.open(e),this)),(()=>(this._terminal.options.fontFamily="Courier",this._terminal.open(e),this)))}}dispose(){delete this._terminal.loadWebfontAndOpen}}function Xe(e,t,i){const r=new We.Terminal({fontFamily:"Roboto Mono"}),n=new qe.FitAddon;let s;r.loadAddon(n),r.loadAddon(new Ve);let o=0,a="/",c={vx:0,vy:0,enabled:!1,gravity:600,interval:null};function h(){r.write(`user@ianhuang.dev ${a} % `,(()=>{o=r.buffer.active.cursorX}))}function u(e){try{e()}catch(e){if(e.message)return void r.writeln(e.message);r.writeln("An unknown error occurred")}}T((()=>{r.loadWebfontAndOpen(s),n.fit(),h(),r.onData((e=>{switch(e){case"":r.write("^C");break;case"\r":!function(e){if(r.write("\r\n"),!l(Re))return void r.writeln("error: wait for filesystem to initialize");console.log(e);let t=e.split(" ").filter((e=>e.length)),i=t.slice(1),n=t[0];if(n)switch(n){case"ls":u((()=>{var e;let t=s(null!==(e=i[0])&&void 0!==e?e:a);for(let e of ze.readdirSync(t))r.writeln(e)}));break;case"cd":u((()=>{var e;let t=s(null!==(e=i[0])&&void 0!==e?e:a);ze.existsSync(t)?ze.lstatSync(t).isDirectory()?a=je.resolve(t):r.writeln("Not a directory: "+t):r.writeln("No such directory: "+t)}));break;case"cat":u((()=>{if(!i[0])return;let e=s(i[0]);r.writeln(ze.readFileSync(e,"utf-8"))}));break;case"enable-gravity":let e=l(De);if(c.enabled){r.writeln("gravity is already enabled lmao");break}c.enabled=!0;const t=20,o=t/1e3;c.vx+=400*(Math.random()-.5),c.interval=window.setInterval((()=>{let{x:t,y:i}=e.getPosition();c.vy+=c.gravity*o,t+=c.vx*o,i+=c.vy*o,i+e.getDimensions().height>window.innerHeight&&(c.vy*=-1),t+e.getDimensions().width>window.innerWidth&&(c.vx*=-1),t<0&&(c.vx*=-1),e.setPosition(t,i)}),t);break;default:r.writeln(`Unrecognized command "${n}"`)}function s(e){return je.resolve(a,e)}}(r.buffer.active.getLine(r.buffer.active.cursorY).translateToString(!0).slice(o)),h();break;case"":r.buffer.active.cursorX>o&&r.write("\b \b");break;default:1===e.length&&r.write(e)}}))}));const f={foreground:"#F8F8F8",background:"#2D2E2C",selection:"#5DA5D533",black:"#1E1E1D",brightBlack:"#262625",red:"#CE5C5C",brightRed:"#FF7272",green:"#5BCC5B",brightGreen:"#72FF72",yellow:"#CCCC5B",brightYellow:"#FFFF72",blue:"#5D5DD3",brightBlue:"#7279FF",magenta:"#BC5ED1",brightMagenta:"#E572FF",cyan:"#5DA5D5",brightCyan:"#72F0FF",white:"#F8F8F8",brightWhite:"#FFFFFF"};return r.options.theme=f,[s,f,function(e){B[e?"unshift":"push"]((()=>{s=e,i(0,s)}))}]}class Ye extends J{constructor(e){super(),G(this,e,Xe,Ke,s,{})}}function Ze(e){let t,i,n,s,o,a,c,h,l,u,d,w,x,A,T,I,O,B,F;const M=e[15].default,P=f(M,e,e[14],null);return{c(){t=b("div"),i=b("div"),n=b("div"),s=b("div"),a=C(),c=b("div"),l=C(),u=b("div"),w=C(),x=b("div"),A=E(e[8]),T=C(),I=b("div"),P&&P.c(),L(s,"class",o=v(e[11]+" close")+" svelte-7s3tri"),L(c,"class",h=v(e[11]+" minimize")+" svelte-7s3tri"),L(u,"class",d=v(e[11]+" maximize")+" svelte-7s3tri"),L(n,"class","buttons svelte-7s3tri"),L(x,"class","title svelte-7s3tri"),L(i,"class","header svelte-7s3tri"),L(I,"class","window-container svelte-7s3tri"),L(t,"class","window svelte-7s3tri"),D(t,"top",e[5]+"px"),D(t,"left",e[6]+"px"),D(t,"width",e[3]+"px"),D(t,"height",null!==e[4]?e[4]+"px":"auto"),D(t,"visibility",e[7]?"visible":"hidden"),D(t,"z-index",e[2])},m(r,o){m(r,t,o),y(t,i),y(i,n),y(n,s),y(n,a),y(n,c),y(n,l),y(n,u),y(i,w),y(i,x),y(x,A),y(t,T),y(t,I),P&&P.m(I,null),O=!0,B||(F=[k(s,"click",e[16]),k(c,"click",e[17]),k(u,"click",e[18]),k(i,"mousedown",e[19]),k(t,"click",e[20])],B=!0)},p(e,[i]){(!O||2048&i&&o!==(o=v(e[11]+" close")+" svelte-7s3tri"))&&L(s,"class",o),(!O||2048&i&&h!==(h=v(e[11]+" minimize")+" svelte-7s3tri"))&&L(c,"class",h),(!O||2048&i&&d!==(d=v(e[11]+" maximize")+" svelte-7s3tri"))&&L(u,"class",d),(!O||256&i)&&R(A,e[8]),P&&P.p&&(!O||16384&i)&&_(P,M,e,e[14],O?p(M,e[14],i,null):g(e[14]),null),32&i&&D(t,"top",e[5]+"px"),64&i&&D(t,"left",e[6]+"px"),8&i&&D(t,"width",e[3]+"px"),16&i&&D(t,"height",null!==e[4]?e[4]+"px":"auto"),128&i&&D(t,"visibility",e[7]?"visible":"hidden"),4&i&&D(t,"z-index",e[2])},i(e){O||(q(P,e),O=!0)},o(e){K(P,e),O=!1},d(e){e&&S(t),P&&P.d(e),B=!1,r(F)}}}function Ge(e,t,i){let r,n,s;u(e,Ce,(e=>i(13,s=e)));let{$$slots:o={},$$scope:a}=t;var c,h,f,d,p;let _,g,v,y,{config:m}=t,S=null===(c=m.visible)||void 0===c||c,w=null!==(h=m.title)&&void 0!==h?h:"";Ce.update((e=>e+1));let b=l(Ce);const E=Math.random().toString(36);let C=!1,k={offsetX:0,offsetY:0,dragging:!1};const L=new class{setWindowSize(e,t){i(3,_=e),i(4,g=t)}hide(){i(7,S=!1)}show(){i(7,S=!0)}getDimensions(){return{width:_,height:g}}getPosition(){return{x:y,y:v}}setPosition(e,t){i(5,v=t),i(6,y=e),v<l(ke)&&i(5,v=l(ke)),y<0&&i(6,y=0),v+g>window.innerHeight&&i(5,v=window.innerHeight-g),y+_>window.innerWidth&&i(6,y=window.innerWidth-_)}setTitle(e){i(8,w=e)}focus(){Ce.update((e=>e+1)),i(2,b=l(Ce))}getWindowID(){return E}getTitle(){return w}};function R(e){k.dragging&&L.setPosition(e.clientX-k.offsetX,e.clientY-k.offsetY)}T((()=>{window.addEventListener("mousemove",R)})),I((()=>{window.removeEventListener("mousemove",R)}));let D=null!==(f=m.left)&&void 0!==f?f:0,x=null!==(d=m.top)&&void 0!==d?d:0;void 0!==m.right&&(D=window.innerWidth-m.right-m.width),void 0!==m.bottom&&(x=window.innerHeight-m.bottom-(null!==(p=m.height)&&void 0!==p?p:m.width)),L.setPosition(D,x),L.setWindowSize(m.width,m.height),L.setTitle(w),L.show(),ke.subscribe((e=>{v<e&&i(5,v=e)}));return e.$$set=e=>{"config"in e&&i(0,m=e.config),"$$scope"in e&&i(14,a=e.$$scope)},e.$$.update=()=>{8196&e.$$.dirty&&i(12,r=s===b),4096&e.$$.dirty&&i(11,n=r?"button":"button unfocused")},[m,L,b,_,g,v,y,S,w,C,k,n,r,s,a,o,()=>{L.hide()},()=>{L.hide(),function(e){Le.update((t=>(t.push(e),t)))}(L)},()=>{i(9,C=!C),C?(L.setWindowSize(window.innerWidth,window.innerHeight-l(ke)),L.setPosition(0,l(ke))):(L.setWindowSize(m.width,m.height),L.setPosition(y,v))},e=>{i(10,k.dragging=!0,k),i(10,k.offsetX=e.offsetX,k),i(10,k.offsetY=e.offsetY,k),window.addEventListener("mouseup",(function e(){i(10,k.dragging=!1,k),window.removeEventListener("mouseup",e)})),L.focus()},()=>{L.focus()}]}class Je extends J{constructor(e){super(),G(this,e,Ge,Ze,s,{config:0,windowInterface:1})}get windowInterface(){return this.$$.ctx[1]}}function Qe(e){let t,i;return t=new we({}),{c(){V(t.$$.fragment)},m(e,r){X(t,e,r),i=!0},i(e){i||(q(t.$$.fragment,e),i=!0)},o(e){K(t.$$.fragment,e),i=!1},d(e){Y(t,e)}}}function et(e){let t,i;return t=new Ye({}),{c(){V(t.$$.fragment)},m(e,r){X(t,e,r),i=!0},i(e){i||(q(t.$$.fragment,e),i=!0)},o(e){K(t.$$.fragment,e),i=!1},d(e){Y(t,e)}}}function tt(t){let i,r,n,s,o,a,c,h;return n=new ne({props:{iconImageURL:"/images/github.png",targetURL:"https://github.com/iahuang",title:"Github",subtitle:"github.com/iahuang"}}),o=new ne({props:{iconImageURL:"/images/linkedin.png",targetURL:"https://www.linkedin.com/in/ian-a-huang/",title:"LinkedIn",subtitle:"linkedin.com/in/ian-a-huang/"}}),c=new ne({props:{iconImageURL:"/images/email.png",targetURL:"mailto:ia.huang@mail.utoronto.ca",title:"Email",subtitle:"ia.huang@mail.utoronto.ca"}}),{c(){i=b("span"),i.textContent="Contact",r=C(),V(n.$$.fragment),s=C(),V(o.$$.fragment),a=C(),V(c.$$.fragment),L(i,"class","title")},m(e,t){m(e,i,t),m(e,r,t),X(n,e,t),m(e,s,t),X(o,e,t),m(e,a,t),X(c,e,t),h=!0},p:e,i(e){h||(q(n.$$.fragment,e),q(o.$$.fragment,e),q(c.$$.fragment,e),h=!0)},o(e){K(n.$$.fragment,e),K(o.$$.fragment,e),K(c.$$.fragment,e),h=!1},d(e){e&&S(i),e&&S(r),Y(n,e),e&&S(s),Y(o,e),e&&S(a),Y(c,e)}}}function it(e){let t,i;return t=new ae({props:{$$slots:{default:[tt]},$$scope:{ctx:e}}}),{c(){V(t.$$.fragment)},m(e,r){X(t,e,r),i=!0},p(e,i){const r={};128&i&&(r.$$scope={dirty:i,ctx:e}),t.$set(r)},i(e){i||(q(t.$$.fragment,e),i=!0)},o(e){K(t.$$.fragment,e),i=!1},d(e){Y(t,e)}}}function rt(t){let i;return{c(){i=b("div"),i.innerHTML='<div><img class="pfp svelte-i40mnl" src="/images/pfp.jpeg" alt="Profile"/></div> \n                <div style="margin-left: 30px; margin-right: 10px"><span class="title" style="font-size: 24pt;">Ian Huang</span> \n                    <div><p>Hi, I&#39;m a software developer and student at the University of Toronto\n                            with specific interests in web development, systems programming, and\n                            machine learning.</p> \n                        <p>You can learn more about my work using the window on the right or by\n                            exploring the projects highlighted on my Github. You can also interact\n                            with the windows like you would in a real desktop environment.</p> \n                        <p>The source code for this website can also be found\n                            <a href="https://github.com/iahuang/homepage">here</a>.</p></div></div>',L(i,"class","biography-container svelte-i40mnl")},m(e,t){m(e,i,t)},p:e,d(e){e&&S(i)}}}function nt(e){let t,i;return t=new ae({props:{$$slots:{default:[rt]},$$scope:{ctx:e}}}),{c(){V(t.$$.fragment)},m(e,r){X(t,e,r),i=!0},p(e,i){const r={};128&i&&(r.$$scope={dirty:i,ctx:e}),t.$set(r)},i(e){i||(q(t.$$.fragment,e),i=!0)},o(e){K(t.$$.fragment,e),i=!1},d(e){Y(t,e)}}}function st(e){let t,i,r,n,s,o,a,c,h,l,u,f,d,p;function _(t){e[5](t)}i=new te({}),n=new Fe({}),o=new Je({props:{config:{...e[1],title:"File Explorer"},$$slots:{default:[Qe]},$$scope:{ctx:e}}});let g={config:{...e[3],title:"Terminal"},$$slots:{default:[et]},$$scope:{ctx:e}};return void 0!==e[4]&&(g.windowInterface=e[4]),c=new Je({props:g}),B.push((()=>function(e,t,i){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=i,i(e.$$.ctx[r]))}(c,"windowInterface",_))),u=new Je({props:{config:{...e[2],title:"Contact Info"},$$slots:{default:[it]},$$scope:{ctx:e}}}),d=new Je({props:{config:{...e[0],title:"About Me"},$$slots:{default:[nt]},$$scope:{ctx:e}}}),{c(){t=b("main"),V(i.$$.fragment),r=C(),V(n.$$.fragment),s=C(),V(o.$$.fragment),a=C(),V(c.$$.fragment),l=C(),V(u.$$.fragment),f=C(),V(d.$$.fragment),L(t,"class","svelte-i40mnl")},m(e,h){m(e,t,h),X(i,t,null),y(t,r),X(n,t,null),y(t,s),X(o,t,null),y(t,a),X(c,t,null),y(t,l),X(u,t,null),y(t,f),X(d,t,null),p=!0},p(e,[t]){const i={};2&t&&(i.config={...e[1],title:"File Explorer"}),128&t&&(i.$$scope={dirty:t,ctx:e}),o.$set(i);const r={};var n;8&t&&(r.config={...e[3],title:"Terminal"}),128&t&&(r.$$scope={dirty:t,ctx:e}),!h&&16&t&&(h=!0,r.windowInterface=e[4],n=()=>h=!1,M.push(n)),c.$set(r);const s={};4&t&&(s.config={...e[2],title:"Contact Info"}),128&t&&(s.$$scope={dirty:t,ctx:e}),u.$set(s);const a={};1&t&&(a.config={...e[0],title:"About Me"}),128&t&&(a.$$scope={dirty:t,ctx:e}),d.$set(a)},i(e){p||(q(i.$$.fragment,e),q(n.$$.fragment,e),q(o.$$.fragment,e),q(c.$$.fragment,e),q(u.$$.fragment,e),q(d.$$.fragment,e),p=!0)},o(e){K(i.$$.fragment,e),K(n.$$.fragment,e),K(o.$$.fragment,e),K(c.$$.fragment,e),K(u.$$.fragment,e),K(d.$$.fragment,e),p=!1},d(e){e&&S(t),Y(i),Y(n),Y(o),Y(c),Y(u),Y(d)}}}function ot(e,t){return{width:window.innerWidth*e,height:void 0!==t?window.innerWidth*e*t:null}}function at(e,t,i){let r,n,s,o,a;u(e,De,(e=>i(4,r=e)));return window.innerWidth<window.innerHeight?(n=Object.assign(Object.assign({},ot(.9)),{top:20,left:15}),s=Object.assign(Object.assign({},ot(.9,.6)),{left:17,bottom:10}),o=Object.assign(Object.assign({},ot(.9,.5)),{left:19,bottom:20}),a=Object.assign(Object.assign({},ot(.9,.6)),{left:.24*window.innerWidth,bottom:43})):(n=Object.assign(Object.assign({},ot(.45)),{top:20,left:15}),s=Object.assign(Object.assign({},ot(.8,.5)),{top:10,right:10}),o=Object.assign(Object.assign({},ot(.37)),{right:.2*window.innerWidth,top:.5*window.innerHeight}),a=Object.assign(Object.assign({},ot(.48,.6)),{left:.24*window.innerWidth,bottom:43})),[n,s,o,a,r,function(e){r=e,De.set(r)}]}return new class extends J{constructor(e){super(),G(this,e,at,st,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
